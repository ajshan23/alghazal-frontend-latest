import{an as E,j as e,u as A,r as d,aj as R,a1 as F,b as S}from"./index-CBK0URRE.js";import{C as I}from"./Views-Dh3IdAxp.js";import{C as B}from"./Card-DRF7u5X3.js";import{B as g}from"./Button-C7RHz5ZO.js";import{L}from"./Logo-2r6P87Ew.js";import"./Alert-CRh3Jk0B.js";import"./index-B-GJhox6.js";import"./Badge-DlbbfXDd.js";import"./Calendar-AUHmkVIO.js";import"./Skeleton-D0dm26gt.js";import"./index-apRtoHco.js";import"./Dialog-DRwozpaU.js";import"./Drawer-Pg8lWCNH.js";import"./index-Dj4yNje7.js";import"./FormItem-cecpDNA8.js";import"./useUniqueId-DuxEAYhz.js";import"./Input-CVZjq5Jv.js";import"./index-B9_MEVIG.js";import"./index-rchrVk-p.js";import{t as j,N as f}from"./toast-Jn1rpau0.js";import"./Progress-BmzInJz6.js";import"./index-RQU8dCHQ.js";import"./ScrollBar-FpFQDKnk.js";import"./index-CJrbRn7-.js";import"./Select-D9cRqVHS.js";import"./Upload-BTbNP-Ir.js";import{T}from"./index-DHM01vr-.js";import"./Tag-CtBgknZX.js";import"./index-CWGAGzzp.js";import{u as V}from"./useThemeClass-MJSjEjA7.js";import{c as k,u as M,g as U,f as D}from"./index-qKccRNpo.js";import{N as O}from"./react-number-format.es-CAq5LolF.js";import"./StatusIcon-CeCxbmag.js";import"./index-BXubtGR5.js";import"./CloseButton-D_90GCW0.js";import"./proxy-BwDlMs0o.js";import"./floating-ui.react-CYZnfMJH.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-B_Ah24CK.js";import"./useControllableState-B8shNMsq.js";import"./get-DAtU_Z2n.js";import"./toString-zTbtfEe6.js";import"./_getPrototype-Dnmxma1H.js";import"./index-CYMSt5ls.js";import"./index-Chjiymov.js";import"./isNil-Cc0nJDWu.js";import"./chainedFunction-BxZSneMW.js";import"./hoist-non-react-statics.cjs-DWYFunET.js";import"./index-C-UlF_oR.js";const H=async s=>{var t,a;try{const r=await E.get(`/project/${s}/invoice`);if(!r.data)throw new Error("No data received from server");return r.data.data}catch(r){throw console.error("API Error:",r),new Error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to fetch invoice data")}},Y=async s=>{try{return console.log("Downloading invoice PDF for project:",s),(await E.get(`/project/${s}/invoice/pdf`,{responseType:"blob"})).data}catch(t){throw console.error("Error downloading invoice PDF:",t),t}},{Tr:x,Th:q,Td:i,THead:W,TBody:$,TFoot:G}=T,P=({label:s,value:t})=>e.jsxs(x,{children:[e.jsx(i,{className:"!border-t-0",colSpan:3}),e.jsx(i,{className:"font-semibold !border-t-0 text-right",children:s}),e.jsx(i,{className:"!py-3 !border-t-0",children:e.jsx(u,{amount:t})})]}),u=({amount:s=0})=>e.jsx(O,{displayType:"text",value:(Math.round(s*100)/100).toFixed(2),suffix:" AED",thousandSeparator:!0}),m=k(),z=[m.accessor("sno",{header:"Item",cell:s=>s.getValue()}),m.accessor("description",{header:"Description"}),m.accessor("qty",{header:"Qty"}),m.accessor("unitPrice",{header:"Unit Price (AED)",cell:s=>e.jsx(u,{amount:s.getValue()})}),m.accessor("total",{header:"Total (AED)",cell:s=>e.jsx(u,{amount:s.getValue()})})],Q=({products:s=[],summary:t={}})=>{const a=M({data:s,columns:z,getCoreRowModel:U()});return e.jsxs(T,{children:[e.jsx(W,{children:a.getHeaderGroups().map(r=>e.jsx(x,{children:r.headers.map(n=>e.jsx(q,{colSpan:n.colSpan,children:D(n.column.columnDef.header,n.getContext())},n.id))},r.id))}),e.jsx($,{children:a.getRowModel().rows.map(r=>e.jsx(x,{children:r.getVisibleCells().map(n=>e.jsx(i,{children:D(n.column.columnDef.cell,n.getContext())},n.id))},r.id))}),e.jsxs(G,{children:[e.jsx(P,{label:"Amount (AED)",value:t.amount}),e.jsx(P,{label:"VAT 5% (AED)",value:t.vat}),e.jsxs(x,{children:[e.jsx(i,{className:"!border-t-0",colSpan:3}),e.jsx(i,{className:"font-semibold text-base text-right",children:"Total Receivable (AED)"}),e.jsx(i,{className:"font-semibold text-base !py-3",children:e.jsx(u,{amount:t.totalReceivable})})]})]})]})},X=()=>{V();const s=A(o=>o.theme.mode),[t,a]=d.useState(!0),[r,n]=d.useState(null),[b,p]=d.useState(null),[v,N]=d.useState(!1),{projectId:c}=R(),w=async()=>{try{if(a(!0),p(null),!c)throw new Error("Project ID is required");const o=await H(c);if(!o||!o.invoiceNumber||!o.vendor||!o.vendee||!Array.isArray(o.products))throw new Error("Invalid invoice data received from server");n(o)}catch(o){console.error("Error fetching invoice data:",o),p(o instanceof Error?o.message:"Failed to load invoice data")}finally{a(!1)}};d.useEffect(()=>{w()},[c]);const C=async()=>{var o;if(!c){j.push(e.jsx(f,{title:"Error",type:"danger",children:"Project ID is required"}));return}N(!0),p(null);try{const h=await Y(c),y=window.URL.createObjectURL(new Blob([h])),l=document.createElement("a");l.href=y,l.setAttribute("download",`invoice_${(r==null?void 0:r.invoiceNumber)||c}.pdf`),document.body.appendChild(l),l.click(),(o=l.parentNode)==null||o.removeChild(l),window.URL.revokeObjectURL(y),j.push(e.jsx(f,{title:"Success",type:"success",children:"PDF downloaded successfully"}))}catch(h){console.error("PDF download error:",h),p("Failed to download PDF"),j.push(e.jsx(f,{title:"Error",type:"danger",children:"Failed to download PDF"}))}finally{N(!1)}};return b?e.jsxs("div",{className:"p-4 text-center text-red-500",children:[b,e.jsx(g,{className:"mt-4",onClick:w,children:"Retry"})]}):t||!r?e.jsx(F,{loading:!0}):e.jsxs("div",{className:"print:p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx(L,{className:"mb-3",mode:s}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"TAX INVOICE"})]}),e.jsx("div",{className:"my-4",children:e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["PO Box No: ",r.vendor.poBox]}),e.jsxs("span",{children:["Date: ",S(r.date).format("DD/MM/YYYY")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Dubai, UAE"}),e.jsxs("span",{children:["INV #: ",r.invoiceNumber]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Website: www.alghazalgroup.com"}),e.jsxs("span",{children:["Order No: ",r.orderNumber]})]})]})})]}),e.jsx("div",{className:"border-t border-b border-gray-200 dark:border-gray-600 py-4 my-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-2",children:"Vendee"}),e.jsxs("p",{className:"whitespace-pre-line",children:[r.vendee.name,e.jsx("br",{}),r.vendee.contactPerson,e.jsx("br",{}),r.vendee.address,e.jsx("br",{}),"PB ",r.vendee.poBox,e.jsx("br",{}),"Phone: ",r.vendee.phone,e.jsx("br",{}),"Fax: ",r.vendee.fax,e.jsx("br",{}),"TRN#: ",r.vendee.trn]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-2",children:"Vendor"}),e.jsxs("p",{className:"whitespace-pre-line",children:[r.vendor.name,e.jsx("br",{}),"PB: ",r.vendor.poBox," ",r.vendor.address,e.jsx("br",{}),"Phone: ",r.vendor.phone,e.jsx("br",{}),"TRN#: ",r.vendor.trn,e.jsx("br",{}),"GRN Number: ",r.vendee.grnNumber,e.jsx("br",{}),"Supplier No.: ",r.vendee.supplierNumber,e.jsx("br",{}),"Service Period: ",r.vendee.servicePeriod]})]})]})}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"font-bold",children:"Subject:"}),e.jsx("p",{children:r.subject})]}),e.jsx("div",{className:"my-6",children:e.jsx(Q,{products:r.products,summary:r.summary})}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"font-bold mb-2",children:"Comments or special instructions"}),e.jsxs("p",{children:["Payment: ",r.paymentTerms]}),e.jsxs("p",{children:["Amt in Words: ",r.amountInWords]})]}),e.jsx("div",{className:"mt-8"}),e.jsx("div",{className:"print:hidden mt-6 flex items-center justify-end",children:e.jsx(g,{variant:"solid",loading:v,onClick:C,children:v?"Generating PDF...":"Download Invoice"})})]})},$e=()=>e.jsx(I,{className:"h-full",children:e.jsx(B,{className:"h-full",bodyClass:"h-full",children:e.jsx(X,{})})});export{$e as default};
