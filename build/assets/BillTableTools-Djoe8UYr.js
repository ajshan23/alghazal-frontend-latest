import{r as i,j as e,X as ce,b as O,v as de,m as me}from"./index-BxO48E7J.js";import{D as he}from"./DataTable-BY0GTXYv.js";import{aP as ue,aR as pe,I as ge,X as xe,a0 as ve,$ as ye}from"./index-BvMts2N3.js";import{u as be}from"./useThemeClass-CVckhmrY.js";import{u as fe}from"./useQuery-D9PWsr8U.js";import{d as Ne}from"./debounce-Dl_R0PA7.js";import{I as je}from"./Input-Bk_hBu-L.js";import{B as De}from"./Badge-BDINMpeU.js";import{d as we,f as _,a as Ce,b as Ae,c as Se,e as ke,g as Me}from"./format-CZfo5T8Q.js";import{h as Fe}from"./moment-C5S46NFB.js";import{C as Ke}from"./ConfirmDialog-wZKJ97Q_.js";import{t as H,N as L}from"./toast-CyYsqkVZ.js";import{b as Be,c as $e}from"./index-C5rhtymH.js";import"./Alert-DAYHHcTG.js";import"./index-D65Or3wn.js";import{B as Ee}from"./Button-Cqs6OGDK.js";import"./Calendar-CZCjMlL9.js";import"./Card-BkELxnQG.js";import"./Skeleton-UhY8bWTz.js";import{D as z}from"./index-CbDZljJP.js";import"./Dialog-Y-f76L7n.js";import{D as Re}from"./Drawer-C4WNb_Rb.js";import"./index-DPk-9BZv.js";import{a as S}from"./FormItem-BHnkbcAj.js";import"./useUniqueId-B5ZH9nmF.js";import"./index-CujXW8qQ.js";import"./index-DUubB36n.js";import"./Progress-B54yMz__.js";import"./index-ko3aNh7X.js";import"./ScrollBar-Dolz5Bqf.js";import"./index-BQv2iMDd.js";import{S as K}from"./Select-BKHxHb6S.js";import"./Upload-5TuzLRJ1.js";import"./index-Br-igED4.js";import"./Tag-oUmSLAu4.js";import"./index-DPAMRK6r.js";import{F as Oe,a as Te,b as k}from"./formik.esm-COq3CY63.js";import{c as Ie}from"./index.esm-B_aVpQ9s.js";import{F as Ve}from"./FileSaver.min-DPq32rND.js";const Pe=({isOpen:v,onClose:m,bill:o,refetch:h})=>{const[N,j]=i.useState(!1);if(!v||!o)return null;const b=()=>{var d,n;switch(o.billType){case"general":return`Delete General Bill ${o.invoiceNo?`#${o.invoiceNo}`:""}`;case"fuel":return"Delete Fuel Bill";case"mess":return"Delete Mess Bill";case"vehicle":return`Delete Vehicle Bill ${(d=o.vehicle)!=null&&d.vehicleNumber?`(Vehicle ${o.vehicle.vehicleNumber})`:""}`;case"accommodation":return`Delete Accommodation Bill ${(n=o.accommodation)!=null&&n.location?`(${o.accommodation.location})`:""}`;default:return"Delete Bill"}},D=()=>{var d,n;switch(o.billType){case"general":return`Are you sure you want to delete this general bill${o.invoiceNo?` (Invoice #${o.invoiceNo})`:""}? This action cannot be undone.`;case"fuel":return"Are you sure you want to delete this fuel bill? This action cannot be undone.";case"mess":return"Are you sure you want to delete this mess bill? This action cannot be undone.";case"vehicle":return`Are you sure you want to delete this vehicle bill${(d=o.vehicle)!=null&&d.vehicleNumber?` for vehicle ${o.vehicle.vehicleNumber}`:""}? This action cannot be undone.`;case"accommodation":return`Are you sure you want to delete this accommodation bill${(n=o.accommodation)!=null&&n.location?` for ${o.accommodation.location}`:""}? This action cannot be undone.`;default:return"Are you sure you want to delete this bill? This action cannot be undone."}},y=async()=>{var d,n;j(!0);try{await we(o._id),h(),H.push(e.jsx(L,{title:`${b()} deleted successfully`,type:"success",duration:2500,children:"The bill has been successfully deleted."}),{placement:"top-center"}),m()}catch(g){console.error("Delete failed:",g),H.push(e.jsx(L,{title:`Failed to delete ${b()}`,type:"danger",duration:2500,children:((n=(d=g==null?void 0:g.response)==null?void 0:d.data)==null?void 0:n.message)||g.message||"Something went wrong"}),{placement:"top-center"})}finally{j(!1)}};return e.jsxs(Ke,{isOpen:v,type:"danger",title:b(),confirmButtonColor:"red-600",onClose:m,onRequestClose:m,onCancel:m,onConfirm:y,confirmButtonDisabled:N,children:[e.jsx("p",{children:D()}),N&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},q=[{label:"ADCB",value:"adcb"},{label:"ADIB",value:"adib"},{label:"Cash",value:"cash"},{label:"ADVANCE",value:"advance"},{label:"MASHREQ CARD",value:"masherq_card"},{label:"ATHEER PLUS",value:"atheer_plus"}],Ye=({isOpen:v,onClose:m,onRequestClose:o,billType:h,onApplyFilters:N})=>{const[j,b]=i.useState([]),[D,y]=i.useState([]),[d,n]=i.useState([]),[g,B]=i.useState(!0);i.useEffect(()=>{(async()=>{var w,C,A;try{const r=await Ce();b(((w=r==null?void 0:r.data)==null?void 0:w.shops.map(x=>({label:`${x.shopName} (${x.shopNo})`,value:x._id})))||[]);const c=await Ae();y(((C=c==null?void 0:c.data)==null?void 0:C.categories.map(x=>({label:x.name,value:x._id})))||[]);const s=await Se();n(((A=s==null?void 0:s.data)==null?void 0:A.vehicles.map(x=>({label:x.vehicleNumber,value:x._id})))||[])}catch(r){console.error("Error loading filter options",r)}finally{B(!1)}})()},[]);const M=new Date;return e.jsx(Re,{title:"Filter Bills",isOpen:v,onClose:m,onRequestClose:o,children:e.jsx(Oe,{initialValues:{startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:""},validationSchema:Ie({}),onSubmit:F=>{N&&N(F),setTimeout(()=>{m&&m(new MouseEvent("click"))},100)},children:({values:F,errors:w,touched:C,resetForm:A})=>e.jsxs(Te,{className:"space-y-4",children:[e.jsx(S,{label:"Start Date",invalid:!!w.startDate&&C.startDate,children:e.jsx(k,{name:"startDate",children:({field:r,form:c})=>e.jsx(z,{placeholder:"Select Start Date",value:r.value?new Date(r.value):null,maxDate:M,onChange:s=>c.setFieldValue(r.name,s?_(new Date(s.getFullYear(),s.getMonth(),s.getDate()),"yyyy-MM-dd"):"")})})}),e.jsx(S,{label:"End Date",invalid:!!w.endDate&&C.endDate,children:e.jsx(k,{name:"endDate",children:({field:r,form:c})=>e.jsx(z,{placeholder:"Select End Date",value:r.value?new Date(r.value):null,maxDate:M,onChange:s=>c.setFieldValue(r.name,s?_(new Date(s.getFullYear(),s.getMonth(),s.getDate()),"yyyy-MM-dd"):"")})})}),(h==="general"||h==="mess"||h==="accommodation"||h==="vehicle")&&e.jsx(S,{label:"Shop Name",children:e.jsx(k,{name:"shop",children:({field:r,form:c})=>e.jsx(K,{placeholder:"Select Shop",options:j,value:j.find(s=>s.value===r.value),onChange:s=>c.setFieldValue(r.name,(s==null?void 0:s.value)||""),loading:g})})}),h==="general"&&e.jsx(S,{label:"Category",children:e.jsx(k,{name:"category",children:({field:r,form:c})=>e.jsx(K,{placeholder:"Select Category",options:D,value:D.find(s=>s.value===r.value),onChange:s=>c.setFieldValue(r.name,(s==null?void 0:s.value)||""),loading:g})})}),(h==="vehicle"||h==="fuel")&&e.jsx(S,{label:"Vehicle No",children:e.jsx(k,{name:"vehicleNo",children:({field:r,form:c})=>e.jsx(K,{placeholder:"Select Vehicle",options:d,value:d.find(s=>s.value===r.value),onChange:s=>c.setFieldValue(r.name,(s==null?void 0:s.value)||""),loading:g})})}),["general","mess","fuel","vehicle","accommodation"].includes(h)&&e.jsx(S,{label:"Payment Method",children:e.jsx(k,{name:"paymentMethod",children:({field:r,form:c})=>e.jsx(K,{placeholder:"Select Payment Method",options:q,value:q.find(s=>s.value===r.value),onChange:s=>c.setFieldValue(r.name,(s==null?void 0:s.value)||"")})})}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>A(),className:"flex items-center gap-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-3 py-1.5 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:[e.jsx(Be,{className:"text-base"}),"Reset"]}),e.jsx("button",{type:"submit",className:"text-sm bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700",children:"Apply Filters"})]})]})})})},J={adcb:{label:"ADCB",dotClass:"bg-blue-500",textClass:"text-blue-500"},adib:{label:"ADIB",dotClass:"bg-green-500",textClass:"text-green-500"},cash:{label:"Cash",dotClass:"bg-purple-500",textClass:"text-purple-500"},masherq_card:{label:"MASHREQ CARD",dotClass:"bg-orange-500",textClass:"text-orange-500"}},R=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],_e=Array.from({length:10},(v,m)=>({value:O().year()-5+m,label:(O().year()-5+m).toString()})),Ma=({onDropdownSelect:v})=>{var V,P,Y;const o=ce().pathname,[h,N]=i.useState(!1),j=i.useRef(null),[b,D]=i.useState(""),[y,d]=i.useState({page:1,limit:10}),[n,g]=i.useState({startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:""}),[B,M]=i.useState(!1),[F,w]=i.useState(null),[C,A]=i.useState(!1),[r,c]=i.useState(new Date().getMonth()+1),[s,x]=i.useState(new Date().getFullYear()),p=o.includes("/fuel-bill-view")?"fuel":o.includes("/mess-bill-view")?"mess":o.includes("/vehicle-bill-view")?"vehicle":o.includes("/acc-bill-view")?"accommodation":o.includes("/commission-bill-view")?"commission":"general",Q=t=>{g(t)},{data:f,isLoading:U,error:T,refetch:X}=fe({queryKey:["bills",y.page,y.limit,b,n,p,r,s],queryFn:()=>Me({page:y.page,limit:y.limit,billType:p,search:b,month:r,year:s,startDate:n.startDate,endDate:n.endDate,category:n.category,shop:n.shop,vehicle:n.vehicleNo,paymentMethod:n.paymentMethod})}),G=((V=f==null?void 0:f.data)==null?void 0:V.bills)||[],W=((P=f==null?void 0:f.data)==null?void 0:P.totalAmount)||0,$=((Y=f==null?void 0:f.data)==null?void 0:Y.pagination)||{total:0,page:1,limit:10},Z=i.useMemo(()=>Ne(t=>{D(t),d(a=>({...a,page:1}))},500),[]),ee=t=>{Z(t.target.value)},ae=({row:t,onDeleteClick:a})=>{const{textTheme:l}=be(),u=de(),E={general:"/app/new-gen-bill",mess:"/app/new-mess-bill",fuel:"/app/new-fuel-bill",vehicle:"/app/new-vehicle-bill",accommodation:"/app/new-acc-bill",commission:"/app/new-commission-bill"};return e.jsxs("div",{className:"flex text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${l}`,onClick:()=>u("/app/bill-attachments",{state:{data:t==null?void 0:t.attachments}}),children:e.jsx(ge,{})}),e.jsx("span",{className:`cursor-pointer p-2 hover:${l}`,onClick:()=>u(`${E[p]}/${t._id}`),children:e.jsx(xe,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>a(t),children:e.jsx(ve,{})})]})},te=()=>{const t=[{header:"S.NO",accessorKey:"_id",cell:a=>e.jsx("span",{children:a.row.index+1})},{header:"DATE",accessorKey:"billDate",cell:a=>e.jsx("span",{children:Fe(a.row.original.billDate).format("DD MMM YYYY")})},{header:"Payment Method",accessorKey:"paymentMethod",cell:a=>{const l=a.row.original.paymentMethod,u=J[l]||{label:l,dotClass:"bg-gray-500",textClass:"text-gray-500"};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:u.dotClass}),e.jsx("span",{className:`capitalize font-semibold ${u.textClass}`,children:u.label})]})}},{header:"Amount",accessorKey:"amount",cell:a=>e.jsxs("span",{children:[" ",a.row.original.amount.toFixed(2)]})},{header:"Action",id:"action",cell:a=>e.jsx(ae,{row:a.row.original,onDeleteClick:l=>{w(l),M(!0)}})}];return p==="mess"?[t[0],t[1],{header:"Shop Name",accessorKey:"shop",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.shop)==null?void 0:l.shopName)||"N/A"})}},{header:"Shop Number",accessorKey:"shopNo",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.shop)==null?void 0:l.shopNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:a=>e.jsx("span",{children:a.row.original.invoiceNo||"N/A"})},t[2],t[3],t[4]]:p==="general"?[t[0],t[1],{header:"Category",accessorKey:"category",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.category)==null?void 0:l.name)||"N/A"})}},{header:"Shop Name",accessorKey:"shop",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.shop)==null?void 0:l.shopName)||"N/A"})}},{header:"Shop Number",accessorKey:"shopNo",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.shop)==null?void 0:l.shopNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:a=>e.jsx("span",{children:a.row.original.invoiceNo||"N/A"})},t[2],t[3],{header:"REMARK",accessorKey:"remarks",cell:a=>e.jsx("span",{children:a.row.original.remarks||"N/A"})},t[4]]:p==="fuel"?[t[0],t[1],{header:"Description",accessorKey:"remarks",cell:a=>e.jsx("span",{children:a.row.original.remarks||"N/A"})},{header:"Vehicle No",accessorKey:"vehicle",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.vehicle)==null?void 0:l.vehicleNumber)||"N/A"})}},t[2],t[3],{header:"Kilometer",accessorKey:"kilometer",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.kilometer)==null?void 0:l.toFixed(2))||"N/A"})}},{header:"Liter",accessorKey:"liter",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.liter)==null?void 0:l.toFixed(2))||"N/A"})}},{header:"Remarks",accessorKey:"remarks",cell:a=>e.jsx("span",{children:a.row.original.remarks||"N/A"})},t[4]]:p==="vehicle"?[t[0],t[1],{header:"Purpose Of Use",accessorKey:"remarks",cell:a=>e.jsx("span",{children:a.row.original.remarks||"N/A"})},{header:"Vehicle No",accessorKey:"vehicle",cell:a=>{const l=a.row.original.vehicle;return Array.isArray(l)?e.jsx("span",{children:l.map(u=>u.vehicleNumber).join(", ")||"N/A"}):l?e.jsx("span",{children:l.vehicleNumber||"N/A"}):e.jsx("span",{children:"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:a=>e.jsx("span",{children:a.row.original.invoiceNo||"N/A"})},t[2],t[3],{header:"Shop Name",accessorKey:"shop",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.shop)==null?void 0:l.shopName)||"N/A"})}},{header:"Remarks",accessorKey:"remarks",cell:a=>e.jsx("span",{children:a.row.original.remarks||"N/A"})},t[4]]:p==="accommodation"?[t[0],t[1],{header:"Company Name",accessorKey:"shop",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original.shop)==null?void 0:l.shopName)||"N/A"})}},{header:"Room No",accessorKey:"accommodation",cell:a=>{var l;return e.jsx("span",{children:((l=a.row.original)==null?void 0:l.roomNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:a=>e.jsx("span",{children:a.row.original.invoiceNo||"N/A"})},{header:"Payment Mode",accessorKey:"paymentMethod",cell:a=>{const l=a.row.original.paymentMethod,u=J[l]||{label:l,textClass:"text-gray-500"};return e.jsx("span",{className:`capitalize font-semibold ${u.textClass}`,children:u.label})}},t[3],{header:"Note",accessorKey:"remarks",cell:a=>e.jsx("span",{children:a.row.original.remarks||"N/A"})},{header:"Remarks",accessorKey:"remarks",cell:a=>e.jsx("span",{children:a.row.original.remarks||"N/A"})},t[4]]:p==="commission"?[t[0],t[1],t[3],t[4]]:t},le=i.useMemo(()=>te(),[p]),se=t=>{d(a=>({...a,page:t}))},re=t=>{d(a=>({page:1,limit:t}))},oe=()=>{A(!0)},I=t=>{console.log("onDrawerClose",t),A(!1)},ne=()=>{var t,a;g({startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:""}),D(""),c(new Date().getMonth()+1),x(new Date().getFullYear()),d({page:1,limit:10}),(a=(t=j.current)==null?void 0:t.resetSorting)==null||a.call(t)},ie=async()=>{N(!0);try{const t=await ke({page:y.page,limit:y.limit,search:b,billType:p,month:r,year:s,startDate:n.startDate,endDate:n.endDate,category:n.category,shop:n.shop,vehicle:n.vehicleNo,paymentMethod:n.paymentMethod}),a=`bills_${p}_${O().format("YYYY-MM-DD")}.xlsx`;Ve.saveAs(t,a)}catch(t){console.error("Error exporting bills:",t)}finally{N(!1)}};return i.useEffect(()=>{var a;const t=((a=R.find(l=>l.value===r))==null?void 0:a.label)||"";v(t)},[r,v]),T?e.jsxs("div",{children:["Error loading bills: ",T.message]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row gap-4 justify-between items-center",children:[e.jsx(je,{placeholder:"Search bills...",onChange:ee,className:"max-w-md w-full md:w-auto"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("select",{className:"p-2 border rounded-md dark:bg-gray-800 dark:border-gray-700",value:r,onChange:t=>{var u;const a=Number(t.target.value),l=((u=R.find(E=>E.value===a))==null?void 0:u.label)||"";c(a),v(l)},children:R.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("select",{className:"p-2 border rounded-md dark:bg-gray-800 dark:border-gray-700",value:s,onChange:t=>x(Number(t.target.value)),children:_e.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("button",{onClick:ne,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:"Reset filters",children:e.jsx(ue,{size:18})}),e.jsx("button",{onClick:ie,disabled:h,className:`p-2 ${h?"text-gray-400":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,title:h?"Exporting...":"Export bills",children:e.jsx(pe,{size:18})}),e.jsxs("button",{onClick:()=>oe(),className:"px-4 py-2 flex items-center gap-2 bg-gray-100 dark:bg-gray-700 rounded-md border border-gray-200 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx($e,{size:16}),"Filter"]})]})]}),e.jsx(he,{ref:j,columns:le,data:G,totalAmount:W,loading:U,pagingData:{total:$.total,pageIndex:$.page,pageSize:$.limit},onPaginationChange:se,onSelectChange:re}),e.jsx(Pe,{isOpen:B,onClose:()=>M(!1),bill:F,refetch:X}),e.jsx(Ye,{isOpen:C,billType:p,onClose:I,onRequestClose:I,onApplyFilters:Q})]})},Fa=({to:v,title:m})=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:e.jsx(me,{className:"block lg:inline-block md:mb-0 mb-4",to:v,children:e.jsx(Ee,{block:!0,variant:"solid",size:"sm",icon:e.jsx(ye,{}),children:m})})});export{Fa as B,Ma as a};
