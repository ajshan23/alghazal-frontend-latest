import{r as p,j as t,m as V}from"./index-Bb5hWms4.js";import{C as E}from"./ConfirmDialog-DQueJXox.js";import{t as A,N as C}from"./toast-CpYugtuS.js";import{d as T,a as k,f as R,b as _,c as O}from"./api-CFCqUzHy.js";import"./Alert-Dugunmqe.js";import"./index-CUJxdyM4.js";import"./Badge-1rBRPyjl.js";import{B as I}from"./Button-CEPbL0Lb.js";import"./Calendar-D6hwXXzX.js";import"./Card-B8rHCzH9.js";import"./Skeleton-1b1THtL-.js";import{D as B}from"./index-i-B8EDNL.js";import"./Dialog-BD9Iq8Pi.js";import{D as P}from"./Drawer-bwHZPj3y.js";import"./index-xDZoWOTm.js";import{a as d}from"./FormItem-HvRvrzPo.js";import"./useUniqueId-BnEng_SK.js";import"./Input-Cko6IXRf.js";import"./index-BxyXzxfn.js";import"./index-D9ztJ0Q9.js";import"./Progress-odjwHsxt.js";import"./index-Dk7Y2OWs.js";import"./ScrollBar-BNcJtmRR.js";import"./index-C5YaGYnA.js";import{S as j}from"./Select-D7Yb2KL8.js";import"./Upload-VD0qPFFK.js";import"./index-D9qBG3Fu.js";import"./Tag-e5oFChya.js";import"./index-CDOucsrX.js";import{F as L,a as H,b as h}from"./formik.esm-lEj-AbBD.js";import{c as q}from"./index.esm-D-SZitWC.js";import{c as Y}from"./index-CM2QS1te.js";import{f as F}from"./format-BzRktsyD.js";import{a4 as z}from"./index-DyZvV4US.js";const Ae=({isOpen:m,onClose:r,bill:s,refetch:o})=>{const[v,x]=p.useState(!1);if(!m||!s)return null;const g=()=>{var l,i;switch(s.billType||s.reportType){case"general":return`Delete General Bill ${s.invoiceNo?`#${s.invoiceNo}`:""}`;case"fuel":return"Delete Fuel Bill";case"mess":return"Delete Mess Bill";case"vehicle":return`Delete Vehicle Bill ${(l=s.vehicle)!=null&&l.vehicleNumber?`(Vehicle ${s.vehicle.vehicleNumber})`:""}`;case"accommodation":return`Delete Accommodation Bill ${(i=s.accommodation)!=null&&i.location?`(${s.accommodation.location})`:""}`;case"adib":return"Delete Adib Report";case"expense":return"Delete Expense Report";default:return"Delete Bill"}},b=()=>{var l,i;switch(s.billType||s.reportType){case"general":return`Are you sure you want to delete this general bill${s.invoiceNo?` (Invoice #${s.invoiceNo})`:""}? This action cannot be undone.`;case"fuel":return"Are you sure you want to delete this fuel bill? This action cannot be undone.";case"mess":return"Are you sure you want to delete this mess bill? This action cannot be undone.";case"vehicle":return`Are you sure you want to delete this vehicle bill${(l=s.vehicle)!=null&&l.vehicleNumber?` for vehicle ${s.vehicle.vehicleNumber}`:""}? This action cannot be undone.`;case"accommodation":return`Are you sure you want to delete this accommodation bill${(i=s.accommodation)!=null&&i.location?` for ${s.accommodation.location}`:""}? This action cannot be undone.`;case"adib":return"Are you sure you want to delete this adib report? This action cannot be undone.";case"expense":return"Are you sure you want to delete this expense report? This action cannot be undone.";default:return"Are you sure you want to delete this bill? This action cannot be undone."}},w=async()=>{var l,i;x(!0);try{await s.billType?T(s._id):k(s._id),o(),A.push(t.jsx(C,{title:`${g()} deleted successfully`,type:"success",duration:2500,children:s.billType?"The bill has been successfully deleted.":"The report has been successfully deleted."}),{placement:"top-center"}),r()}catch(c){console.error("Delete failed:",c),A.push(t.jsx(C,{title:`Failed to delete ${g()}`,type:"danger",duration:2500,children:((i=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:i.message)||c.message||"Something went wrong"}),{placement:"top-center"})}finally{x(!1)}};return t.jsxs(E,{isOpen:m,type:"danger",title:g(),confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:w,confirmButtonDisabled:v,children:[t.jsx("p",{children:b()}),v&&t.jsx("div",{className:"mt-4 flex justify-center",children:t.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},$=[{label:"ADCB",value:"adcb"},{label:"ADIB",value:"adib"},{label:"Cash",value:"cash"},{label:"ADVANCE",value:"advance"},{label:"MASHREQ CARD",value:"masherq_card"},{label:"ATHEER PLUS",value:"atheer_plus"}],Ce=({isOpen:m,onClose:r,onRequestClose:s,billType:o,onApplyFilters:v})=>{const[x,g]=p.useState([]),[b,w]=p.useState([]),[l,i]=p.useState([]),[c,M]=p.useState(!0);p.useEffect(()=>{(async()=>{var y,f,D;try{const a=await R();g(((y=a==null?void 0:a.data)==null?void 0:y.shops.map(u=>({label:`${u.shopName} (${u.shopNo})`,value:u._id})))||[]);const n=await _();w(((f=n==null?void 0:n.data)==null?void 0:f.categories.map(u=>({label:u.name,value:u._id})))||[]);const e=await O();i(((D=e==null?void 0:e.data)==null?void 0:D.vehicles.map(u=>({label:u.vehicleNumber,value:u._id})))||[])}catch(a){console.error("Error loading filter options",a)}finally{M(!1)}})()},[]);const S=new Date;return t.jsx(P,{title:"Filter Bills",isOpen:m,onClose:r,onRequestClose:s,children:t.jsx(L,{initialValues:{startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:""},validationSchema:q({}),onSubmit:N=>{v&&v(N),setTimeout(()=>{r&&r(new MouseEvent("click"))},100)},children:({values:N,errors:y,touched:f,resetForm:D})=>t.jsxs(H,{className:"space-y-4",children:[t.jsx(d,{label:"Start Date",invalid:!!y.startDate&&f.startDate,children:t.jsx(h,{name:"startDate",children:({field:a,form:n})=>t.jsx(B,{placeholder:"Select Start Date",value:a.value?new Date(a.value):null,maxDate:S,onChange:e=>n.setFieldValue(a.name,e?F(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),t.jsx(d,{label:"End Date",invalid:!!y.endDate&&f.endDate,children:t.jsx(h,{name:"endDate",children:({field:a,form:n})=>t.jsx(B,{placeholder:"Select End Date",value:a.value?new Date(a.value):null,maxDate:S,onChange:e=>n.setFieldValue(a.name,e?F(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),(o==="general"||o==="mess"||o==="accommodation"||o==="vehicle"||o==="adib")&&t.jsx(d,{label:"Shop Name",children:t.jsx(h,{name:"shop",children:({field:a,form:n})=>t.jsx(j,{placeholder:"Select Shop",options:x,value:x.find(e=>e.value===a.value),onChange:e=>n.setFieldValue(a.name,(e==null?void 0:e.value)||""),loading:c})})}),o==="general"||o==="adib"&&t.jsx(d,{label:"Category",children:t.jsx(h,{name:"category",children:({field:a,form:n})=>t.jsx(j,{placeholder:"Select Category",options:b,value:b.find(e=>e.value===a.value),onChange:e=>n.setFieldValue(a.name,(e==null?void 0:e.value)||""),loading:c})})}),(o==="vehicle"||o==="fuel")&&t.jsx(d,{label:"Vehicle No",children:t.jsx(h,{name:"vehicleNo",children:({field:a,form:n})=>t.jsx(j,{placeholder:"Select Vehicle",options:l,value:l.find(e=>e.value===a.value),onChange:e=>n.setFieldValue(a.name,(e==null?void 0:e.value)||""),loading:c})})}),["general","mess","fuel","vehicle","accommodation"].includes(o)&&t.jsx(d,{label:"Payment Method",children:t.jsx(h,{name:"paymentMethod",children:({field:a,form:n})=>t.jsx(j,{placeholder:"Select Payment Method",options:$,value:$.find(e=>e.value===a.value),onChange:e=>n.setFieldValue(a.name,(e==null?void 0:e.value)||"")})})}),t.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>D(),className:"flex items-center gap-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-3 py-1.5 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:[t.jsx(Y,{className:"text-base"}),"Reset"]}),t.jsx("button",{type:"submit",className:"text-sm bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700",children:"Apply Filters"})]})]})})})},Be=({to:m,title:r})=>t.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:t.jsx(V,{className:"block lg:inline-block md:mb-0 mb-4",to:m,children:t.jsx(I,{block:!0,variant:"solid",size:"sm",icon:t.jsx(z,{}),children:r})})});export{Be as B,Ae as a,Ce as b};
