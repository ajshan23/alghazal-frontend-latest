import{aj as q,a6 as V,r as d,j as e}from"./index-CYREFKZG.js";import"./Alert-Cc8BV9-e.js";import"./index-lj_pQvB3.js";import"./Badge-C73elDoT.js";import{B as T}from"./Button-Bw5pwASe.js";import"./Calendar-WeLCs7zT.js";import"./Card-Dz-vhRoS.js";import"./Skeleton-C3msD0AC.js";import"./index-D7RG7uIP.js";import"./Dialog-SyL1UyQI.js";import"./Drawer-BPn271Vj.js";import"./index-DSWsvdkV.js";import"./FormItem-OC8YTe9a.js";import"./useUniqueId-usxbXFWg.js";import"./Input-CBtIewGG.js";import"./index-hkorcGQ3.js";import"./index-Duq-6sPR.js";import{t as n,N as o}from"./toast-D10MqJ5k.js";import"./Progress-5WwxyJN3.js";import"./index-Cx-cciMK.js";import"./ScrollBar-PLAgVGcK.js";import"./index-D5et0e9c.js";import"./Select-BXBkdm85.js";import"./Upload-BBmsRjVm.js";import"./index-Cy_ZD0YM.js";import"./Tag-DmHmgYE4.js";import"./index-fox4VSB4.js";import{aJ as W,aK as J,Y as K,aL as Q}from"./index-DxPdCp1M.js";import{f as R,d as Y,a as z}from"./api-CpnoYVTX.js";import"./StatusIcon-D8Q-TRIc.js";import"./CloseButton-DcT37PEO.js";import"./proxy-B3X64ZJl.js";import"./floating-ui.react-Db-n4bhI.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-DMrbObHh.js";import"./useControllableState-8Kzkpc2P.js";import"./get-t94M6iYX.js";import"./Views-CidN8ifI.js";import"./toString-BZ5q91vB.js";import"./_getPrototype-35SxlZMe.js";import"./index-BHcECQs3.js";import"./index-Chjiymov.js";import"./isNil-CbtC8I9H.js";import"./chainedFunction-BxZSneMW.js";import"./hoist-non-react-statics.cjs-D7IwvU7q.js";import"./index-CpO4fbZN.js";const Ve=()=>{var N,b,f,k,v,w,D,E,A,S,F,C,P;const{expenseId:s}=q(),l=V(),[a,$]=d.useState(null),[M,g]=d.useState(!0),[B,y]=d.useState(!1),[I,h]=d.useState(!1);d.useEffect(()=>{(async()=>{try{g(!0);const r=await R(s);$(r.data),console.log("expense data",r.data)}catch(r){n.push(e.jsx(o,{title:"Error",type:"danger",children:"Failed to load expense details"})),console.error("Error loading expense:",r),l(-1)}finally{g(!1)}})()},[s,l]);const U=async()=>{try{y(!0),await Y(s),n.push(e.jsx(o,{title:"Success",type:"success",children:"Expense deleted successfully"})),l(`/projects/${a==null?void 0:a.project._id}/expenses`)}catch(t){n.push(e.jsx(o,{title:"Error",type:"danger",children:"Failed to delete expense"})),console.error("Error deleting expense:",t)}finally{y(!1)}},O=async()=>{try{h(!0);const t=`expense-${a==null?void 0:a.project.projectNumber}-${s}.pdf`;await z(s,t)}catch(t){n.push(e.jsx(o,{title:"Error",type:"danger",children:"Failed to download PDF"})),console.error("Error downloading PDF:",t)}finally{h(!1)}},u=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});if(M)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 dark:border-blue-400"})});if(!a)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Expense not found"})});const p=a.totalMaterialCost||0,m=((N=a.laborDetails)==null?void 0:N.totalLaborCost)||0,j=p+m,i=((b=a.quotation)==null?void 0:b.netAmount)||0,x=i-j,H=i?x/i*100:0;return e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("button",{onClick:()=>l(-1),className:"flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(W,{className:"mr-1"}),"Back"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(T,{variant:"solid",icon:e.jsx(J,{}),loading:I,onClick:O,children:"Download PDF"}),e.jsx(T,{variant:"plain",icon:e.jsx(K,{}),loading:B,onClick:U,className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:"Delete"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Expense Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Project"}),e.jsxs("p",{className:"text-gray-900 dark:text-gray-100 font-medium",children:[((f=a.project)==null?void 0:f.projectName)||"N/A"," (",((k=a.project)==null?void 0:k.projectNumber)||"N/A",")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Created By"}),e.jsxs("p",{className:"text-gray-900 dark:text-gray-100 font-medium",children:[((v=a.createdBy)==null?void 0:v.firstName)||"Unknown"," ",((w=a.createdBy)==null?void 0:w.lastName)||""]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Created On"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 font-medium",children:a.createdAt?u(a.createdAt):"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Material Expenses"}),((D=a.materials)==null?void 0:D.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Invoice No"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Supplier"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount (AED)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Document"})]})}),e.jsxs("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:[a.materials.map((t,r)=>{const c=typeof t.amount=="number"?t.amount:0;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-gray-900 dark:text-gray-100",children:t._doc.description||"N/A"}),e.jsx("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:t._doc.date?u(t.date):"N/A"}),e.jsx("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:t._doc.invoiceNo||"N/A"}),e.jsx("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:t._doc.supplierName&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:t._doc.supplierName}),t._doc.supplierMobile&&e.jsx("p",{children:t._doc.supplierMobile}),t._doc.supplierEmail&&e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:t._doc.supplierEmail})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:c.toFixed(2)}),e.jsx("td",{className:"px-6 py-4",children:t._doc.documentUrl&&e.jsxs("a",{href:t._doc.documentUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(Q,{className:"mr-1"}),"View Document"]})})]},r)}),e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 font-semibold",children:[e.jsx("td",{colSpan:4,className:"px-6 py-4 text-right text-gray-900 dark:text-gray-100",children:"Total Material Cost:"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",colSpan:2,children:[p.toFixed(2)," AED"]})]})]})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No material expenses recorded"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Labor Details"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-gray-900 dark:text-gray-100",children:"Workers"}),((A=(E=a.laborDetails)==null?void 0:E.workers)==null?void 0:A.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Days Present"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Daily Salary"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total Salary"})]})}),e.jsxs("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:[a.laborDetails.workers.map((t,r)=>{var c,_,L;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[((c=t.user)==null?void 0:c.profileImage)&&e.jsx("img",{className:"h-10 w-10 rounded-full mr-3",src:t.user.profileImage,alt:`${t.user.firstName||""} ${t.user.lastName||""}`}),e.jsxs("div",{className:"text-gray-900 dark:text-gray-100",children:[((_=t.user)==null?void 0:_.firstName)||"Unknown"," ",((L=t.user)==null?void 0:L.lastName)||""]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:t.daysPresent||0}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:[(t.dailySalary||0).toFixed(2)," AED"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:[(t.totalSalary||0).toFixed(2)," AED"]})]},r)}),e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 font-semibold",children:[e.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-gray-900 dark:text-gray-100",children:"Total Workers Cost:"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:[a.laborDetails.workers.reduce((t,r)=>t+(r.totalSalary||0),0).toFixed(2)," AED"]})]})]})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No workers assigned"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-gray-900 dark:text-gray-100",children:"Driver"}),(S=a.laborDetails)!=null&&S.driver?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Days Present"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Daily Salary"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total Salary"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[((F=a.laborDetails.driver.user)==null?void 0:F.profileImage)&&e.jsx("img",{className:"h-10 w-10 rounded-full mr-3",src:a.laborDetails.driver.user.profileImage,alt:`${a.laborDetails.driver.user.firstName||""} ${a.laborDetails.driver.user.lastName||""}`}),e.jsxs("div",{className:"text-gray-900 dark:text-gray-100",children:[((C=a.laborDetails.driver.user)==null?void 0:C.firstName)||"Unknown"," ",((P=a.laborDetails.driver.user)==null?void 0:P.lastName)||""]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:a.laborDetails.driver.daysPresent||0}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:[(a.laborDetails.driver.dailySalary||0).toFixed(2)," AED"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:[(a.laborDetails.driver.totalSalary||0).toFixed(2)," AED"]})]})})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No driver assigned"})]}),e.jsx("div",{className:"mt-6 bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:"Total Labor Cost:"}),e.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:[m.toFixed(2)," AED"]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Expense Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Total Material Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200",children:[p.toFixed(2)," AED"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Total Labor Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-800 dark:text-purple-200",children:[m.toFixed(2)," AED"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Total Expense"}),e.jsxs("p",{className:"text-2xl font-bold text-green-800 dark:text-green-200",children:[j.toFixed(2)," AED"]})]}),a.quotation&&e.jsxs("div",{className:`p-4 rounded-lg ${x>=0?"bg-green-50 dark:bg-green-900/30":"bg-red-50 dark:bg-red-900/30"}`,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Quotation Amount"}),e.jsxs("p",{className:"text-lg font-bold text-gray-800 dark:text-gray-200",children:[i.toFixed(2)," AED"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Profit/Loss"}),e.jsxs("p",{className:`text-xl font-bold ${x>=0?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200"}`,children:[x.toFixed(2)," AED (",H.toFixed(2),"%)"]})]})]})]})]})]})};export{Ve as default};
