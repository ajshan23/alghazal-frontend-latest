import{j as e,m as A,r as o,v as K}from"./index-3DLZI4eB.js";import{A as P}from"./AdaptableCard-DUhwjOtA.js";import{B as $}from"./Button-C9ww9UOL.js";import{a4 as L,a0 as E,a5 as I}from"./index-CwjAikcA.js";import{A as M}from"./index-DPb5rspz.js";import{D as R}from"./DataTable-CU1UK92B.js";import{m as z}from"./index-VcVS_xjk.js";import{u as B}from"./useThemeClass-B_GK6Zwz.js";import{u as F}from"./useQuery-Dx8uzGh7.js";import{d as O}from"./debounce-CRGwQgqv.js";import{I as q}from"./Input-BCKKbbYo.js";import{d as H,f as _}from"./api-BArMaUSr.js";import{C as Q}from"./ConfirmDialog-C61REaHS.js";import{t as b,N as j}from"./toast-BKi6XR_M.js";import"./Alert-BJMUWgWX.js";import"./Badge-B2aEm3Jr.js";import"./Calendar-D9WkR1Rr.js";import"./Card-CF9KcGlH.js";import"./Skeleton-DYaberbX.js";import"./index-ao32mJN_.js";import"./Dialog-Crbi-7-g.js";import"./Drawer-CRdlTkRI.js";import"./index-ZVEP2S7b.js";import"./FormItem-BL-V7KWu.js";import"./useUniqueId-DI0oL57o.js";import"./index-D7-L48mv.js";import"./index-CeldJ5wE.js";import"./Progress-C0wqBKPQ.js";import"./index-BvIUGnE1.js";import"./ScrollBar-CvhjHryd.js";import"./index-FxzcmWEN.js";import"./Select-DbBYdRQK.js";import"./Upload-BGoPt-4d.js";import"./index-B2vv1dQX.js";import{T as U}from"./Tag-BEvWyzit.js";import"./index-wZuuJ2Y4.js";import"./context-DV85rUc2.js";import"./floating-ui.react-BR9Qsiv-.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-ejasuVWi.js";import"./proxy-h8u1Q_39.js";import"./index-CgdDCE4T.js";import"./Views-CKmk2VLX.js";import"./toString-Cp3uycBW.js";import"./StatusIcon-B68Axw2m.js";import"./CloseButton-wNJpnAMz.js";import"./chainedFunction-BxZSneMW.js";import"./useControllableState-P_D4vZ7w.js";import"./_getPrototype-BB9zh0H4.js";import"./index-DpelZirJ.js";import"./index-Chjiymov.js";import"./index-lyoTauZ5.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-DT5H6Lbl.js";const G=()=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:e.jsx(A,{className:"block lg:inline-block md:mb-0 mb-4",to:"/app/new-vehicle",children:e.jsx($,{block:!0,variant:"solid",size:"sm",icon:e.jsx(L,{}),children:"Add Vehicle"})})}),J=({isOpen:r,onClose:i,vehicle:a,refetch:l})=>{const[n,m]=o.useState(!1);if(!r||!a)return null;const h=async()=>{var d,c;m(!0);try{await H(a._id),l(),b.push(e.jsx(j,{title:`Vehicle "${a.vehicleNumber}" deleted`,type:"success",duration:2500,children:`${a.make} ${a.model} (${a.vehicleNumber}) has been successfully deleted.`}),{placement:"top-center"}),i()}catch(s){console.error("Delete failed:",s),b.push(e.jsx(j,{title:`Failed to delete vehicle "${a.vehicleNumber}"`,type:"danger",duration:2500,children:((c=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:c.message)||s.message||"Something went wrong"}),{placement:"top-center"})}finally{m(!1)}};return e.jsxs(Q,{isOpen:r,type:"danger",title:`Delete Vehicle "${a.vehicleNumber}"`,confirmButtonColor:"red-600",onClose:i,onRequestClose:i,onCancel:i,onConfirm:h,confirmButtonDisabled:n,children:[e.jsxs("p",{children:['Are you sure you want to delete the vehicle "',a.make," ",a.model,'" with registration number'," ",a.vehicleNumber,"? This action cannot be undone."]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"All associated records will also be removed."}),n&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},W=({row:r,onDeleteClick:i})=>{const{textTheme:a}=B(),l=K();return e.jsxs("div",{className:"flex text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${a}`,onClick:()=>l(`/app/new-vehicle/${r._id}`),children:e.jsx(E,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>i(r),children:e.jsx(I,{})})]})},X=({row:r})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{icon:e.jsx(z,{}),className:"bg-blue-100 text-blue-600 dark:bg-blue-500/20 dark:text-blue-100"}),e.jsxs("div",{className:"ml-2 rtl:mr-2",children:[e.jsx("span",{className:"font-semibold",children:r.vehicleNumber}),e.jsxs("div",{className:"text-xs",children:[r.make," ",r.model," (",r.year,")"]})]})]}),Y=()=>{var x,f;const r=o.useRef(null),[i,a]=o.useState(""),[l,n]=o.useState({page:1,limit:10}),[m,h]=o.useState(null),[d,c]=o.useState(!1),{data:s,isLoading:v,error:g,refetch:N}=F({queryKey:["vehicles",l.page,l.limit,i],queryFn:()=>_({page:l.page,limit:l.limit,search:i})}),y=((x=s==null?void 0:s.data)==null?void 0:x.vehicles)||[],u=((f=s==null?void 0:s.data)==null?void 0:f.pagination)||{total:0,page:1,limit:10,totalPages:1,hasNextPage:!1,hasPreviousPage:!1},D=o.useMemo(()=>O(t=>{a(t),n(p=>({...p,page:1}))},500),[]),w=t=>{D(t.target.value)},C=t=>{h(t),c(!0)},S=t=>{switch(t){case"active":return"bg-emerald-500";case"inactive":return"bg-amber-500";case"maintenance":return"bg-red-500";default:return"bg-gray-500"}},k=o.useMemo(()=>[{header:"Vehicle",accessorKey:"vehicleNumber",cell:t=>e.jsx(X,{row:t.row.original})},{header:"Type",accessorKey:"vehicleType",cell:t=>e.jsx("span",{className:"capitalize",children:t.row.original.vehicleType})},{header:"Color",accessorKey:"color",cell:t=>e.jsx("span",{className:"capitalize",children:t.row.original.color||"N/A"})},{header:"Registration",accessorKey:"registrationDate",cell:t=>e.jsx("span",{children:new Date(t.row.original.registrationDate).toLocaleDateString()})},{header:"Insurance Expiry",accessorKey:"insuranceExpiry",cell:t=>e.jsx("span",{children:new Date(t.row.original.insuranceExpiry).toLocaleDateString()})},{header:"Last Service Date",accessorKey:"lastServiceDate",cell:t=>e.jsx("span",{children:new Date(t.row.original.lastServiceDate).toLocaleDateString()})},{header:"Mileage",accessorKey:"currentMileage",cell:t=>e.jsxs("span",{children:[t.row.original.currentMileage.toLocaleString()," km"]})},{header:"Status",accessorKey:"status",cell:t=>e.jsx("div",{className:"mr-2 rtl:ml-2",children:e.jsx(U,{className:`text-white border-1 ${S(t.row.original.status)}`,children:t.row.original.status.toUpperCase()})})},{header:"Actions",id:"action",cell:t=>e.jsx(W,{row:t.row.original,onDeleteClick:C}),align:"right"}],[]),T=t=>{n(p=>({...p,page:t}))},V=t=>{n(p=>({page:1,limit:t}))};return g?e.jsxs("div",{children:["Error loading vehicles: ",g.message]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(q,{placeholder:"Search vehicles...",onChange:w,className:"max-w-md"})}),e.jsx(R,{ref:r,columns:k,data:y,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:v,pagingData:{total:u.total,pageIndex:u.page,pageSize:u.limit},onPaginationChange:T,onSelectChange:V}),e.jsx(J,{isOpen:d,onClose:()=>c(!1),vehicle:m,refetch:N})]})},et=()=>e.jsxs(P,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Vehicles"}),e.jsx(G,{to:"/app/vehicle-view",title:"Add Vehicle"})]}),e.jsx(Y,{})]});export{et as default};
