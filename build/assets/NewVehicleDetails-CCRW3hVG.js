import{r as f,j as e,b as o,v as R,ak as F}from"./index-Bb5hWms4.js";import{t as b,N as j}from"./toast-CpYugtuS.js";import{F as O,a as A,b as x}from"./formik.esm-lEj-AbBD.js";import{c as $,a as v,g as N,e as M,d as z}from"./index.esm-D-SZitWC.js";import"./Alert-Dugunmqe.js";import"./index-CUJxdyM4.js";import"./Badge-1rBRPyjl.js";import{B as C}from"./Button-CEPbL0Lb.js";import"./Calendar-D6hwXXzX.js";import"./Card-B8rHCzH9.js";import"./Skeleton-1b1THtL-.js";import{D as E}from"./index-i-B8EDNL.js";import"./Dialog-BD9Iq8Pi.js";import"./Drawer-bwHZPj3y.js";import"./index-xDZoWOTm.js";import{F as P,a as p}from"./FormItem-HvRvrzPo.js";import"./useUniqueId-BnEng_SK.js";import{I as y}from"./Input-Cko6IXRf.js";import"./index-BxyXzxfn.js";import"./index-D9ztJ0Q9.js";import"./Progress-odjwHsxt.js";import{R as k}from"./index-Dk7Y2OWs.js";import"./ScrollBar-BNcJtmRR.js";import"./index-C5YaGYnA.js";import{S as q}from"./Select-D7Yb2KL8.js";import"./Upload-VD0qPFFK.js";import"./index-D9qBG3Fu.js";import"./Tag-e5oFChya.js";import"./index-CDOucsrX.js";import{S as L}from"./StickyFooter-CVbtK3MQ.js";import{A as U}from"./index-BHiXAbZd.js";import{a5 as G}from"./index-DyZvV4US.js";import{C as H}from"./ConfirmDialog-DQueJXox.js";import{A as B}from"./AdaptableCard-CDzqb9V2.js";import"./Views-Dor-7I9u.js";import"./chart.config-YkJl3Uc_.js";import"./DataTable-DFljVjQc.js";import"./SvgIcon-A_UsLZ_J.js";import"./SegmentItemOption-Bzdg9gy2.js";import{a as Z,e as _,b as J}from"./api-DVrrJ9K-.js";import"./StatusIcon-Bp830_1A.js";import"./CloseButton-EGMOUB2z.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-BmbT6RnM.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-C0OdKYE1.js";import"./floating-ui.react-Ba33Pvev.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-lYREKt9z.js";import"./context-KCROMUm4.js";import"./useControllableState-LB_3bez6.js";import"./_getPrototype-BB6F7yg0.js";import"./index-BKRUeILu.js";import"./index-Chjiymov.js";import"./toString-C-FzytsZ.js";import"./index-D81fdFo4.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./index-DUSL2oPJ.js";import"./index-CxGBFu-E.js";import"./useThemeClass-DlW0H-Tq.js";const T=[{value:"car",label:"Car"},{value:"truck",label:"Truck"},{value:"van",label:"Van"},{value:"pickup",label:"Pickup"},{value:"motorcycle",label:"Motorcycle"},{value:"other",label:"Other"}],K=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Maintenance"}],w=new Date().getFullYear(),V=Array.from({length:30},(c,i)=>({value:w-i,label:(w-i).toString()})),I=f.forwardRef((c,i)=>{const{type:d,initialData:s={vehicleNumber:"",vehicleType:"car",make:"",model:"",year:null,color:"",registrationDate:new Date,insuranceExpiry:new Date,lastServiceDate:void 0,currentMileage:0,status:"active"},onFormSubmit:h,onDiscard:g,onDelete:D}=c,S=$().shape({vehicleNumber:v().required("Vehicle number is required").matches(/^[A-Z0-9]+$/,"Must be uppercase alphanumeric"),vehicleType:v().required("Vehicle type is required"),make:v().required("Make is required"),model:v().required("Model is required"),year:N().required("Year is required").min(1900,"Year must be after 1900").max(w+1,"Year can't be in the future"),color:v(),registrationDate:M().required("Registration date is required"),insuranceExpiry:M().required("Insurance expiry is required").min(z("registrationDate"),"Insurance expiry must be after registration date"),lastServiceDate:M().nullable(),currentMileage:N().min(0,"Mileage cannot be negative").integer("Mileage must be a whole number"),status:v().required("Status is required")});return e.jsx(O,{innerRef:i,initialValues:{...s,year:s.year||null,registrationDate:s.registrationDate?o(s.registrationDate).toDate():new Date,insuranceExpiry:s.insuranceExpiry?o(s.insuranceExpiry).toDate():new Date,lastServiceDate:s.lastServiceDate?o(s.lastServiceDate).toDate():void 0},validationSchema:S,onSubmit:async(r,{setSubmitting:a,setErrors:n})=>{try{if(!r.vehicleNumber||!r.vehicleType||!r.make||!r.model||!r.year||!r.registrationDate||!r.insuranceExpiry)throw new Error("Required fields are missing");const u={...r,registrationDate:o(r.registrationDate).format("YYYY-MM-DD"),insuranceExpiry:o(r.insuranceExpiry).format("YYYY-MM-DD"),lastServiceDate:r.lastServiceDate?o(r.lastServiceDate).format("YYYY-MM-DD"):void 0};await h(u,a)}catch(u){a(!1),b.push(e.jsx(j,{title:"Validation Error",type:"danger",duration:2500,children:u.message||"Please fill all required fields"}),{placement:"top-center"})}},enableReinitialize:!0,validateOnChange:!0,validateOnBlur:!0,children:({values:r,errors:a,touched:n,isSubmitting:u,setFieldValue:m})=>e.jsx(A,{children:e.jsxs(P,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(B,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Vehicle Information"}),e.jsx(p,{label:"Vehicle Number",invalid:!!(a.vehicleNumber&&n.vehicleNumber),errorMessage:a.vehicleNumber,children:e.jsx(x,{type:"text",autoComplete:"off",name:"vehicleNumber",placeholder:"Enter vehicle number",component:y,onChange:t=>{m("vehicleNumber",t.target.value.toUpperCase())}})}),e.jsx(p,{label:"Vehicle Type",invalid:!!(a.vehicleType&&n.vehicleType),errorMessage:a.vehicleType,children:e.jsx(q,{placeholder:"Select vehicle type",field:"vehicleType",options:T,value:T.find(t=>t.value===r.vehicleType),onChange:t=>m("vehicleType",t==null?void 0:t.value)})}),e.jsx(p,{label:"Make",invalid:!!(a.make&&n.make),errorMessage:a.make,children:e.jsx(x,{type:"text",autoComplete:"off",name:"make",placeholder:"Enter make",component:y})}),e.jsx(p,{label:"Model",invalid:!!(a.model&&n.model),errorMessage:a.model,children:e.jsx(x,{type:"text",autoComplete:"off",name:"model",placeholder:"Enter model",component:y})}),e.jsx(p,{label:"Year",invalid:!!(a.year&&n.year),errorMessage:a.year,children:e.jsx(q,{placeholder:"Select year",field:"year",options:V,value:r.year?V.find(t=>t.value===r.year):void 0,onChange:t=>m("year",t==null?void 0:t.value)})}),e.jsx(p,{label:"Color",invalid:!!(a.color&&n.color),errorMessage:a.color,children:e.jsx(x,{type:"text",autoComplete:"off",name:"color",placeholder:"Enter color",component:y})})]}),e.jsxs(B,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Registration & Status"}),e.jsx(p,{label:"Registration Date",invalid:!!(a.registrationDate&&n.registrationDate),errorMessage:a.registrationDate,children:e.jsx(E,{field:"registrationDate",placeholder:"Select registration date",value:r.registrationDate,onChange:t=>{t&&(m("registrationDate",t),r.insuranceExpiry&&o(t).isAfter(r.insuranceExpiry)&&m("insuranceExpiry",t))},maxDate:new Date})}),e.jsx(p,{label:"Insurance Expiry Date",invalid:!!(a.insuranceExpiry&&n.insuranceExpiry),errorMessage:a.insuranceExpiry,children:e.jsx(E,{field:"insuranceExpiry",placeholder:"Select insurance expiry date",value:r.insuranceExpiry,onChange:t=>{t&&m("insuranceExpiry",t)},minDate:r.registrationDate})}),e.jsx(p,{label:"Last Service Date",invalid:!!(a.lastServiceDate&&n.lastServiceDate),errorMessage:a.lastServiceDate,children:e.jsx(E,{field:"lastServiceDate",placeholder:"Select last service date",value:r.lastServiceDate,onChange:t=>{t&&m("lastServiceDate",t)},maxDate:new Date})}),e.jsx(p,{label:"Current Mileage (km)",invalid:!!(a.currentMileage&&n.currentMileage),errorMessage:a.currentMileage,children:e.jsx(x,{type:"number",autoComplete:"off",name:"currentMileage",placeholder:"Enter current mileage",component:y,min:0})}),e.jsx(p,{label:"Status",invalid:!!(a.status&&n.status),errorMessage:a.status,children:e.jsx(k.Group,{value:r.status,onChange:t=>m("status",t),children:K.map(t=>e.jsx(k,{value:t.value,children:t.label},t.value))})})]})]}),e.jsxs(L,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:d==="edit"&&D&&e.jsx(Q,{onDelete:D})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(C,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>g==null?void 0:g(),children:"Discard"}),e.jsx(C,{size:"sm",variant:"solid",loading:u,icon:e.jsx(U,{}),type:"submit",children:"Save"})]})]})]})})})});I.displayName="VehicleForm";const Q=({onDelete:c})=>{const[i,d]=f.useState(!1),s=()=>{d(!1),c==null||c(d)},h=()=>{d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(G,{}),type:"button",onClick:()=>d(!0),children:"Delete"}),e.jsxs(H,{isOpen:i,type:"danger",title:"Delete Vehicle",confirmButtonColor:"red-600",onClose:h,onRequestClose:h,onCancel:h,onConfirm:s,children:[e.jsx("p",{children:"Are you sure you want to delete this vehicle?"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"This action cannot be undone."})]})]})},W={vehicleNumber:"",vehicleType:"car",make:"",model:"",year:new Date().getFullYear(),color:"",registrationDate:new Date,insuranceExpiry:new Date,lastServiceDate:void 0,currentMileage:0,status:"active"},la=()=>{const c=R(),{id:i}=F(),[d,s]=f.useState(W),[h,g]=f.useState(!!i);f.useEffect(()=>{i&&(async()=>{try{const a=await Z(i);if(!a||!a.data)throw new Error("Invalid vehicle data");const n={...a.data,registrationDate:o(a.data.registrationDate).toDate(),insuranceExpiry:o(a.data.insuranceExpiry).toDate(),lastServiceDate:a.data.lastServiceDate?o(a.data.lastServiceDate).toDate():void 0};s(n),g(!1)}catch(a){console.error("Error fetching vehicle:",a),g(!1),b.push(e.jsx(j,{title:"Failed to fetch vehicle data",type:"danger",duration:2500,children:a.message||"Something went wrong"}),{placement:"top-center"}),c("/app/vehicles")}})()},[i,c]);const D=async(r,a)=>{var n,u,m,t;a(!0);try{let l;const Y={...r,registrationDate:o(r.registrationDate).format("YYYY-MM-DD"),insuranceExpiry:o(r.insuranceExpiry).format("YYYY-MM-DD"),lastServiceDate:r.lastServiceDate?o(r.lastServiceDate).format("YYYY-MM-DD"):void 0};if(i?l=await _(i,Y):l=await J(Y),l.statusCode===200||l.statusCode===201)a(!1),b.push(e.jsxs(j,{title:`Successfully ${i?"updated":"added"} vehicle`,type:"success",duration:2500,children:["Vehicle ",i?"updated":"added"," successfully"]}),{placement:"top-center"}),c("/app/vehicle-view");else throw new Error(((u=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:u.message)||"Unexpected status code")}catch(l){console.error("Error during form submission:",l),a(!1),b.push(e.jsx(j,{title:`Error ${i?"updating":"adding"} vehicle`,type:"danger",duration:2500,children:((t=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:t.message)||l.message}),{placement:"top-center"})}},S=()=>{c("/app/vehicles")};return h?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx(I,{type:i?"edit":"new",initialData:d,onFormSubmit:D,onDiscard:S})};export{la as default};
