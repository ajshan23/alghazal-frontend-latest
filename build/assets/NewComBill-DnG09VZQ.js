import{r as b,j as e,v as A,ak as T}from"./index-BxO48E7J.js";import{N as g,t as w}from"./toast-CyYsqkVZ.js";import{F as B,a as x}from"./FormItem-BHnkbcAj.js";import{B as C}from"./Button-Cqs6OGDK.js";import{S as E}from"./StickyFooter-BwF7du_M.js";import{F as I,a as O,b as j}from"./formik.esm-COq3CY63.js";import{A as k}from"./index-DYW3Y-VP.js";import{a0 as q}from"./index-BvMts2N3.js";import{c as R,b as S,g as V}from"./index.esm-B_aVpQ9s.js";import"./Alert-DAYHHcTG.js";import"./index-D65Or3wn.js";import"./Badge-BDINMpeU.js";import"./Calendar-CZCjMlL9.js";import"./Card-BkELxnQG.js";import"./Skeleton-UhY8bWTz.js";import{D as $}from"./index-CbDZljJP.js";import"./Dialog-Y-f76L7n.js";import"./Drawer-C4WNb_Rb.js";import"./index-DPk-9BZv.js";import"./useUniqueId-B5ZH9nmF.js";import{I as z}from"./Input-Bk_hBu-L.js";import"./index-CujXW8qQ.js";import"./index-DUubB36n.js";import"./Progress-B54yMz__.js";import"./index-ko3aNh7X.js";import"./ScrollBar-Dolz5Bqf.js";import"./index-BQv2iMDd.js";import{S as F}from"./Select-BKHxHb6S.js";import"./Upload-5TuzLRJ1.js";import"./index-Br-igED4.js";import"./Tag-oUmSLAu4.js";import"./index-DPAMRK6r.js";import{A as P}from"./AdaptableCard-DFT79cx9.js";import"./Views-DNvf1mRE.js";import"./chart.config-Dntevg-Q.js";import{C as H}from"./ConfirmDialog-wZKJ97Q_.js";import"./DataTable-BY0GTXYv.js";import"./SvgIcon-RMdG7_sD.js";import"./SegmentItemOption-BFgyQbW2.js";import{f as J,h as L,i as Q,j as U}from"./format-CZfo5T8Q.js";import"./StatusIcon-DL8X5trP.js";import"./CloseButton-C69hR3t8.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-Cgq6JklI.js";import"./context-BpXqFl7R.js";import"./index-C5P6Zpzc.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-Az_z3Foo.js";import"./floating-ui.react-BI-9OMXT.js";import"./floating-ui.dom-B_iSk-nO.js";import"./useControllableState-Z-hTdTNR.js";import"./_getPrototype-CXL19Th3.js";import"./index-mlsqo1Ee.js";import"./index-Chjiymov.js";import"./toString-DS3ZSNMT.js";import"./index-Ci8JUJEH.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-VwH9CKQD.js";import"./index-BOBJKlrD.js";import"./useThemeClass-CVckhmrY.js";const Y=new Date,N=[{label:"ADVANCE",value:"advance"},{label:"ADIB",value:"adib"},{label:"Cash",value:"cash"},{label:"MASHREQ CARD",value:"masherq_card"}],M=b.forwardRef((r,s)=>{const{type:l,initialData:n={billType:"commission",billDate:new Date().toISOString().split("T")[0],amount:"",paymentMethod:"cash"},onFormSubmit:c,onDiscard:p,onDelete:y}=r,f=R().shape({billDate:S().required("Date is required"),amount:V().typeError("Amount must be a number").required("Amount is required"),paymentMethod:S().required("Payment method is required")});return e.jsx(I,{innerRef:s,initialValues:{...n,billType:n.billType||"commission",billDate:n.billDate||new Date().toISOString().split("T")[0],amount:n.amount??"",paymentMethod:n.paymentMethod||"cash"},validationSchema:f,onSubmit:async(u,{setSubmitting:h})=>{const i=new FormData;i.append("billType",u.billType),i.append("billDate",u.billDate),i.append("amount",u.amount.toString()),i.append("paymentMethod",u.paymentMethod),await c(i,h)},enableReinitialize:!0,children:({values:u,touched:h,errors:i,isSubmitting:a,setFieldValue:v})=>e.jsx(O,{children:e.jsxs(B,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(P,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Commission Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{label:"Bill Type",children:e.jsx(j,{name:"billType",children:({field:o,form:m})=>e.jsx(F,{options:[{label:"Commission",value:"commission"}],value:{label:"Commission",value:"commission"},onChange:t=>m.setFieldValue(o.name,t==null?void 0:t.value),isDisabled:l==="edit"})})}),e.jsx(x,{label:"Date",invalid:!!i.billDate&&h.billDate,children:e.jsx(j,{name:"billDate",children:({field:o,form:m})=>e.jsx($,{placeholder:"Select Date",value:o.value?new Date(o.value):null,maxDate:Y,onChange:t=>m.setFieldValue(o.name,t?J(new Date(t.getFullYear(),t.getMonth(),t.getDate()),"yyyy-MM-dd"):"")})})}),e.jsx(x,{label:"Amount",invalid:!!i.amount&&h.amount,errorMessage:i.amount,children:e.jsx(j,{name:"amount",children:({field:o,form:m})=>e.jsx(z,{type:"number",autoComplete:"off",placeholder:"Amount",...o,onChange:t=>m.setFieldValue(o.name,t.target.value)})})}),e.jsx(x,{label:"Payment Method",invalid:!!i.paymentMethod&&h.paymentMethod,errorMessage:i.paymentMethod,children:e.jsx(j,{name:"paymentMethod",children:({field:o,form:m})=>e.jsx(F,{options:N,value:N.find(t=>t.value===o.value),onChange:t=>m.setFieldValue(o.name,t==null?void 0:t.value)})})})]})]})})}),e.jsxs(E,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:l==="edit"&&y&&e.jsx(_,{onDelete:y})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(C,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>p==null?void 0:p(),children:"Discard"}),e.jsx(C,{size:"sm",variant:"solid",loading:a,icon:e.jsx(k,{}),type:"submit",children:"Save"})]})]})]})})})});M.displayName="CommissionBillForm";const _=({onDelete:r})=>{const[s,l]=b.useState(!1),n=()=>{l(!1),r==null||r(l)},c=()=>{l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(q,{}),type:"button",onClick:()=>l(!0),children:"Delete"}),e.jsx(H,{isOpen:s,type:"danger",title:"Delete Commission Entry",confirmButtonColor:"red-600",onClose:c,onRequestClose:c,onCancel:c,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this commission entry?"})})]})},D={billType:"commission",billDate:new Date().toISOString().split("T")[0],amount:""},it=()=>{const r=A(),{id:s}=T(),[l,n]=b.useState(D),[c,p]=b.useState(!!s),[y,f]=b.useState(null);b.useEffect(()=>{if(!s){n(D),p(!1);return}(async()=>{try{p(!0);const a=await L(s);if(!(a!=null&&a.data))throw new Error("Invalid bill data received");n({billType:a.data.billType||"commission",billDate:a.data.billDate||D.billDate,amount:a.data.amount||""}),f(null)}catch(a){console.error("Error fetching bill:",a),f(a.message||"Failed to load bill data"),w.push(e.jsx(g,{title:"Failed to fetch commission data",type:"danger",duration:2500,children:a.message||"Something went wrong"}),{placement:"top-center"}),setTimeout(()=>r("/app/commission-bill-view"),2500)}finally{p(!1)}})()},[s,r]);const u=async(i,a)=>{var v,o,m,t;try{a(!0);const d=s?await Q(s,i):await U(i);if([200,201].includes(d.status))w.push(e.jsxs(g,{title:`Successfully ${s?"updated":"added"} commission bill`,type:"success",duration:2500,children:["Commission bill ",s?"updated":"added"," successfully"]}),{placement:"top-center"}),r("/app/commission-bill-view");else throw new Error(((o=(v=d==null?void 0:d.response)==null?void 0:v.data)==null?void 0:o.message)||"Unexpected status code")}catch(d){console.error("Error during form submission:",d),w.push(e.jsx(g,{title:`Error ${s?"updating":"adding"} commission bill`,type:"danger",duration:2500,children:((t=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:t.message)||d.message}),{placement:"top-center"})}finally{a(!1)}},h=()=>{JSON.stringify(l)!==JSON.stringify(D)?window.confirm("Are you sure you want to discard changes?")&&r("/app/commission-bill-view"):r("/app/commission-bill-view")};return c?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):y?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(g,{title:"Error loading commission",type:"danger",children:y})}):e.jsx(M,{type:s?"edit":"new",initialData:l,onFormSubmit:u,onDiscard:h})};export{it as default};
