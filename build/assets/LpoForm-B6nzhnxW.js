import{r as N,j as e,ak as O,v as k,u as S}from"./index-D5qsHBPI.js";import{a as p,F as D}from"./FormItem-BjAM8sYA.js";import{b as U,B as u}from"./Button-DKlp8XN1.js";import{a as E,u as $}from"./useControllableState-OCPLuC6T.js";import{u as z,D as A}from"./index-BO9RL4R9.js";import{u as M}from"./floating-ui.react-CtRk2jQd.js";import{u as R,a as V}from"./index-DJHxYRo4.js";import{u as B}from"./StatusIcon-B-JCnJup.js";import{u as G}from"./useUniqueId-CheqgfIm.js";import{u as Q}from"./Dialog-Dhhpr09S.js";import{S as T}from"./StickyFooter-D7xjDOAW.js";import{C as J}from"./ConfirmDialog-DxnrbsV4.js";import{b as j,F as H,a as W}from"./formik.esm-XpKb_I1k.js";import{A as Y}from"./AdaptableCard-UKh7K-Hq.js";import{I as f}from"./Input-DpzrnPB-.js";import"./Alert-C5ubLdhu.js";import"./index-BVZVTO7z.js";import"./Badge-Dxo-y_KI.js";import"./Calendar-DWCnCoFE.js";import"./Card-yHUwp5an.js";import"./Skeleton-Dmiutfuv.js";import"./Drawer-BUEyqvQR.js";import"./index-QOERWN9e.js";import"./index-CPVaYfOj.js";import{t as b,N as y}from"./toast-BV-KR3on.js";import"./Progress-DzB5YKhk.js";import"./index-CrE-Oq-m.js";import"./ScrollBar-BNGPRGE7.js";import"./index-sVsNsozN.js";import"./Select-DCy0le_o.js";import{U as Z}from"./Upload-B1VqOR8x.js";import"./index-WwDzlDyh.js";import"./Tag-DuBUDIYz.js";import"./index-DmRycXSQ.js";import{Y as w,Z as K}from"./index-Bjc1-Dfl.js";import{D as X}from"./DoubleSidedImage-CpTRuTy8.js";import{A as _}from"./index-DKTyA8Td.js";import{c as q,a as g,f as L,g as I}from"./index.esm-D0L8hc4Y.js";import{c as ee,u as te,d as se}from"./api-CWO4EWxs.js";import"./index-CKN0MgBz.js";import"./proxy-QQ9UH2Rr.js";import"./CloseButton-CYqIcWKK.js";import"./floating-ui.dom-D1IisfOw.js";import"./isNil-BKogIPw7.js";import"./chainedFunction-BxZSneMW.js";import"./toString-kQNaAZON.js";import"./Views-B1b09e4F.js";import"./index-BKrnPZdN.js";import"./index-Chjiymov.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-CTX8E6kM.js";import"./get-BV5slyYd.js";import"./_getPrototype-07QB_bHq.js";import"./index-byIxUKR0.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./index-C6AW9Bce.js";const re={useCallbackRef:E,useColorLevel:U,useControllableState:$,useDidUpdate:z,useMergeRef:M,useRootClose:R,useTimeout:B,useUncertainRef:V,useUniqueId:G,useWindowSize:Q},ie=v=>{const{touched:c,errors:n,values:l}=v,[P,d]=N.useState([]),h=s=>{let r=!0;const t=["application/pdf","image/jpeg","image/png","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],o=10*1024*1024;if(s)for(let a=0;a<s.length;a++){if(!t.includes(s[a].type)){r="Please upload a PDF, Excel, JPEG, or PNG file!";break}if(s[a].size>=o){r="File size cannot be more than 10MB!";break}}return r},i=(s,r,t,o)=>{t.length>0&&(o(r.name,t),d(t.map(a=>URL.createObjectURL(a))))},x=(s,r,t)=>{const o=[...r.documents];o.splice(s,1),t("documents",o);const a=[...P];a.splice(s,1),d(a)},F=(s,r)=>{const t=[...s.items,{description:"",quantity:0,unitPrice:0}];r("items",t)},C=(s,r,t)=>{const o=[...r.items];o.splice(s,1),t("items",o)};return e.jsxs(Y,{divider:!0,className:"mb-4",children:[e.jsx("h5",{children:"LPO Information"}),e.jsx("p",{className:"mb-6",children:"Section to enter LPO details"}),e.jsx(p,{label:"LPO Number",invalid:n.lpoNumber&&c.lpoNumber,errorMessage:n.lpoNumber,children:e.jsx(j,{type:"text",autoComplete:"off",name:"lpoNumber",placeholder:"Enter LPO Number",component:f})}),e.jsx(p,{label:"LPO Date",invalid:n.lpoDate&&c.lpoDate,errorMessage:n.lpoDate,children:e.jsx(j,{name:"lpoDate",children:({field:s,form:r})=>e.jsx(A,{placeholder:"Select date",...s,onChange:t=>{r.setFieldValue(s.name,t)}})})}),e.jsx(p,{label:"Supplier",invalid:n.supplier&&c.supplier,errorMessage:n.supplier,children:e.jsx(j,{type:"text",autoComplete:"off",name:"supplier",placeholder:"Enter supplier name",component:f})}),e.jsx(p,{label:"Attach Documents",invalid:n.documents&&c.documents,errorMessage:n.documents,children:e.jsx(j,{name:"documents",children:({field:s,form:r})=>e.jsxs("div",{children:[e.jsx(Z,{beforeUpload:h,showList:!1,multiple:!0,onChange:t=>i(r,s,t,r.setFieldValue),children:e.jsxs("div",{className:"my-4 text-center",children:[e.jsx(X,{className:"mx-auto",src:"/img/others/upload.png",darkModeSrc:"/img/others/upload-dark.png"}),e.jsxs("p",{className:"font-semibold",children:[e.jsxs("span",{className:"text-gray-800 dark:text-white",children:["Drop your files here, or"," "]}),e.jsx("span",{className:"text-blue-500",children:"browse"})]}),e.jsx("p",{className:"mt-1 opacity-60 dark:text-white",children:"Support: PDF, Excel, JPEG, PNG (Max 10MB each)"})]})}),l.documents.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:l.documents.map((t,o)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx(u,{icon:e.jsx(w,{}),variant:"plain",size:"xs",type:"button",onClick:()=>x(o,l,r.setFieldValue)})]},o))})]})})}),e.jsx(p,{label:"Items",invalid:n.items&&c.items,errorMessage:n.items,children:e.jsx(j,{name:"items",children:({field:s,form:r})=>e.jsxs("div",{className:"space-y-4",children:[l.items.map((t,o)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end border p-4 rounded-lg",children:[e.jsx("div",{className:"col-span-5",children:e.jsx(p,{label:`Item ${o+1} - Description`,className:"mb-0",children:e.jsx(f,{type:"text",autoComplete:"off",name:`items.${o}.description`,placeholder:"Item description",value:t.description,onChange:a=>{const m=[...l.items];m[o].description=a.target.value,r.setFieldValue("items",m)}})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(p,{label:"Quantity",className:"mb-0",children:e.jsx(f,{type:"number",min:"0",autoComplete:"off",name:`items.${o}.quantity`,placeholder:"Qty",value:t.quantity,onChange:a=>{const m=[...l.items];m[o].quantity=Number(a.target.value),r.setFieldValue("items",m)}})})}),e.jsx("div",{className:"col-span-3",children:e.jsx(p,{label:"Unit Price",className:"mb-0",children:e.jsx(f,{type:"number",min:"0",step:"0.01",autoComplete:"off",name:`items.${o}.unitPrice`,placeholder:"Price",value:t.unitPrice,onChange:a=>{const m=[...l.items];m[o].unitPrice=Number(a.target.value),r.setFieldValue("items",m)}})})}),e.jsx("div",{className:"col-span-2 flex justify-end",children:l.items.length>1&&e.jsx(u,{icon:e.jsx(w,{}),variant:"plain",size:"sm",type:"button",onClick:()=>C(o,l,r.setFieldValue)})})]},o)),e.jsx(u,{icon:e.jsx(K,{}),variant:"plain",size:"sm",type:"button",onClick:()=>F(l,r.setFieldValue),children:"Add Item"})]})})})]})},{useUniqueId:oe}=re,ae=q().shape({lpoNumber:g().required("LPO Number is required"),lpoDate:g().required("LPO Date is required"),supplier:g().required("Supplier is required"),items:L().of(q().shape({description:g().required("Description is required"),quantity:I().required("Quantity is required").min(1,"Quantity must be at least 1"),unitPrice:I().required("Unit price is required").min(0,"Unit price cannot be negative")})).min(1,"At least one item is required"),documents:L().min(1,"At least one document is required").required("Documents are required")}),ne=N.forwardRef((v,c)=>{const{projectId:n}=O(),l=k();S(s=>{var r;return(r=s.auth.user)==null?void 0:r.id});const[P,d]=N.useState(!1),{type:h="new",initialData:i,onDiscard:x}=v;N.useEffect(()=>{(!n||n.length===0)&&l("/")},[]),oe("lpo-");const F=async(s,r)=>{r(!0);try{const t=new FormData;t.append("projectId",s.projectId),t.append("lpoNumber",s.lpoNumber),t.append("lpoDate",s.lpoDate),t.append("supplier",s.supplier),t.append("items",JSON.stringify(s.items)),s.documents.forEach(a=>{t.append("documents",a)});let o;h==="new"?(o=await ee(t),b.push(e.jsx(y,{title:"LPO created successfully",type:"success"}),{placement:"top-center"})):(o=await te(s.id,t),b.push(e.jsx(y,{title:"LPO updated successfully",type:"success"}),{placement:"top-center"})),l(`/app/project-view/${n}`)}catch(t){console.error("Error submitting LPO:",t),b.push(e.jsx(y,{title:"Failed to save LPO",type:"danger"}),{placement:"top-center"})}finally{r(!1)}},C=async()=>{try{if(!(i!=null&&i.id))return;await se(i.id),b.push(e.jsx(y,{title:"LPO deleted successfully",type:"success"}),{placement:"top-center"}),l(`/projects/${n}/lpos`)}catch{b.push(e.jsx(y,{title:"Failed to delete LPO",type:"danger"}),{placement:"top-center"})}};return e.jsx(e.Fragment,{children:e.jsx(H,{innerRef:c,initialValues:{id:(i==null?void 0:i.id)||"",projectId:(i==null?void 0:i.projectId)||n||"",lpoNumber:(i==null?void 0:i.lpoNumber)||"",lpoDate:(i==null?void 0:i.lpoDate)||"",supplier:(i==null?void 0:i.supplier)||"",items:(i==null?void 0:i.items)||[{description:"",quantity:0,unitPrice:0}],documents:(i==null?void 0:i.documents)||[]},validationSchema:ae,onSubmit:(s,{setSubmitting:r})=>{F(s,r)},children:({values:s,touched:r,errors:t,isSubmitting:o})=>e.jsx(W,{children:e.jsxs(D,{children:[e.jsx(ie,{touched:r,errors:t,values:s}),e.jsxs(T,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:h==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(w,{}),type:"button",onClick:()=>d(!0),children:"Delete"}),e.jsx(J,{isOpen:P,type:"danger",title:"Delete LPO",confirmButtonColor:"red-600",onClose:()=>d(!1),onRequestClose:()=>d(!1),onCancel:()=>d(!1),onConfirm:C,children:e.jsx("p",{children:"Are you sure you want to delete this LPO? This action cannot be undone."})})]})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(u,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>x==null?void 0:x(),children:"Discard"}),e.jsx(u,{size:"sm",variant:"solid",loading:o,icon:e.jsx(_,{}),type:"submit",children:h==="new"?"Create":"Save"})]})]})]})})})})});ne.displayName="LpoForm";export{ne as default};
