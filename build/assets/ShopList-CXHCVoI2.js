import{j as e,m as A,r as i,v as T}from"./index-BxO48E7J.js";import{A as K}from"./AdaptableCard-DFT79cx9.js";import{B as I}from"./Button-Cqs6OGDK.js";import{$ as E,I as O,X as $,a0 as M}from"./index-BvMts2N3.js";import{D as P}from"./DataTable-BY0GTXYv.js";import{u as B}from"./useThemeClass-CVckhmrY.js";import{u as H}from"./useQuery-D9PWsr8U.js";import{d as R}from"./debounce-Dl_R0PA7.js";import{I as q}from"./Input-Bk_hBu-L.js";import{d as F,f as L}from"./api-X_PveBRC.js";import{h as _}from"./moment-C5S46NFB.js";import{C as z}from"./ConfirmDialog-wZKJ97Q_.js";import{t as j,N as b}from"./toast-CyYsqkVZ.js";import"./Card-BkELxnQG.js";import"./context-BpXqFl7R.js";import"./index-Br-igED4.js";import"./index-VwH9CKQD.js";import"./Skeleton-UhY8bWTz.js";import"./Views-DNvf1mRE.js";import"./_getPrototype-CXL19Th3.js";import"./Select-BKHxHb6S.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-Az_z3Foo.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-BOBJKlrD.js";import"./toString-DS3ZSNMT.js";import"./index-D65Or3wn.js";import"./floating-ui.react-BI-9OMXT.js";import"./index-C5P6Zpzc.js";import"./proxy-Cgq6JklI.js";import"./Dialog-Y-f76L7n.js";import"./index-mlsqo1Ee.js";import"./index-Chjiymov.js";import"./CloseButton-C69hR3t8.js";import"./StatusIcon-DL8X5trP.js";import"./chainedFunction-BxZSneMW.js";const Y=()=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:e.jsx(A,{className:"block lg:inline-block md:mb-0 mb-4",to:"/app/new-shop",children:e.jsx(I,{block:!0,variant:"solid",size:"sm",icon:e.jsx(E,{}),children:"Add Shops"})})}),Q=({isOpen:r,onClose:a,shopId:n,shopName:t,refetch:c})=>{const[m,p]=i.useState(!1);if(!r||!n)return null;const u=async()=>{var d,o;p(!0);try{await F(n),c(),j.push(e.jsx(b,{title:"Shop deleted",type:"success",duration:2500,children:"The shop has been successfully deleted."}),{placement:"top-center"}),a()}catch(l){console.error("Delete failed:",l),j.push(e.jsx(b,{title:"Failed to delete shop",type:"danger",duration:2500,children:((o=(d=l==null?void 0:l.response)==null?void 0:d.data)==null?void 0:o.message)||l.message||"Something went wrong"}),{placement:"top-center"})}finally{p(!1)}};return e.jsxs(z,{isOpen:r,type:"danger",title:"Delete Shop",confirmButtonColor:"red-600",onClose:a,onRequestClose:a,onCancel:a,onConfirm:u,confirmButtonDisabled:m,children:[e.jsxs("p",{children:["Are you sure you want to delete",t?` the shop "${t}"`:" this shop","? This action cannot be undone."]}),m&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},V=({row:r,onDeleteClick:a})=>{const{textTheme:n}=B(),t=T();return e.jsxs("div",{className:"flex justify-end text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${n}`,onClick:()=>t(`/app/shop-details/${r._id}`),children:e.jsx(O,{})}),e.jsx("span",{className:`cursor-pointer p-2 hover:${n}`,onClick:()=>t(`/app/new-shop/${r._id}`),children:e.jsx($,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>a(r._id),children:e.jsx(M,{})})]})},X=()=>{var x,f;const r=i.useRef(null),[a,n]=i.useState(""),[t,c]=i.useState({page:1,limit:10}),[m,p]=i.useState(!1),[u,d]=i.useState(null),{data:o,isLoading:l,error:G,refetch:y}=H({queryKey:["shops",t.page,t.limit,a],queryFn:()=>L({page:t.page,limit:t.limit,search:a})}),S=((x=o==null?void 0:o.data)==null?void 0:x.shops)||[],g=((f=o==null?void 0:o.data)==null?void 0:f.pagination)||{total:0,page:1,limit:10},N=i.useMemo(()=>R(s=>{n(s),c(h=>({...h,page:1}))},500),[]),w=s=>{N(s.target.value)},C=s=>{d(s),p(!0)},v=i.useMemo(()=>[{header:"Name",accessorKey:"shopName",cell:s=>e.jsx("span",{children:s.row.original.shopName})},{header:"Number",accessorKey:"shopNo",cell:s=>e.jsx("span",{children:s.row.original.shopNo})},{header:"Address",accessorKey:"address",cell:s=>e.jsx("span",{children:s.row.original.address})},{header:"VAT",accessorKey:"vat",cell:s=>e.jsx("span",{children:s.row.original.vat})},{header:"Owner",accessorKey:"ownerName",cell:s=>e.jsx("span",{children:s.row.original.ownerName})},{header:"Email",accessorKey:"ownerEmail",cell:s=>e.jsx("span",{children:s.row.original.ownerEmail})},{header:"Contact",accessorKey:"contact",cell:s=>e.jsx("span",{children:s.row.original.contact})},{header:"Date",accessorKey:"createdAt",cell:s=>e.jsx("span",{children:_(s.row.original.createdAt).format("DD MMM YY")})},{header:"Action",id:"action",cell:s=>e.jsx(V,{row:s.row.original,onDeleteClick:C})}],[]),D=s=>{c(h=>({...h,page:s}))},k=s=>{c(h=>({page:1,limit:s}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(q,{placeholder:"Search shops...",onChange:w,className:"max-w-md"})}),e.jsx(P,{ref:r,columns:v,data:S,skeletonAvatarColumns:[0,3,4],skeletonAvatarProps:{className:"rounded-md"},loading:l,pagingData:{total:g.total,pageIndex:g.page,pageSize:g.limit},onPaginationChange:D,onSelectChange:k}),e.jsx(Q,{isOpen:m,onClose:()=>p(!1),shopId:u,refetch:y})]})},Oe=()=>e.jsxs(K,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Shops "}),e.jsx(Y,{})]}),e.jsx(X,{})]});export{Oe as default};
