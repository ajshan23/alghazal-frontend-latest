import{j as e,m as A,r as i,v as T}from"./index-Bb5hWms4.js";import{A as K}from"./AdaptableCard-CDzqb9V2.js";import{B as P}from"./Button-CEPbL0Lb.js";import{a4 as I,O,a0 as E,a5 as M}from"./index-DyZvV4US.js";import{D as $}from"./DataTable-DFljVjQc.js";import{u as B}from"./useThemeClass-DlW0H-Tq.js";import{u as H}from"./useQuery-CHL8T0Ye.js";import{d as R}from"./debounce-CwggmGx4.js";import{I as q}from"./Input-Cko6IXRf.js";import{d as F,f as L}from"./api-BTW-EEen.js";import{h as _}from"./moment-C5S46NFB.js";import{C as z}from"./ConfirmDialog-DQueJXox.js";import{t as j,N as b}from"./toast-CpYugtuS.js";import"./Card-B8rHCzH9.js";import"./context-KCROMUm4.js";import"./index-D9qBG3Fu.js";import"./index-DUSL2oPJ.js";import"./Skeleton-1b1THtL-.js";import"./Views-Dor-7I9u.js";import"./_getPrototype-BB6F7yg0.js";import"./Select-D7Yb2KL8.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-C0OdKYE1.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-CxGBFu-E.js";import"./toString-C-FzytsZ.js";import"./index-CUJxdyM4.js";import"./floating-ui.react-Ba33Pvev.js";import"./index-lYREKt9z.js";import"./proxy-BmbT6RnM.js";import"./Dialog-BD9Iq8Pi.js";import"./index-BKRUeILu.js";import"./index-Chjiymov.js";import"./CloseButton-EGMOUB2z.js";import"./StatusIcon-Bp830_1A.js";import"./chainedFunction-BxZSneMW.js";const Y=()=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:e.jsx(A,{className:"block lg:inline-block md:mb-0 mb-4",to:"/app/new-shop",children:e.jsx(P,{block:!0,variant:"solid",size:"sm",icon:e.jsx(I,{}),children:"Add Shops"})})}),Q=({isOpen:r,onClose:t,shopId:n,shopName:a,refetch:c})=>{const[m,p]=i.useState(!1);if(!r||!n)return null;const u=async()=>{var d,o;p(!0);try{await F(n),c(),j.push(e.jsx(b,{title:"Shop deleted",type:"success",duration:2500,children:"The shop has been successfully deleted."}),{placement:"top-center"}),t()}catch(l){console.error("Delete failed:",l),j.push(e.jsx(b,{title:"Failed to delete shop",type:"danger",duration:2500,children:((o=(d=l==null?void 0:l.response)==null?void 0:d.data)==null?void 0:o.message)||l.message||"Something went wrong"}),{placement:"top-center"})}finally{p(!1)}};return e.jsxs(z,{isOpen:r,type:"danger",title:"Delete Shop",confirmButtonColor:"red-600",onClose:t,onRequestClose:t,onCancel:t,onConfirm:u,confirmButtonDisabled:m,children:[e.jsxs("p",{children:["Are you sure you want to delete",a?` the shop "${a}"`:" this shop","? This action cannot be undone."]}),m&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},V=({row:r,onDeleteClick:t})=>{const{textTheme:n}=B(),a=T();return e.jsxs("div",{className:"flex justify-end text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${n}`,onClick:()=>a(`/app/shop-details/${r._id}`),children:e.jsx(O,{})}),e.jsx("span",{className:`cursor-pointer p-2 hover:${n}`,onClick:()=>a(`/app/new-shop/${r._id}`),children:e.jsx(E,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>t(r._id),children:e.jsx(M,{})})]})},G=()=>{var x,f;const r=i.useRef(null),[t,n]=i.useState(""),[a,c]=i.useState({page:1,limit:10}),[m,p]=i.useState(!1),[u,d]=i.useState(null),{data:o,isLoading:l,error:J,refetch:y}=H({queryKey:["shops",a.page,a.limit,t],queryFn:()=>L({page:a.page,limit:a.limit,search:t})}),N=((x=o==null?void 0:o.data)==null?void 0:x.shops)||[],g=((f=o==null?void 0:o.data)==null?void 0:f.pagination)||{total:0,page:1,limit:10,totalPages:1,hasNextPage:!1,hasPreviousPage:!1},S=i.useMemo(()=>R(s=>{n(s),c(h=>({...h,page:1}))},500),[]),w=s=>{S(s.target.value)},C=s=>{d(s),p(!0)},v=i.useMemo(()=>[{header:"Name",accessorKey:"shopName",cell:s=>e.jsx("span",{children:s.row.original.shopName})},{header:"Number",accessorKey:"shopNo",cell:s=>e.jsx("span",{children:s.row.original.shopNo})},{header:"Address",accessorKey:"address",cell:s=>e.jsx("span",{children:s.row.original.address})},{header:"VAT",accessorKey:"vat",cell:s=>e.jsx("span",{children:s.row.original.vat})},{header:"Owner",accessorKey:"ownerName",cell:s=>e.jsx("span",{children:s.row.original.ownerName})},{header:"Email",accessorKey:"ownerEmail",cell:s=>e.jsx("span",{children:s.row.original.ownerEmail})},{header:"Contact",accessorKey:"contact",cell:s=>e.jsx("span",{children:s.row.original.contact})},{header:"Date",accessorKey:"createdAt",cell:s=>e.jsx("span",{children:_(s.row.original.createdAt).format("DD MMM YY")})},{header:"Action",id:"action",cell:s=>e.jsx(V,{row:s.row.original,onDeleteClick:C})}],[]),D=s=>{c(h=>({...h,page:s}))},k=s=>{c(h=>({page:1,limit:s}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(q,{placeholder:"Search shops...",onChange:w,className:"max-w-md"})}),e.jsx($,{ref:r,columns:v,data:N,skeletonAvatarColumns:[0,3,4],skeletonAvatarProps:{className:"rounded-md"},loading:l,pagingData:{total:g.total,pageIndex:g.page,pageSize:g.limit},onPaginationChange:D,onSelectChange:k}),e.jsx(Q,{isOpen:m,onClose:()=>p(!1),shopId:u,refetch:y})]})},Oe=()=>e.jsxs(K,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Shops "}),e.jsx(Y,{})]}),e.jsx(G,{})]});export{Oe as default};
