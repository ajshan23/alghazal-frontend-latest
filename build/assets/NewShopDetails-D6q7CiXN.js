import{r as v,j as e,v as M,ak as R}from"./index-Bb5hWms4.js";import{t as S,N as C}from"./toast-CpYugtuS.js";import{F as T,a as h}from"./FormItem-HvRvrzPo.js";import{B as F}from"./Button-CEPbL0Lb.js";import{S as z}from"./StickyFooter-CVbtK3MQ.js";import{F as $,a as V,b as g}from"./formik.esm-lEj-AbBD.js";import{A as P}from"./index-BHiXAbZd.js";import{a5 as D}from"./index-DyZvV4US.js";import{c as U,a as b}from"./index.esm-D-SZitWC.js";import"./Alert-Dugunmqe.js";import"./index-CUJxdyM4.js";import"./Badge-1rBRPyjl.js";import"./Calendar-D6hwXXzX.js";import"./Card-B8rHCzH9.js";import"./Skeleton-1b1THtL-.js";import"./index-i-B8EDNL.js";import"./Dialog-BD9Iq8Pi.js";import"./Drawer-bwHZPj3y.js";import"./index-xDZoWOTm.js";import"./useUniqueId-BnEng_SK.js";import{I as j}from"./Input-Cko6IXRf.js";import"./index-BxyXzxfn.js";import"./index-D9ztJ0Q9.js";import"./Progress-odjwHsxt.js";import"./index-Dk7Y2OWs.js";import"./ScrollBar-BNcJtmRR.js";import"./index-C5YaGYnA.js";import"./Select-D7Yb2KL8.js";import"./Upload-VD0qPFFK.js";import"./index-D9qBG3Fu.js";import"./Tag-e5oFChya.js";import"./index-CDOucsrX.js";import{A as E}from"./AdaptableCard-CDzqb9V2.js";import"./Views-Dor-7I9u.js";import"./chart.config-YkJl3Uc_.js";import{C as H}from"./ConfirmDialog-DQueJXox.js";import"./DataTable-DFljVjQc.js";import"./SvgIcon-A_UsLZ_J.js";import"./SegmentItemOption-Bzdg9gy2.js";import{a as L,e as _,b as G}from"./api-BTW-EEen.js";import"./StatusIcon-Bp830_1A.js";import"./CloseButton-EGMOUB2z.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-BmbT6RnM.js";import"./context-KCROMUm4.js";import"./index-lYREKt9z.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-C0OdKYE1.js";import"./floating-ui.react-Ba33Pvev.js";import"./floating-ui.dom-D1IisfOw.js";import"./useControllableState-LB_3bez6.js";import"./_getPrototype-BB6F7yg0.js";import"./index-BKRUeILu.js";import"./index-Chjiymov.js";import"./toString-C-FzytsZ.js";import"./index-D81fdFo4.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./index-DUSL2oPJ.js";import"./index-CxGBFu-E.js";import"./useThemeClass-DlW0H-Tq.js";const q=v.forwardRef((m,o)=>{const{type:d,initialData:r={shopName:"",shopNo:"",address:"",vat:"",ownerName:"",ownerEmail:"",contact:"",shopAttachments:[]},onFormSubmit:u,onDiscard:w,onDelete:A}=m,[f,x]=v.useState([]);v.useEffect(()=>{r.shopAttachments&&x(r.shopAttachments)},[r]);const a=U().shape({shopName:b().required("Shop Name is required"),shopNo:b().required("Shop Number is required"),address:b().required("Address is required"),vat:b().required("VAT is required"),ownerName:b().required("Owner Name is required"),ownerEmail:b().email("Invalid email").required("Owner Email is required"),contact:b().required("Contact number is required")});return e.jsx($,{innerRef:o,initialValues:{...r,contact:r.contact||"",shopName:r.shopName||"",shopNo:r.shopNo||"",address:r.address||"",vat:r.vat||"",ownerName:r.ownerName||"",ownerEmail:r.ownerEmail||"",shopAttachments:r.shopAttachments||[]},validationSchema:a,onSubmit:async(l,{setSubmitting:i,setErrors:t})=>{var s;const n=new FormData;n.append("shopName",l.shopName||""),n.append("shopNo",l.shopNo||""),n.append("address",l.address||""),n.append("vat",l.vat||""),n.append("ownerName",l.ownerName||""),n.append("ownerEmail",l.ownerEmail||""),n.append("contact",l.contact||""),f.forEach(N=>{n.append("shopAttachments",N)});try{await u(n,i)}catch(N){i(!1),(s=N.message)!=null&&s.includes("Shop already exists")&&t({shopName:"This shop name is already registered"})}},enableReinitialize:!0,validateOnChange:!0,validateOnBlur:!0,children:({values:l,touched:i,errors:t,isSubmitting:n,setFieldValue:s,handleBlur:N})=>{const B=p=>{if(p.target.files&&p.target.files.length>0){const c=Array.from(p.target.files),y=[...f,...c];x(y),s("shopAttachments",y),N({target:{name:"shopAttachments"}})}},I=p=>{const c=[...f];c.splice(p,1),x(c),s("shopAttachments",c),N({target:{name:"shopAttachments"}})};return e.jsx(V,{children:e.jsxs(T,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Shop Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{label:"Shop Name",invalid:!!t.shopName&&i.shopName,errorMessage:t.shopName,children:e.jsx(g,{type:"text",autoComplete:"off",name:"shopName",placeholder:"Shop Name",component:j,validateOnBlur:!0})}),e.jsx(h,{label:"Shop Number",invalid:!!t.shopNo&&i.shopNo,errorMessage:t.shopNo,children:e.jsx(g,{type:"text",autoComplete:"off",name:"shopNo",placeholder:"Shop Number",component:j,validateOnBlur:!0})})]}),e.jsx(h,{label:"Address",invalid:!!t.address&&i.address,errorMessage:t.address,children:e.jsx(g,{type:"text",autoComplete:"off",name:"address",placeholder:"Shop Address",component:j,validateOnBlur:!0})}),e.jsx(h,{label:"VAT",invalid:!!t.vat&&i.vat,errorMessage:t.vat,children:e.jsx(g,{type:"text",autoComplete:"off",name:"vat",placeholder:"VAT Number",component:j,validateOnBlur:!0})})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Owner Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{label:"Owner Name",invalid:!!t.ownerName&&i.ownerName,errorMessage:t.ownerName,children:e.jsx(g,{type:"text",autoComplete:"off",name:"ownerName",placeholder:"Owner Name",component:j,validateOnBlur:!0})}),e.jsx(h,{label:"Owner Email",invalid:!!t.ownerEmail&&i.ownerEmail,errorMessage:t.ownerEmail,children:e.jsx(g,{type:"email",autoComplete:"off",name:"ownerEmail",placeholder:"Owner Email",component:j,validateOnBlur:!0})}),e.jsx(h,{label:"Owner Contact",invalid:!!t.contact&&i.contact,errorMessage:t.contact,children:e.jsx(g,{type:"text",autoComplete:"off",name:"contact",placeholder:"Contact Number",component:j,validateOnBlur:!0})})]})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Shop Attachments"}),e.jsxs(h,{label:"Attachments",invalid:!!t.shopAttachments&&i.shopAttachments,errorMessage:t.shopAttachments,children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"file",multiple:!0,onChange:B,onBlur:()=>N({target:{name:"shopAttachments"}}),className:`block w-full text-sm text-gray-500\r
                            file:mr-4 file:py-2 file:px-4\r
                            file:rounded-md file:border-0\r
                            file:text-sm file:font-semibold\r
                            file:bg-blue-50 file:text-blue-700\r
                            hover:file:bg-blue-100\r
                            dark:file:bg-blue-900/30 dark:file:text-blue-300\r
                            dark:hover:file:bg-blue-900/20`,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx"})}),f.length>0&&e.jsx("div",{className:"space-y-2",children:f.map((p,c)=>{const y=p instanceof File,O=y?p.name:p.fileName,k=y?void 0:p.filePath;return e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[k?e.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 dark:text-blue-300 truncate hover:underline",children:O}):e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:O}),e.jsx("button",{type:"button",onClick:()=>I(c),className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 ml-2",children:e.jsx(D,{})})]},c)})})]})]})]})}),e.jsxs(z,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:d==="edit"&&A&&e.jsx(J,{onDelete:A})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(F,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>w==null?void 0:w(),children:"Discard"}),e.jsx(F,{size:"sm",variant:"solid",loading:n,icon:e.jsx(P,{}),type:"submit",children:"Save"})]})]})]})})}})});q.displayName="ShopDetailsForm";const J=({onDelete:m})=>{const[o,d]=v.useState(!1),r=()=>{d(!1),m==null||m(d)},u=()=>{d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(D,{}),type:"button",onClick:()=>d(!0),children:"Delete"}),e.jsx(H,{isOpen:o,type:"danger",title:"Delete shop",confirmButtonColor:"red-600",onClose:u,onRequestClose:u,onCancel:u,onConfirm:r,children:e.jsx("p",{children:"Are you sure you want to delete this shop?"})})]})},K={shopName:"",shopNo:"",address:"",vat:"",ownerName:"",ownerEmail:"",contact:"",shopAttachments:[]},at=()=>{const m=M(),{id:o}=R(),[d,r]=v.useState(K);console.log("initialData:",d);const[u,w]=v.useState(!!o);v.useEffect(()=>{o&&(async()=>{try{const a=await L(o);if(!a||!a.data)throw new Error("Invalid shop data");r({shopName:a.data.shopName||"",shopNo:a.data.shopNo||"",address:a.data.address||"",vat:a.data.vat||"",ownerName:a.data.ownerName||"",ownerEmail:a.data.ownerEmail||"",contact:a.data.contact||"",shopAttachments:a.data.shopAttachments||[]}),w(!1)}catch(a){console.error("Error fetching shop:",a),w(!1),S.push(e.jsx(C,{title:"Failed to fetch shop data",type:"danger",duration:2500,children:a.message||"Something went wrong"}),{placement:"top-center"}),m("/app/user-list")}})()},[o,m]);const A=async(x,a)=>{var l,i,t,n;a(!0);try{let s;if(o?s=await _(o,x):s=await G(x),s.status===(o?200:201))a(!1),S.push(e.jsxs(C,{title:`Successfully ${o?"updated":"added"} shop`,type:"success",duration:2500,children:["Shop ",o?"updated":"added"," successfully"]}),{placement:"top-center"}),m("/app/shop-view");else throw new Error(((i=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:i.message)||"Unexpected status code")}catch(s){console.error("Error during form submission:",s),a(!1),S.push(e.jsx(C,{title:`Error ${o?"updating":"adding"} shop`,type:"danger",duration:2500,children:((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||s.message}),{placement:"top-center"})}},f=()=>{m("/app/shop-view")};return u?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx(q,{type:o?"edit":"new",initialData:d,onFormSubmit:A,onDiscard:f})};export{at as default};
