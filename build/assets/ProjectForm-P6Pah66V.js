import{j as e,G as K,r as x,v as U,ak as O}from"./index-D5qsHBPI.js";import{C as W}from"./Views-B1b09e4F.js";import{A as J}from"./AdaptableCard-UKh7K-Hq.js";import{M as z}from"./index-CPVaYfOj.js";import{F as _,aa as Q}from"./index-Bjc1-Dfl.js";import{u as X}from"./useThemeClass-dAtDPqCv.js";import{I as k}from"./Input-DpzrnPB-.js";import{B as y}from"./Button-DKlp8XN1.js";import{F as M,a as S}from"./FormItem-BjAM8sYA.js";import{F,a as q,b as P}from"./formik.esm-XpKb_I1k.js";import{c as B,a as w}from"./index.esm-D0L8hc4Y.js";import{f as Y,e as Z,c as V,a as ee}from"./api-E4FeyQaA.js";import{d as ie}from"./debounce-BcvDMC3O.js";import"./Alert-C5ubLdhu.js";import"./index-BVZVTO7z.js";import"./Badge-Dxo-y_KI.js";import"./Calendar-DWCnCoFE.js";import{C as se}from"./Card-yHUwp5an.js";import"./Skeleton-Dmiutfuv.js";import"./index-BO9RL4R9.js";import"./Dialog-Dhhpr09S.js";import"./Drawer-BUEyqvQR.js";import"./index-DJHxYRo4.js";import"./useUniqueId-CheqgfIm.js";import"./index-QOERWN9e.js";import{t as L,N as $}from"./toast-BV-KR3on.js";import"./Progress-DzB5YKhk.js";import"./index-CrE-Oq-m.js";import"./ScrollBar-BNGPRGE7.js";import"./index-sVsNsozN.js";import"./Select-DCy0le_o.js";import"./Upload-B1VqOR8x.js";import"./index-WwDzlDyh.js";import"./Tag-DuBUDIYz.js";import"./index-DmRycXSQ.js";import{g as G}from"./get-BV5slyYd.js";import"./proxy-QQ9UH2Rr.js";import"./isNil-BKogIPw7.js";import"./index-CKN0MgBz.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-CTX8E6kM.js";import"./toString-kQNaAZON.js";import"./StatusIcon-B-JCnJup.js";import"./CloseButton-CYqIcWKK.js";import"./floating-ui.react-CtRk2jQd.js";import"./floating-ui.dom-D1IisfOw.js";import"./useControllableState-OCPLuC6T.js";import"./_getPrototype-07QB_bHq.js";import"./index-BKrnPZdN.js";import"./index-Chjiymov.js";import"./chainedFunction-BxZSneMW.js";import"./index-byIxUKR0.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./index-C6AW9Bce.js";const te=({currentStep:s,steps:p,onStepChange:r,completed:l})=>{const{textTheme:N}=X();return e.jsx(z,{variant:"transparent",className:"px-2",children:p.map(n=>e.jsxs(z.MenuItem,{eventKey:n.value.toString(),className:`mb-2 ${n.value<=s?"cursor-pointer":"cursor-not-allowed"}`,isActive:s===n.value,onSelect:()=>{n.value<=l&&r(n.value)},children:[e.jsxs("span",{className:"text-2xl ltr:mr-2 rtl:ml-2",children:[n.value<l&&e.jsx(_,{className:N}),n.value===l&&e.jsx(_,{className:N}),n.value>l&&e.jsx(Q,{className:"text-gray-400"})]}),e.jsx("span",{className:n.value>l?"text-gray-400":"",children:n.label})]},n.value))})};function H(s){return K({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M363 277h-86v86h-42v-86h-86v-42h86v-86h42v86h86v42z"},child:[]},{tag:"path",attr:{d:"M256 90c44.3 0 86 17.3 117.4 48.6C404.7 170 422 211.7 422 256s-17.3 86-48.6 117.4C342 404.7 300.3 422 256 422c-44.3 0-86-17.3-117.4-48.6C107.3 342 90 300.3 90 256c0-44.3 17.3-86 48.6-117.4C170 107.3 211.7 90 256 90m0-42C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(s)}const ne=({data:s,onNext:p})=>{console.log("daaataaaaa",s);const[r,l]=x.useState([]),[N,n]=x.useState(!1),[f,h]=x.useState((s==null?void 0:s.clientData._id)??!1),[b,g]=x.useState((s==null?void 0:s.clientData)??null),m=U(),v=B().shape({clientName:w().required("Client Name is required")}),C=ie(async t=>{var i;try{n(!0);const d=await Y({search:t});l(((i=d==null?void 0:d.data)==null?void 0:i.clients)||[])}catch(d){console.error("Failed to fetch clients:",d),l([])}finally{n(!1)}},300);x.useEffect(()=>(console.log("component mounted"),()=>{C.cancel(),console.log("component unmounted")}),[C]);const c=t=>{h(!0),g(t),l([])},a=()=>{h(!1),g(null),l([])};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"mb-2",children:"Client Information"}),e.jsx("p",{children:"Basic information for an project opening"})]}),e.jsx(F,{initialValues:s,validationSchema:v,onSubmit:t=>{f&&b&&p({...t,clientData:b})},children:({values:t,touched:i,errors:d,handleChange:o,handleBlur:j,setFieldValue:A})=>e.jsx(q,{children:e.jsxs(M,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-2",children:[e.jsx(S,{label:"Client Name",invalid:d.clientName&&i.clientName,errorMessage:d.clientName,style:{minWidth:"300px"},children:e.jsxs("div",{className:"relative",children:[e.jsx(k,{name:"clientName",placeholder:"Client Name",value:t.clientName,onChange:u=>{o(u),h(!1),u.target.value.length>0?C(u.target.value):l([])},onBlur:()=>{j("clientName"),setTimeout(()=>l([]),200)}}),N&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-900"})}),r.length>0&&!f&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-800 shadow-lg rounded-md py-1 max-h-60 overflow-auto",children:r.map((u,I)=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",onMouseDown:()=>{A("clientName",u.clientName),t.clientData={_id:u._id,clientAddress:u.clientAddress,clientName:u.clientName,mobileNumber:u.mobileNumber,pincode:u.pincode,telephoneNumber:u.telephoneNumber,trnNumber:u.trnNumber},c(u)},children:u.clientName},I))})]})}),f?e.jsx(y,{shape:"circle",size:"m",onClick:u=>{u.preventDefault(),a(),m("/app/create-client")},icon:e.jsx(H,{})}):e.jsx(y,{shape:"circle",size:"m",icon:e.jsx(H,{}),onClick:()=>m("/app/client-new")})]}),f&&b&&e.jsxs("div",{className:"mt-4 p-4 border rounded-lg bg-gray-50 dark:bg-gray-700",children:[e.jsx("h4",{className:"mb-2",children:"Selected Client Details"}),e.jsxs("p",{children:["Address: ",b.clientAddress]}),e.jsxs("p",{children:["Mobile: ",b.mobileNumber]}),e.jsxs("p",{children:["TRN: ",b.trnNumber]})]}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx(y,{variant:"solid",type:"submit",disabled:!f,children:"Next"})})]})})})]})},le=({data:s,onBack:p,onSubmit:r})=>{const l=s.clientData.locations.find(n=>n.name===s.location),N=l==null?void 0:l.buildings.find(n=>n.name===s.building);return N==null||N.apartments.find(n=>n.number===(s==null?void 0:s.apartment)),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h3",{className:"mb-6 text-center",children:"Project Review"}),e.jsx(se,{className:"mb-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-4",children:"Client Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Client Name"}),e.jsx("p",{className:"font-semibold",children:s.clientName||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Client Address"}),e.jsx("p",{className:"font-semibold",children:s.clientData.clientAddress||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Pincode"}),e.jsx("p",{className:"font-semibold",children:s.clientData.pincode||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Mobile Number"}),e.jsx("p",{className:"font-semibold",children:s.clientData.mobileNumber||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Telephone Number"}),e.jsx("p",{className:"font-semibold",children:s.clientData.telephoneNumber||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Trn Number"}),e.jsx("p",{className:"font-semibold",children:s.clientData.trnNumber||"Not provided"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"mb-4",children:"Project Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Project Name"}),e.jsx("p",{className:"font-semibold",children:s.projectName||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Project Description"}),e.jsx("p",{className:"font-semibold",children:s.projectDescription||"Not provided"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"mb-4",children:"Address Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Location"}),e.jsx("p",{className:"font-semibold",children:s.location||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Building"}),e.jsx("p",{className:"font-semibold",children:s.building||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Apartment"}),e.jsx("p",{className:"font-semibold",children:s.apartment||"Not provided"})]})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(y,{type:"button",onClick:p,children:"Back"}),e.jsx(y,{variant:"solid",onClick:r,children:"Submit Project"})]})]})},re=B().shape({projectName:w().required("Project Name is Required"),projectDescription:w().required("Project Description is Required")}),oe=({data:s={projectName:"",projectDescription:""},onNextChange:p,onBackChange:r,currentStepStatus:l})=>{const N=(f,h)=>{p==null||p(f,"ProjectInformation",h)},n=()=>{r==null||r()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"mb-2",children:"Project Information"}),e.jsx("p",{children:"Fill in your project information to help us speed up the verification process."})]}),e.jsx(F,{enableReinitialize:!0,initialValues:s,validationSchema:re,onSubmit:(f,{setSubmitting:h})=>{N(f,h)},children:({values:f,touched:h,errors:b,isSubmitting:g})=>e.jsx(q,{children:e.jsxs(M,{children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-4",children:"Project Details"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(S,{label:"Project Name",invalid:!!(b.projectName&&h.projectName),errorMessage:b.projectName,children:e.jsx(P,{type:"text",autoComplete:"off",name:"projectName",placeholder:"Project Name",component:k})}),e.jsx(S,{label:"Project Description",invalid:!!(b.projectDescription&&h.projectDescription),errorMessage:b.projectDescription,children:e.jsx(P,{as:"textarea",autoComplete:"off",name:"projectDescription",placeholder:"Project Description",component:k,textArea:!0})})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(y,{type:"button",onClick:n,children:"Back"}),e.jsx(y,{loading:g,variant:"solid",type:"submit",children:l==="complete"?"Save":"Next"})]})]})})})]})},ce=B().shape({location:w().required("Location is required"),building:w().required("Building is required"),apartment:w().required("Apartment is required")}),ae=({data:s={location:"",building:"",apartment:"",clientData:{locations:[]}},onNextChange:p,onBackChange:r,currentStepStatus:l})=>{const[N,n]=x.useState([]),[f,h]=x.useState([]);x.useEffect(()=>{if(s.location&&s.clientData.locations.length>0){const c=s.clientData.locations.find(t=>t.name===s.location),a=(c==null?void 0:c.buildings)||[];if(n(a),s.building){const t=a.find(i=>i.name===s.building);h((t==null?void 0:t.apartments)||[])}}},[s.location,s.building,s.clientData.locations]);const b=(c,a)=>{p==null||p(c,"addressInformation",a)},g=()=>{r==null||r()},m=x.useCallback((c,a)=>G(c,a),[]),v=x.useCallback((c,a)=>G(c,a),[]),D=(c,a)=>{a("building",""),a("apartment","");const t=s.clientData.locations.find(i=>i.name===c);n((t==null?void 0:t.buildings)||[]),h([])},C=(c,a)=>{a("apartment","");const t=N.find(i=>i.name===c);h((t==null?void 0:t.apartments)||[])};return e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"mb-2",children:"Address Information"}),e.jsx("p",{children:"Select the project location details"}),e.jsx(F,{enableReinitialize:!0,initialValues:{location:s.location||"",building:s.building||"",apartment:s.apartment||""},validationSchema:ce,onSubmit:(c,{setSubmitting:a})=>{a(!0),setTimeout(()=>{b(c,a)},1e3)},children:({values:c,touched:a,errors:t,isSubmitting:i,setFieldValue:d})=>e.jsx(q,{children:e.jsxs(M,{children:[e.jsx(S,{label:"Location",invalid:!!m(t,"location")&&!!v(a,"location"),errorMessage:m(t,"location"),children:e.jsxs(P,{as:"select",name:"location",onChange:o=>{d("location",o.target.value),D(o.target.value,d)},className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"",children:"Select Location"}),s.clientData.locations.map((o,j)=>e.jsx("option",{value:o.name,children:o.name},j))]})}),e.jsx(S,{label:"Building",invalid:!!m(t,"building")&&!!v(a,"building"),errorMessage:m(t,"building"),children:e.jsxs(P,{as:"select",name:"building",disabled:!c.location,onChange:o=>{d("building",o.target.value),C(o.target.value,d)},className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"",children:"Select Building"}),N.map((o,j)=>e.jsx("option",{value:o.name,children:o.name},j))]})}),e.jsx(S,{label:"Apartment",invalid:!!m(t,"apartment")&&!!v(a,"apartment"),errorMessage:m(t,"apartment"),children:e.jsxs(P,{as:"select",name:"apartment",disabled:!c.building,className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"",children:"Select Apartment"}),f.map((o,j)=>e.jsx("option",{value:o.number,children:o.number},j))]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(y,{type:"button",onClick:g,children:"Back"}),e.jsx(y,{loading:i,variant:"solid",type:"submit",children:l==="complete"?"Save":"Next"})]})]})})})]})},di=()=>{const s=U(),{id:p}=O(),[r,l]=x.useState(0),[N,n]=x.useState(0),[f,h]=x.useState(!1),[b,g]=x.useState(null),[m,v]=x.useState({clientName:"",projectName:"",projectDescription:"",location:"",building:"",apartment:"",clientData:{_id:"",clientName:"",clientAddress:"",pincode:"",mobileNumber:"",telephoneNumber:"",trnNumber:"",locations:[]}}),D=[{label:"Client Details",value:0},{label:"Project Details",value:1},{label:"Address Information",value:2},{label:"Review",value:3}],C=(i,d,o)=>{v(j=>({...j,...i})),(r<D.length-2||r===D.length-2)&&l(r+1),n(j=>j>r+1?j:r+1),o==null||o(!1)},c=()=>{l(i=>Math.max(0,i-1))},a=async()=>{h(!0),g(null);try{const i={client:m.clientData._id,projectDescription:m.projectDescription,projectName:m.projectName,location:m.location,building:m.building,apartmentNumber:m.apartment};p?(await Z(p,i)).status===200&&(L.push(e.jsx($,{title:"Successfully Updated project",type:"success",duration:2500,children:"Project successfully Updated"}),{placement:"top-center"}),s("/app/project-list")):(await V(i)).status===201&&(L.push(e.jsx($,{title:"Successfully created project",type:"success",duration:2500,children:"Project successfully created"}),{placement:"top-center"}),s("/app/project-list"))}catch(i){console.error("Error submitting form:",i),g("Failed to create project. Please try again.")}finally{h(!1)}},t=async()=>{var d,o,j,A,u,I,R,E,T;const{data:i}=await ee(p);v({clientData:{_id:(d=i==null?void 0:i.client)==null?void 0:d._id,clientName:(o=i==null?void 0:i.client)==null?void 0:o.clientName,clientAddress:(j=i==null?void 0:i.client)==null?void 0:j.clientAddress,mobileNumber:(A=i==null?void 0:i.client)==null?void 0:A.mobileNumber,telephoneNumber:(u=i==null?void 0:i.client)==null?void 0:u.telephoneNumber,trnNumber:(I=i==null?void 0:i.client)==null?void 0:I.trnNumber,pincode:(R=i==null?void 0:i.client)==null?void 0:R.pincode,locations:((E=i==null?void 0:i.client)==null?void 0:E.locations)||[]},projectName:i==null?void 0:i.projectName,projectDescription:i==null?void 0:i.projectDescription,location:(i==null?void 0:i.location)||"",building:(i==null?void 0:i.building)||"",apartment:(i==null?void 0:i.apartmentNumber)||"",clientName:(T=i==null?void 0:i.client)==null?void 0:T.clientName}),n(3),l(3)};return x.useEffect(()=>{p&&t()},[p]),e.jsx(W,{className:"h-full",children:e.jsx(J,{className:"h-full",bodyClass:"h-full",children:e.jsxs("div",{className:"grid lg:grid-cols-5 xl:grid-cols-3 2xl:grid-cols-5 gap-4 h-full",children:[e.jsx("div",{className:"2xl:col-span-1 xl:col-span-1 lg:col-span-2",children:e.jsx(te,{currentStep:r,steps:D,onStepChange:l,completed:N})}),e.jsxs("div",{className:"2xl:col-span-4 lg:col-span-3 xl:col-span-2",children:[r===0&&e.jsx(ne,{data:m,onNext:C}),r===1&&e.jsx(oe,{data:m,onNextChange:C,onBackChange:c}),r===2&&e.jsx(ae,{data:m,onNextChange:(i,d,o)=>{v(j=>({...j,...i})),l(3),o(!1)},onBackChange:c}),r===3&&e.jsx(le,{data:m,onBack:c,onSubmit:a})]})]})})})};export{di as default};
