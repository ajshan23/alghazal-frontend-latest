import{r as N,j as e,a6 as K,aj as Q}from"./index-DprkEiEK.js";import{t as R,N as q}from"./toast-6mWVT1dx.js";import{F as X,a as n}from"./FormItem-CLbUnAko.js";import{B as v}from"./Button-PtpZLnju.js";import{S as V}from"./StickyFooter-cFt-E6ev.js";import{F as ee,a as ae,b as u,c as re}from"./formik.esm-PmOj15rT.js";import{Y as M,Z as se}from"./index-DRT6ZEuo.js";import{A as te}from"./index-Ba3SdaaX.js";import{c as ie,a as g,f as oe,h as F,g as ne}from"./index.esm-DuwqUL2u.js";import"./Alert-BkYPvYNz.js";import"./index-Da8XY5ZM.js";import"./Badge-Dt7JCtsY.js";import"./Calendar-DUSHLq6D.js";import"./Card-BpjZUxOM.js";import"./Skeleton-Ch8Q_reX.js";import"./index-DVa3s2tW.js";import"./Dialog-C4kohZQf.js";import"./Drawer-CX6y54ar.js";import"./index-bMq9u0cL.js";import"./useUniqueId-BPFxATym.js";import{I as b}from"./Input-D9aAsaRn.js";import"./index-Cryf1M42.js";import"./index-jGIM7sHo.js";import"./Progress-Ceind13D.js";import"./index-yA6ev0nJ.js";import"./ScrollBar-BmvQrRag.js";import"./index-DvIR4uCb.js";import{S as me}from"./Select-Bn_1dfRU.js";import{U as P}from"./Upload-DwkkluLb.js";import"./index-CWhs-_CT.js";import"./Tag-CxDnfmc0.js";import"./index-C459fFPL.js";import{A as D}from"./AdaptableCard-39f9t030.js";import"./Views-BMPEAoNT.js";import"./chart.config-BKRex688.js";import{C as le}from"./ConfirmDialog-DM5WK0jo.js";import"./DataTable-8O3OokYV.js";import"./SvgIcon-BhcKgcqL.js";import"./SegmentItemOption-C6pA8GAy.js";import{f as pe,e as de,a as ce}from"./api-Ncac7UsG.js";import"./StatusIcon-BF-FCtRa.js";import"./CloseButton-DD9EgaVn.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-LJQ4uuy1.js";import"./index-D-ApMVAy.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-BW0HCES2.js";import"./floating-ui.react-svs4PfWS.js";import"./floating-ui.dom-D1IisfOw.js";import"./useControllableState-BZtcuTBt.js";import"./get-Zx5oz8JG.js";import"./toString-Chg3pnU2.js";import"./_getPrototype-ZWmpNt_H.js";import"./index-x0qbPmga.js";import"./index-Chjiymov.js";import"./isNil-DH5bwM4B.js";import"./index-Ds5bsVgF.js";import"./index-pu0hqvVK.js";import"./useThemeClass-DRwj9mMv.js";const L=[{label:"Admin",value:"admin"},{label:"Super Admin",value:"super_admin"},{label:"Engineer",value:"engineer"},{label:"Finance",value:"finance"},{label:"Driver",value:"driver"},{label:"Worker",value:"worker"},{label:"Supervisor",value:"supervisor"}],B=N.forwardRef((d,t)=>{const{type:m,initialData:f={firstName:"",lastName:"",email:"",phoneNumbers:[""],role:"",password:"",profileImage:"",signatureImage:"",salary:0,accountNumber:"",emiratesId:"",emiratesIdDocument:"",passportNumber:"",passportDocument:""},onFormSubmit:h,onDiscard:x,onDelete:w}=d,[C,j]=N.useState(null),[i,c]=N.useState(null),[k,$]=N.useState(null),[A,U]=N.useState(null),O=ie().shape({firstName:g().required("First Name Required"),lastName:g().required("Last Name Required"),email:g().email("Invalid email").required("Email Required"),role:g().required("Role is Required"),password:m==="new"?g().required("Password is Required"):g(),phoneNumbers:oe().of(g().matches(/^[0-9]+$/,"Phone number must be digits only")),profileImage:m==="new"?F().required("Profile image is required"):F(),signatureImage:m==="new"?F().required("Signature is required"):F(),salary:ne().min(0,"Salary cannot be negative").when("role",{is:a=>!["admin","super_admin"].includes(a),then:a=>a.required("Salary is required for this role"),otherwise:a=>a.notRequired()}),accountNumber:g(),emiratesId:g(),passportNumber:g()}),z=async(a,{setSubmitting:l})=>{var S;const r=new FormData;r.append("firstName",a.firstName||""),r.append("lastName",a.lastName||""),r.append("email",a.email||""),r.append("role",a.role||""),a.password&&r.append("password",a.password),a.accountNumber&&r.append("accountNumber",a.accountNumber),a.emiratesId&&r.append("emiratesId",a.emiratesId),a.passportNumber&&r.append("passportNumber",a.passportNumber),(S=a.phoneNumbers)==null||S.forEach((o,E)=>{r.append(`phoneNumbers[${E}]`,o)}),a.role&&!["admin","super_admin"].includes(a.role)&&a.salary!==void 0&&r.append("salary",a.salary.toString()),C?r.append("profileImage",C):a.profileImage&&typeof a.profileImage=="string"&&r.append("profileImage",a.profileImage),i?r.append("signatureImage",i):a.signatureImage&&typeof a.signatureImage=="string"&&r.append("signatureImage",a.signatureImage),k?r.append("emiratesIdDocument",k):a.emiratesIdDocument&&typeof a.emiratesIdDocument=="string"&&r.append("emiratesIdDocument",a.emiratesIdDocument),A?r.append("passportDocument",A):a.passportDocument&&typeof a.passportDocument=="string"&&r.append("passportDocument",a.passportDocument),a.removeEmiratesIdDocument&&r.append("removeEmiratesIdDocument","true"),a.removePassportDocument&&r.append("removePassportDocument","true"),h==null||h(r,l)};return e.jsx(ee,{innerRef:t,initialValues:{...f,removeEmiratesIdDocument:!1,removePassportDocument:!1},validationSchema:O,onSubmit:z,enableReinitialize:!0,children:({values:a,touched:l,errors:r,isSubmitting:S,setFieldValue:o})=>{const E=s=>{s.length>0&&(j(s[0]),o("profileImage",s[0].name))},_=s=>{s.length>0&&(c(s[0]),o("signatureImage",s[0].name))},H=s=>{s.length>0&&($(s[0]),o("emiratesIdDocument",s[0].name),o("removeEmiratesIdDocument",!1))},T=s=>{s.length>0&&(U(s[0]),o("passportDocument",s[0].name),o("removePassportDocument",!1))},W=()=>{j(null),o("profileImage","")},Y=()=>{c(null),o("signatureImage","")},Z=()=>{$(null),o("emiratesIdDocument",""),o("removeEmiratesIdDocument",!0)},G=()=>{U(null),o("passportDocument",""),o("removePassportDocument",!0)},J=!["admin","super_admin"].includes(a.role);return e.jsx(ae,{children:e.jsxs(X,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(D,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"First Name",invalid:!!(r.firstName&&l.firstName),errorMessage:r.firstName,children:e.jsx(u,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:b})}),e.jsx(n,{label:"Last Name",invalid:!!(r.lastName&&l.lastName),errorMessage:r.lastName,children:e.jsx(u,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:b})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Email",invalid:!!(r.email&&l.email),errorMessage:r.email,children:e.jsx(u,{type:"email",autoComplete:"off",name:"email",placeholder:"Email",component:b})}),e.jsx(n,{label:"Role",invalid:!!(r.role&&l.role),errorMessage:r.role,children:e.jsx(u,{name:"role",children:({field:s,form:y})=>e.jsx(me,{placeholder:"Select Role",field:s,form:y,options:L,value:L.find(p=>p.value===a.role),onChange:p=>{y.setFieldValue(s.name,(p==null?void 0:p.value)||""),["admin","super_admin"].includes((p==null?void 0:p.value)||"")&&y.setFieldValue("salary",0)}})})})]}),J&&e.jsx(n,{label:"Salary",invalid:!!(r.salary&&l.salary),errorMessage:r.salary,children:e.jsx(u,{type:"number",autoComplete:"off",name:"salary",placeholder:"Salary",component:b,min:"0",step:"0.01"})})]}),e.jsxs(D,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Contact Information"}),e.jsx(re,{name:"phoneNumbers",children:({push:s,remove:y})=>{var p;return e.jsxs("div",{className:"space-y-4",children:[(p=a.phoneNumbers)==null?void 0:p.map((ge,I)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end border-b pb-4",children:[e.jsx(n,{label:`Phone Number ${I+1}`,invalid:!!(r.phoneNumbers&&r.phoneNumbers[I]&&l.phoneNumbers),errorMessage:r.phoneNumbers&&r.phoneNumbers[I],children:e.jsx(u,{name:`phoneNumbers.${I}`,component:b,placeholder:"Phone Number"})}),e.jsx("div",{className:"flex justify-end",children:a.phoneNumbers.length>1&&e.jsx(v,{type:"button",size:"sm",variant:"plain",color:"red",icon:e.jsx(M,{}),onClick:()=>y(I)})})]},I)),e.jsx(v,{type:"button",size:"sm",variant:"twoTone",icon:e.jsx(se,{}),onClick:()=>s(""),children:"Add Phone Number"})]})}}),e.jsx(n,{label:"Account Number",children:e.jsx(u,{type:"text",autoComplete:"off",name:"accountNumber",placeholder:"Bank Account Number",component:b})})]}),e.jsxs(D,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Document Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Emirates ID",children:e.jsx(u,{type:"text",autoComplete:"off",name:"emiratesId",placeholder:"Emirates ID Number",component:b})}),e.jsx(n,{label:"Passport Number",children:e.jsx(u,{type:"text",autoComplete:"off",name:"passportNumber",placeholder:"Passport Number",component:b})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Emirates ID Document",children:e.jsx(P,{onChange:s=>H(s),onFileRemove:Z,uploadLimit:1,defaultFile:f.emiratesIdDocument,accept:".pdf,.png,.jpeg,.jpg"})}),e.jsx(n,{label:"Passport Document",children:e.jsx(P,{onChange:s=>T(s),onFileRemove:G,uploadLimit:1,defaultFile:f.passportDocument,accept:".pdf,.png,.jpeg,.jpg"})})]})]}),e.jsxs(D,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Profile Images"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Profile Image",invalid:!!(r.profileImage&&l.profileImage),errorMessage:r.profileImage,children:e.jsx(P,{onChange:s=>E(s),onFileRemove:W,uploadLimit:1,defaultFile:f.profileImage})}),e.jsx(n,{label:"Signature Image",invalid:!!(r.signatureImage&&l.signatureImage),errorMessage:r.signatureImage,children:e.jsx(P,{onChange:s=>_(s),onFileRemove:Y,uploadLimit:1,defaultFile:f.signatureImage})})]})]}),m==="new"&&e.jsxs(D,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Security"}),e.jsx(n,{label:"Password",invalid:!!(r.password&&l.password),errorMessage:r.password,children:e.jsx(u,{type:"password",autoComplete:"off",name:"password",placeholder:"Password",component:b})})]})]})}),e.jsxs(V,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:m==="edit"&&w&&e.jsx(ue,{onDelete:w})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(v,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>x==null?void 0:x(),children:"Discard"}),e.jsx(v,{size:"sm",variant:"solid",loading:S,icon:e.jsx(te,{}),type:"submit",children:"Save"})]})]})]})})}})});B.displayName="UserForm";const ue=({onDelete:d})=>{const[t,m]=N.useState(!1),f=()=>{m(!1),d==null||d(m)},h=()=>{m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(M,{}),type:"button",onClick:()=>m(!0),children:"Delete"}),e.jsx(le,{isOpen:t,type:"danger",title:"Delete user",confirmButtonColor:"red-600",onClose:h,onRequestClose:h,onCancel:h,onConfirm:f,children:e.jsx("p",{children:"Are you sure you want to delete this user?"})})]})},ja=()=>{const d=K(),{id:t}=Q(),[m,f]=N.useState(null),[h,x]=N.useState(!!t);N.useEffect(()=>{t&&(async()=>{try{const i=await pe(t);f({...i.data,profileImage:i.data.profileImage||"",signatureImage:i.data.signatureImage||"",salary:i.data.salary||0}),x(!1)}catch(i){console.error("Error fetching user:",i),x(!1),R.push(e.jsx(q,{title:"Failed to fetch user data",type:"danger",duration:2500,children:i.message}),{placement:"top-center"}),d("/app/user-list")}})()},[t,d]);const w=async(j,i)=>{i(!0);try{let c;if(t?c=await de(t,j):c=await ce(j),c.status===(t?200:201))i(!1),R.push(e.jsxs(q,{title:`Successfully ${t?"updated":"added"} user`,type:"success",duration:2500,children:["User ",t?"updated":"added"," successfully"]}),{placement:"top-center"}),d("/app/user-list");else throw new Error(`Unexpected status code: ${c.status}`)}catch(c){console.error("Error during form submission:",c),i(!1),R.push(e.jsx(q,{title:`Error ${t?"updating":"adding"} user`,type:"danger",duration:2500,children:c.message}),{placement:"top-center"})}},C=()=>{d("/app/user-list")};return h?e.jsx("div",{children:"Loading user data..."}):e.jsx(B,{type:t?"edit":"new",initialData:m||{firstName:"",lastName:"",email:"",phoneNumbers:[""],role:"",password:"",profileImage:"",signatureImage:"",salary:0},onFormSubmit:w,onDiscard:C})};export{ja as default};
