import{r as s,b as x,j as e,a1 as v}from"./index-CYREFKZG.js";import"./Alert-Cc8BV9-e.js";import{A as w}from"./index-lj_pQvB3.js";import{B as f}from"./Badge-C73elDoT.js";import{B as c}from"./Button-Bw5pwASe.js";import"./Calendar-WeLCs7zT.js";import{C as A}from"./Card-Dz-vhRoS.js";import"./Skeleton-C3msD0AC.js";import"./index-D7RG7uIP.js";import"./Dialog-SyL1UyQI.js";import"./Drawer-BPn271Vj.js";import"./index-DSWsvdkV.js";import"./FormItem-OC8YTe9a.js";import"./useUniqueId-usxbXFWg.js";import"./Input-CBtIewGG.js";import"./index-hkorcGQ3.js";import"./index-Duq-6sPR.js";import{t as i,N as n}from"./toast-D10MqJ5k.js";import"./Progress-5WwxyJN3.js";import"./index-Cx-cciMK.js";import"./ScrollBar-PLAgVGcK.js";import"./index-D5et0e9c.js";import"./Select-BXBkdm85.js";import"./Upload-BBmsRjVm.js";import"./index-Cy_ZD0YM.js";import"./Tag-DmHmgYE4.js";import"./index-fox4VSB4.js";import{aI as Y,H as D,ae as M}from"./index-DxPdCp1M.js";import{b as C,c as y}from"./api-CLGvCA3b.js";import{u as S}from"./useThemeClass-C1UfJ9xM.js";import"./Views-CidN8ifI.js";import"./chart.config-Cx_BMAdz.js";import"./DataTable-CH-MHbvO.js";import"./SvgIcon-DbGGnLnV.js";import"./SegmentItemOption-C6TbkCzp.js";import{a as _}from"./index-lKejZ5LX.js";import"./StatusIcon-D8Q-TRIc.js";import"./CloseButton-DcT37PEO.js";import"./proxy-B3X64ZJl.js";import"./floating-ui.react-Db-n4bhI.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-DMrbObHh.js";import"./useControllableState-8Kzkpc2P.js";import"./get-t94M6iYX.js";import"./toString-BZ5q91vB.js";import"./_getPrototype-35SxlZMe.js";import"./index-BHcECQs3.js";import"./index-Chjiymov.js";import"./isNil-CbtC8I9H.js";import"./chainedFunction-BxZSneMW.js";import"./hoist-non-react-statics.cjs-D7IwvU7q.js";import"./index-CpO4fbZN.js";import"./index-d3s4TRA7.js";import"./cloneDeep-DJN0yfLA.js";const Be=()=>{S();const[j,h]=s.useState(!0),[o,d]=s.useState(!1),[l,m]=s.useState([]),[N,k]=s.useState(x().format("DD MMM YYYY")),u=async()=>{try{h(!0);const t=x().format("YYYY-MM-DD"),r=await C(t);r.data&&r.data.data&&(m(r.data.data.users||[]),k(x(r.data.data.date).format("DD MMM YYYY")))}catch(t){i.push(e.jsx(n,{title:"Error fetching attendance",type:"danger",children:t.message}))}finally{h(!1)}};s.useEffect(()=>{u()},[]);const g=async(t,r)=>{try{d(!0),await y({userId:t,present:r}),m(a=>a.map(p=>p.user._id===t?{...p,present:r,markedBy:{_id:"current-user",firstName:"You",lastName:""},markedAt:new Date}:p)),i.push(e.jsx(n,{title:"Success",type:"success",children:"Attendance marked successfully"}))}catch(a){i.push(e.jsx(n,{title:"Error marking attendance",type:"danger",children:a.message}))}finally{d(!1)}},b=async t=>{try{d(!0),await Promise.all(l.map(r=>y({userId:r.user._id,present:t}))),m(r=>r.map(a=>({...a,present:t,markedBy:{_id:"current-user",firstName:"You",lastName:""},markedAt:new Date}))),i.push(e.jsxs(n,{title:"Success",type:"success",children:["All users marked as ",t?"present":"absent"]}))}catch(r){i.push(e.jsx(n,{title:"Error marking attendance",type:"danger",children:r.message}))}finally{d(!1)}};return j?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(v,{})}):e.jsx("div",{className:"container mx-auto px-4 h-full",children:e.jsx(A,{header:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold mb-1",children:"Normal Attendance"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:N})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 md:mt-0",children:[e.jsx(c,{size:"sm",variant:"plain",icon:e.jsx(Y,{}),onClick:u,children:"Refresh"}),e.jsx(c,{size:"sm",variant:"solid",onClick:()=>b(!0),disabled:o,children:"Mark All Present"})]})]}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-600",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600",children:l.length>0?l.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{size:"sm",src:t.user.profileImage,className:"mr-3",icon:e.jsx(_,{})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-200",children:[t.user.firstName," ",t.user.lastName]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.user.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(f,{content:t.user.role.replace("_"," "),innerClass:"bg-blue-500 text-white"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(f,{content:t.present?"Present":"Absent",innerClass:`${t.present?"bg-emerald-500 text-white":"bg-red-500 text-white"}`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{size:"xs",variant:"solid",color:"green",icon:e.jsx(D,{}),onClick:()=>g(t.user._id,!0),disabled:o||t.present,children:"Present"}),e.jsx(c,{size:"xs",variant:"solid",color:"red",icon:e.jsx(M,{}),onClick:()=>g(t.user._id,!1),disabled:o||!t.present,children:"Absent"})]})})]},t.user._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No attendance records found"})})})]})})})})};export{Be as default};
