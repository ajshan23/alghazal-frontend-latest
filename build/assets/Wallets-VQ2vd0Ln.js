import{j as e,c as He,ao as me,a8 as pe,a9 as Re,aa as Le,r as c,m as Me,an as S,a1 as ue,al as Fe,aj as xe,a6 as he,u as De,b as qe,ad as We}from"./index-DprkEiEK.js";import"./Alert-BkYPvYNz.js";import{A as $}from"./index-Da8XY5ZM.js";import{B as P}from"./Badge-Dt7JCtsY.js";import{B as b}from"./Button-PtpZLnju.js";import"./Calendar-DUSHLq6D.js";import{C}from"./Card-BpjZUxOM.js";import"./Skeleton-Ch8Q_reX.js";import"./index-DVa3s2tW.js";import{D as ge}from"./Dialog-C4kohZQf.js";import{D as ze}from"./Drawer-CX6y54ar.js";import"./index-bMq9u0cL.js";import"./FormItem-CLbUnAko.js";import"./useUniqueId-BPFxATym.js";import{I as Be}from"./Input-D9aAsaRn.js";import"./index-Cryf1M42.js";import"./index-jGIM7sHo.js";import{t as N,N as w}from"./toast-6mWVT1dx.js";import"./Progress-Ceind13D.js";import"./index-yA6ev0nJ.js";import"./ScrollBar-BmvQrRag.js";import"./index-DvIR4uCb.js";import"./Select-Bn_1dfRU.js";import"./Upload-DwkkluLb.js";import"./index-CWhs-_CT.js";import{T as Ue}from"./Tag-CxDnfmc0.js";import"./index-C459fFPL.js";import{ab as Ve,a0 as Ye,a1 as Ge,ac as Qe,a4 as Xe,ad as oe,S as Je,ae as Ze,I as fe,H as Ke,x as es,af as ss,ag as ts,ah as rs,Z as ns}from"./index-DRT6ZEuo.js";import{N as is}from"./react-number-format.es-CabNo69x.js";import{u as os}from"./useThemeClass-DRwj9mMv.js";import{i as as}from"./index-Ds5bsVgF.js";import{A as cs}from"./AdaptableCard-39f9t030.js";import{C as ls}from"./Views-BMPEAoNT.js";import"./chart.config-BKRex688.js";import"./DataTable-8O3OokYV.js";import"./SvgIcon-BhcKgcqL.js";import"./SegmentItemOption-C6pA8GAy.js";import"./StatusIcon-BF-FCtRa.js";import"./CloseButton-DD9EgaVn.js";import"./proxy-LJQ4uuy1.js";import"./floating-ui.react-svs4PfWS.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-D-ApMVAy.js";import"./useControllableState-BZtcuTBt.js";import"./get-Zx5oz8JG.js";import"./toString-Chg3pnU2.js";import"./_getPrototype-ZWmpNt_H.js";import"./index-x0qbPmga.js";import"./index-Chjiymov.js";import"./isNil-DH5bwM4B.js";import"./chainedFunction-BxZSneMW.js";import"./hoist-non-react-statics.cjs-BW0HCES2.js";import"./index-pu0hqvVK.js";import"./cloneDeep-DJN0yfLA.js";const _=({className:s,asElement:t="span",icon:o,children:i})=>e.jsxs(t,{className:He("flex items-center gap-2",s),children:[o,i]});async function ds(){return me.fetchData({url:"/crypto/wallets",method:"get"})}async function ms(s){return me.fetchData({url:"/crypto/wallets/history",method:"post",data:s})}const L="cryptoWallets",ae=pe(L+"/getWalletData",async()=>(await ds()).data),ce=pe(L+"/getTransctionHistoryData",async s=>(await ms(s)).data),ps={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},us={loading:!0,walletsData:[],transactionHistoryLoading:!0,transactionHistoryData:[],tableData:ps,selectedTab:"trade"},xs=Re({name:`${L}/state`,initialState:us,reducers:{setSelectedTab:(s,t)=>{s.selectedTab=t.payload},setTableData:(s,t)=>{s.tableData=t.payload},setTransactionHistoryData:(s,t)=>{s.transactionHistoryData=t.payload}},extraReducers:s=>{s.addCase(ae.fulfilled,(t,o)=>{t.loading=!1,t.walletsData=o.payload}).addCase(ae.pending,t=>{t.loading=!0}).addCase(ce.fulfilled,(t,o)=>{t.transactionHistoryLoading=!1,t.tableData.total=o.payload.total,t.transactionHistoryData=o.payload.data}).addCase(ce.pending,t=>{t.transactionHistoryLoading=!0})}}),hs=xs.reducer,gs=Le({data:hs});var fs={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function js(s){if(typeof s=="number")return{value:s,unit:"px"};var t,o=(s.match(/^[0-9.]*/)||"").toString();o.includes(".")?t=parseFloat(o):t=parseInt(o,10);var i=(s.match(/[^0-9]*$/)||"").toString();return fs[i]?{value:t,unit:i}:(console.warn("React Spinners: ".concat(s," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}function le(s){var t=js(s);return"".concat(t.value).concat(t.unit)}var ys=function(s,t,o){var i="react-spinners-".concat(s,"-").concat(o);if(typeof window>"u"||!window.document)return i;var a=document.createElement("style");document.head.appendChild(a);var m=a.sheet,r=`
    @keyframes `.concat(i,` {
      `).concat(t,`
    }
  `);return m&&m.insertRule(r,0),i},O=function(){return O=Object.assign||function(s){for(var t,o=1,i=arguments.length;o<i;o++){t=arguments[o];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(s[a]=t[a])}return s},O.apply(this,arguments)},bs=function(s,t){var o={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(o[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(s);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(s,i[a])&&(o[i[a]]=s[i[a]]);return o},vs=ys("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function de(s){var t=s.loading,o=t===void 0?!0:t,i=s.color,a=i===void 0?"#000000":i,m=s.speedMultiplier,r=m===void 0?1:m,u=s.cssOverride,h=u===void 0?{}:u,x=s.size,f=x===void 0?35:x,l=bs(s,["loading","color","speedMultiplier","cssOverride","size"]),j=O({background:"transparent !important",width:le(f),height:le(f),borderRadius:"100%",border:"2px solid",borderTopColor:a,borderBottomColor:"transparent",borderLeftColor:a,borderRightColor:a,display:"inline-block",animation:"".concat(vs," ").concat(.75/r,"s 0s infinite linear"),animationFillMode:"both"},h);return o?c.createElement("span",O({style:j},l)):null}const Ns=({clientinformation:s})=>{var t,o,i,a,m;return e.jsxs(C,{children:[e.jsx("h5",{className:"mb-4",children:"Customer"}),e.jsxs(Me,{className:"group flex items-center justify-between",to:"/app/crm/customer-details?id=11",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"ltr:ml-2 rtl:mr-2",children:e.jsxs("span",{children:["Name : ",(t=s==null?void 0:s.client)==null?void 0:t.clientName]})})}),e.jsx(Ve,{className:"text-xl hidden group-hover:block"})]}),e.jsx("hr",{className:"my-5"}),e.jsx(_,{className:"mb-4",icon:e.jsx(Ye,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(o=s==null?void 0:s.client)==null?void 0:o.email})}),e.jsx(_,{icon:e.jsx(as,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(i=s==null?void 0:s.client)==null?void 0:i.mobileNumber})}),e.jsx("br",{}),e.jsx(_,{icon:e.jsx(Ge,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(a=s==null?void 0:s.client)==null?void 0:a.telephoneNumber})}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-4",children:"Shipping Address"}),e.jsx("address",{className:"not-italic",children:e.jsx("div",{className:"mb-1",children:(m=s==null?void 0:s.client)==null?void 0:m.clientAddress})})]})},ws=({projectdetails:s})=>{var t,o,i;return e.jsxs(C,{children:[e.jsx("h5",{className:"mb-4",children:"Project Details"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ltr:ml-2 rtl:mr-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:s==null?void 0:s.projectName}),e.jsx("div",{className:"font-semibold text-lg",children:s==null?void 0:s.projectNumber})]})}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Project Description"}),e.jsxs("div",{className:"flex items-start mb-5",children:[e.jsx(Qe,{className:"text-xl opacity-70 mt-1 mr-2"}),e.jsx("p",{className:"text-gray-700",children:(s==null?void 0:s.projectDescription)||"No description provided"})]}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Site Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{icon:e.jsx(Xe,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Site Location"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.location)||"Not specified"})]})}),e.jsx(_,{icon:e.jsx(oe,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Building"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.building)||"Not specified"})]})}),e.jsx(_,{icon:e.jsx(oe,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Apartment"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.apartmentNumber)||"Not specified"})]})})]}),(s==null?void 0:s.client)&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Client Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Name: "}),e.jsx("span",{children:(t=s==null?void 0:s.client)==null?void 0:t.clientName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Address: "}),e.jsx("span",{children:(o=s==null?void 0:s.client)==null?void 0:o.clientAddress})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Phone: "}),e.jsx("span",{children:(i=s==null?void 0:s.client)==null?void 0:i.mobileNumber})]})]})]})]})},E=async s=>{try{console.log("project data : ",s);const t=await S.get(`/project/${s}`);return console.log(t),t.data}catch(t){throw console.log(t),t}},ks=async()=>{try{const s=await S.get("/user/engineers/");return console.log(s),s.data}catch(s){throw console.log(s),s}},Cs=async({projectId:s,engineerId:t})=>{var o;try{return console.log(s,"project id"),console.log(t,"engineerId "),(await S.post(`/project/${s}/assign`,{assignedTo:t})).data}catch(i){throw console.error("Assignment error details:",{error:i,response:(o=i.response)==null?void 0:o.data}),i}},Ss=async({estimationId:s,isChecked:t,comment:o})=>{var i;try{return(await S.patch(`/estimation/${s}/check`,{isChecked:t,comment:o})).data}catch(a){throw console.error("Error checking project:",{error:a,response:(i=a.response)==null?void 0:i.data}),a}},As=async({estimationId:s,isApproved:t,comment:o})=>{var i;try{return(await S.patch(`/estimation/${s}/approve`,{isApproved:t,comment:o})).data}catch(a){throw console.error("Error checking project:",{error:a,response:(i=a.response)==null?void 0:i.data}),a}},_s=async s=>{try{return await S.get(`/comment/${s}`)}catch(t){throw console.log(t),t}},Is=async(s,t)=>{try{console.log("idddd",s);const o=await S.post(`/comment/${s}`,{content:t});return console.log(o),o.data}catch(o){throw console.log(o),o}},je=({children:s,...t})=>e.jsx($,{...t,size:30,shape:"circle",children:s}),Ts=({status:s,time:t})=>{const i=(()=>{switch(s.toLowerCase()){case"approval":case"approved":return{bg:"bg-emerald-500",icon:e.jsx(Ke,{className:"text-white"}),text:"Approved"};case"check":case"checked":return{bg:"bg-yellow-500",icon:e.jsx(fe,{className:"text-white"}),text:"Checked"};case"reject":case"rejected":return{bg:"bg-red-500",icon:e.jsx(Ze,{className:"text-white"}),text:"Rejected"};default:return{bg:"bg-blue-500",icon:e.jsx(Je,{className:"text-white"}),text:"General"}}})();return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{prefix:!0,className:`${i.bg} text-white mr-2 rtl:ml-2`,prefixClass:i.bg,children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:i.icon}),i.text]})}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t})]})},Es=({comment:s})=>e.jsxs("div",{className:"flex mb-4",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:e.jsx(je,{src:s.img})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100 mr-2",children:s.name}),e.jsx(Ts,{status:s.actionType||"general",time:s.time})]}),e.jsx("p",{className:"text-gray-800 dark:text-gray-200 pl-1",children:s.comment})]})]}),Ps=({projectId:s,refresh:t=!1})=>{const[o,i]=c.useState(!0),[a,m]=c.useState([]),[r,u]=c.useState(!1),h=c.useRef(null);c.useEffect(()=>{s&&x()},[s,t]);const x=async()=>{i(!0);try{const g=((await _s(s)).data.data||[]).map(p=>{const v=p.user||{},H=`${v.firstName||""} ${v.lastName||""}`.trim()||"Unknown User";return{id:p._id,name:H,img:v.profileImage||"/img/avatars/thumb-1.jpg",time:p.createdAt?new Date(p.createdAt).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0,day:"numeric",month:"short"}):"Just now",comment:p.content||"",actionType:p.actionType||"general"}});m(g)}catch(l){console.error("Failed to fetch comments:",l)}finally{i(!1)}},f=async()=>{var j;const l=(j=h.current)==null?void 0:j.value;if(!(!(l!=null&&l.trim())||!s))try{u(!0);const g={id:Date.now().toString(),name:"You",img:"/img/avatars/thumb-1.jpg",time:"just now",comment:l,actionType:"general"};m(p=>[g,...p]),h.current&&(h.current.value=""),await Is(s,l),await x()}catch(g){console.error("Failed to post comment:",g),m(p=>p.filter(v=>v.id!==Date.now().toString()))}finally{u(!1)}};return e.jsx(ls,{className:"h-full",children:e.jsx(ue,{loading:o,children:e.jsxs(cs,{bodyClass:"p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Activity"}),e.jsx("div",{className:"mb-6",children:a.map(l=>e.jsx(Es,{comment:l},l.id))}),e.jsxs("div",{className:"mt-6 mb-3 flex flex-auto",children:[e.jsx(je,{src:"/img/avatars/thumb-1.jpg"}),e.jsx("div",{className:"ml-4 rtl:mr-4 w-full",children:e.jsx(Be,{ref:h,textArea:!0,placeholder:"Leave a comment",disabled:r})})]}),e.jsx("div",{className:"text-right",children:e.jsx(b,{variant:"solid",onClick:f,loading:r,disabled:r,children:"Comment"})})]})})})},$s=({data:s,onAddClick:t})=>{os();const o=he(),{id:i}=xe(),a=()=>{s.exists?s.type==="quotation"?o(`/app/quotation-view/${i}`):s.type==="expenseTracker"?o(s.viewRoute||`/app/expense/${i}`):o(s.viewRoute||s.route,{state:{projectId:i}}):t(s.type)},m=()=>{switch(s.type){case"estimation":return"blue-600";case"quotation":return"purple-600";case"lpo":return"green-600";case"workProgress":return"orange-600";case"invoice":return"indigo-600";case"expenseTracker":return"red-600";default:return"gray-600"}};return e.jsx(C,{className:"h-full transition-all duration-200 hover:shadow-lg",children:s.exists?e.jsxs("div",{className:"flex flex-col h-full p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{size:40,src:s.icon,className:"bg-gray-100 dark:bg-gray-600 p-2",shape:"square"}),e.jsx("h6",{className:"font-bold text-gray-800 dark:text-gray-100",children:s.title})]}),s.status&&e.jsx(P,{content:s.status,innerClass:`${s.status==="approved"?"bg-emerald-500":s.status==="pending"?"bg-amber-500":"bg-blue-500"}`})]}),e.jsxs("div",{className:"mt-auto",children:[s.amount&&e.jsx("h5",{className:"mb-2 text-lg font-semibold text-gray-900 dark:text-white",children:e.jsx(is,{displayType:"text",value:s.amount,prefix:"$",thousandSeparator:!0,decimalScale:2})}),s.date&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:qe(s.date).format("MMM D, YYYY")}),e.jsxs(b,{className:"w-full",size:"sm",variant:"twoTone",icon:e.jsx(fe,{className:"text-lg"}),onClick:a,color:m(),children:["View ",s.title]})]})]}):e.jsx(C,{clickable:!0,className:"border-dashed border-2 hover:border-indigo-600 hover:dark:border-gray-300 bg-transparent h-full flex items-center justify-center transition-colors duration-200",onClick:a,children:e.jsxs("div",{className:"flex flex-col justify-center items-center py-5",children:[e.jsx("div",{className:"p-3 rounded-full bg-gray-100 dark:bg-gray-600 transition-colors duration-200",children:e.jsx(ns,{className:"text-2xl text-gray-400 dark:text-gray-300"})}),e.jsxs("p",{className:"mt-3 font-semibold text-gray-600 dark:text-gray-300",children:["Add ",s.title]})]})})})},Os=({isOpen:s,onClose:t,estimationId:o,onSuccess:i})=>{const[a,m]=c.useState(""),[r,u]=c.useState(!1),[h,x]=c.useState(null),f=async l=>{var j,g;u(!0),x(null);try{await As({estimationId:o,isApproved:l,comment:a||void 0}),N.push(e.jsx(w,{title:`Project ${l?"approved":"rejected"} successfully`,type:"success"}),{placement:"top-center"}),i(),t()}catch(p){console.error("Error updating project status:",p),x(((g=(j=p.response)==null?void 0:j.data)==null?void 0:g.message)||"Failed to update project status"),N.push(e.jsx(w,{title:"Failed to update project status",type:"danger"}),{placement:"top-center"})}finally{u(!1)}};return e.jsxs(ge,{isOpen:s,onClose:t,width:500,className:"dark:bg-gray-800",children:[e.jsx("h5",{className:"mb-4 dark:text-white",children:"Update Project Status"}),h&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-600 rounded dark:bg-red-900/30 dark:text-red-400",children:h}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 dark:text-gray-300",children:"Comments"}),e.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:4,value:a,onChange:l=>m(l.target.value),placeholder:"Enter your comments here..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(b,{variant:"plain",onClick:()=>f(!1),disabled:r,className:"text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/30",children:r?"Processing...":"Reject"}),e.jsx(b,{variant:"solid",onClick:()=>f(!0),disabled:r,className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-500 dark:hover:bg-blue-600",children:r?"Processing...":"Approve"})]})]})},Hs=Fe.memo(({isOpen:s,onClose:t,estimationId:o,onSuccess:i})=>{const[a,m]=c.useState(""),[r,u]=c.useState(!1),[h,x]=c.useState(null),f=async l=>{var j,g;u(!0),x(null);try{await Ss({estimationId:o,isChecked:l,comment:a||void 0}),N.push(e.jsx(w,{title:`Project ${l?"checked":"rejected"} successfully`,type:"success"}),{placement:"top-center"}),i(),t(),m("")}catch(p){console.error("Error updating project status:",p),x(((g=(j=p.response)==null?void 0:j.data)==null?void 0:g.message)||"Failed to update project status"),N.push(e.jsx(w,{title:"Failed to update project status",type:"danger"}),{placement:"top-center"})}finally{u(!1)}};return c.useEffect(()=>{s||(m(""),x(null))},[s]),e.jsxs(ge,{isOpen:s,onClose:t,width:500,className:"dark:bg-gray-800",children:[e.jsx("h5",{className:"mb-4 dark:text-white",children:"Check Status"}),h&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-600 rounded dark:bg-red-900/30 dark:text-red-400",children:h}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 dark:text-gray-300",children:"Comments"}),e.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:4,value:a,onChange:l=>m(l.target.value),placeholder:"Enter your comments here..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(b,{variant:"plain",onClick:()=>f(!1),disabled:r,className:"text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/30",children:r?"Processing...":"Reject"}),e.jsx(b,{variant:"solid",onClick:()=>f(!0),disabled:r,className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-500 dark:hover:bg-blue-600",children:r?"Processing...":"Checked"})]})]})}),Rs=()=>{const{id:s}=xe(),t=he(),[o,i]=c.useState(!1),[a,m]=c.useState([]),[r,u]=c.useState(null),[h,x]=c.useState(!1),[f,l]=c.useState(!1),[j,g]=c.useState(""),[p,v]=c.useState(!1),[H,M]=c.useState(!1),[F,ye]=c.useState([]),[A,D]=c.useState(null),[be,q]=c.useState(!1),[W,z]=c.useState(!1),I=(De(n=>n.auth.user.authority)||[])[0]||"finance",[ve,B]=c.useState(!1),Ne=async()=>{q(!0);try{const n=await ks();ye(n.data.engineers),r!=null&&r.assignedTo&&D(r.assignedTo._id)}catch(n){console.error("Failed to fetch engineers:",n),N.push(e.jsx(w,{title:"Failed to load engineers",type:"danger"}),{placement:"top-center"})}finally{q(!1)}},we=()=>{l(!0),Ne()},U=()=>{l(!1)},ke=()=>{r!=null&&r.estimationId&&M(!0)},Ce=()=>{M(!1)},Se=n=>{g(n),v(!0)},Ae=()=>{v(!1)},_e=()=>{E(s).then(n=>{u(n==null?void 0:n.data),z(d=>!d)}),window.location.reload()},Ie=()=>{E(s).then(n=>{u(n==null?void 0:n.data),z(d=>!d)})},Te=async()=>{var n,d;if(!A||!s){N.push(e.jsx(w,{title:"Please select an engineer",type:"warning"}),{placement:"top-center"});return}B(!0);try{await Cs({projectId:s,engineerId:A}),N.push(e.jsx(w,{title:"Engineer assigned successfully",type:"success"}),{placement:"top-center"});const y=await E(s);u(y==null?void 0:y.data),U()}catch(y){console.error("Assignment failed:",y);let T="Failed to assign engineer";(d=(n=y.response)==null?void 0:n.data)!=null&&d.message&&(T=y.response.data.message),N.push(e.jsx(w,{title:T,type:"danger"}),{placement:"top-center"})}finally{B(!1)}},Ee=n=>{const d=a.find(y=>y.type===n);d&&(n==="expenseTracker"?t(d.exists?d.viewRoute||`/app/expense/${s}`:d.route):t(d.exists&&d.viewRoute||d.route,{state:{projectId:s}}))};return c.useEffect(()=>{x(!0),E(s).then(n=>{var Q,X,J,Z,K,ee,se,te,re,ne;u(n==null?void 0:n.data),x(!1);const d=((Q=n==null?void 0:n.data)==null?void 0:Q.status)||"draft",y=(X=n==null?void 0:n.data)==null?void 0:X.isApproved,T=!!((J=n==null?void 0:n.data)!=null&&J.assignedTo),V=!!((Z=n==null?void 0:n.data)!=null&&Z.estimationId),Y=!!((K=n==null?void 0:n.data)!=null&&K.quotationId),G=!!((ee=n==null?void 0:n.data)!=null&&ee.lpoId);(se=n==null?void 0:n.data)!=null&&se.lopId;const R=!!((te=n==null?void 0:n.data)!=null&&te.lpoId),Pe=!!((re=n==null?void 0:n.data)!=null&&re.expenseId);let k=[...[{type:"estimation",title:"Estimation",route:`/app/create-estimation/${s}`,viewRoute:V?`/app/estimation-view/${n.data.estimationId}`:void 0,exists:V,icon:"/img/document-icons/estimation.png",roles:["finance","super_admin","admin","engineer"]}]];y&&T&&k.push({type:"quotation",title:"Quotation",route:`/app/quotation-new/${s}`,viewRoute:Y?`/app/quotation-view/${s}`:void 0,exists:Y,icon:"/img/document-icons/quotation.png",roles:["finance","super_admin","admin"]}),["quotation_sent","lpo_received","work_started","in_progress","work_completed","invoice_sent"].includes(d)&&k.push({type:"lpo",title:"LPO",route:`/app/lpo/${s}`,exists:G,viewRoute:G?`/app/lpo-view/${s}`:void 0,icon:"/img/document-icons/lpo.png",roles:["finance","super_admin","admin"]}),["lpo_received","work_started","in_progress","work_completed","invoice_sent","team_assigned"].includes(d)&&k.push({type:"workProgress",title:"Work Progress",route:R?void 0:"/app/workprogress",viewRoute:R?`/app/workprogress/${s}`:void 0,exists:R,icon:"/img/document-icons/report.png",roles:["finance","super_admin","admin","engineer"]}),d==="work_completed"&&k.push({type:"workCompletion",title:"Completion Report",viewRoute:`/app/workcompletionreport/${s}`,exists:!0,icon:"/img/document-icons/completion.png",roles:["finance","super_admin","admin","engineer"]}),d==="work_completed"&&k.push({type:"invoice",title:"Invoice",viewRoute:s?`/app/invoice-view/${s}`:void 0,exists:s,icon:"/img/document-icons/invoice.png",roles:["finance","super_admin","admin"]}),["lpo_received","work_started","in_progress","work_completed","invoice_sent","team_assigned"].includes(d)&&k.push({type:"expenseTracker",title:"Expense Tracker",route:`/app/expense/${s}`,viewRoute:`/app/expense-view/${(ne=n==null?void 0:n.data)==null?void 0:ne.expenseId}`,exists:Pe,icon:"/img/document-icons/expense.png",roles:["finance","super_admin","admin"]});const $e=k.filter(Oe=>{var ie;return(ie=Oe.roles)==null?void 0:ie.includes(I)});m($e),i(!1)}).catch(n=>{console.error("Error fetching project:",n),x(!1)})},[s,I,W]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:!o&&a.length>0?a.map(n=>e.jsx($s,{data:n,onAddClick:Ee},n.type)):[...Array(4).keys()].map(n=>e.jsx(C,{children:e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(de,{size:20,color:"#3b82f6",loading:o})})},n))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx(ws,{projectdetails:r}),e.jsx(C,{children:e.jsx(Ps,{projectId:s,refresh:W})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ns,{clientinformation:r}),(r==null?void 0:r.estimationId)&&e.jsx(C,{children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between border-b pb-3 border-gray-200 dark:border-gray-600",children:e.jsx("h5",{className:"font-semibold",children:"Project Status"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Status:"}),e.jsx(P,{content:(r==null?void 0:r.status)||"draft"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Engineer:"}),r!=null&&r.assignedTo?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{size:32,src:r.assignedTo.profileImage,shape:"circle"}),e.jsxs("span",{className:"font-medium",children:[r.assignedTo.firstName," ",r.assignedTo.lastName]})]}):e.jsx(b,{size:"xs",variant:"solid",icon:e.jsx(es,{}),onClick:we,children:"Assign"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Checked:"}),e.jsx(P,{content:r!=null&&r.isChecked?"Verified":"Pending",innerClass:r!=null&&r.isChecked?"bg-emerald-500":"bg-amber-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Approved:"}),e.jsx(P,{content:r!=null&&r.isApproved?"Approved":"Pending",innerClass:r!=null&&r.isApproved?"bg-emerald-500":"bg-amber-500"})]})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[(r==null?void 0:r.assignedTo)&&e.jsx(b,{block:!0,variant:"solid",icon:e.jsx(ss,{}),onClick:()=>t(`/app/attendance-summary/${s}`),children:"View Attendance"}),["super_admin","admin"].includes(I)&&!(r!=null&&r.isApproved)&&e.jsx(b,{block:!0,variant:"solid",onClick:ke,disabled:!(r!=null&&r.isChecked),icon:r!=null&&r.isChecked?e.jsx(ts,{}):e.jsx(rs,{}),children:r!=null&&r.isChecked?"Approve Project":"Needs Verification First"}),["super_admin","admin","engineer"].includes(I)&&!(r!=null&&r.isChecked)&&e.jsx(b,{block:!0,variant:"solid",onClick:()=>Se(s||""),children:"Verify Project"})]})]})})]})]}),e.jsx(ze,{title:"Assign Engineer",isOpen:f,onClose:U,width:400,children:be?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ue,{})}):F.length>0?e.jsxs("div",{className:"space-y-4",children:[F.map(n=>{var d;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors ${A===n._id?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700":"hover:bg-gray-50 dark:hover:bg-gray-700/50 border border-transparent"}`,onClick:()=>D(n._id),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{size:40,src:n.profileImage,className:"mr-3",shape:"circle"}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-gray-900 dark:text-white",children:[n.firstName," ",n.lastName]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:((d=n.phoneNumbers)==null?void 0:d[0])||"No phone number"})]})]}),A===n._id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})]},n._id)}),e.jsx("div",{className:"mt-6 flex justify-end",children:ve?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(de,{size:20,color:"#3b82f6"})}):e.jsx(b,{variant:"solid",onClick:Te,disabled:!A,children:A?"Confirm Assignment":"Select an engineer"})})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:"No engineers available"})}),e.jsx(Os,{isOpen:H,onClose:Ce,estimationId:r==null?void 0:r.estimationId,onSuccess:_e}),e.jsx(Hs,{isOpen:p,onClose:Ae,estimationId:(r==null?void 0:r.estimationId)||"",onSuccess:Ie})]})};We("cryptoWallets",gs);const Ft=()=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(Rs,{})});export{Ft as default};
