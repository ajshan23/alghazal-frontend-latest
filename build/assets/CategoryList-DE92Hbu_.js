import{r as n,j as e,v as T,m as P}from"./index-Bb5hWms4.js";import{A as I}from"./AdaptableCard-CDzqb9V2.js";import{A as $}from"./index-CUJxdyM4.js";import{D as B}from"./DataTable-DFljVjQc.js";import{a0 as F,a5 as K,a4 as L}from"./index-DyZvV4US.js";import{a as O}from"./index-CM2QS1te.js";import{u as R}from"./useThemeClass-DlW0H-Tq.js";import{u as q}from"./useQuery-CHL8T0Ye.js";import{d as E}from"./debounce-CwggmGx4.js";import{I as H}from"./Input-Cko6IXRf.js";import{d as z,f as M}from"./api-BeNeRqD3.js";import{C as _}from"./ConfirmDialog-DQueJXox.js";import{t as j,N as C}from"./toast-CpYugtuS.js";import{B as Q}from"./Button-CEPbL0Lb.js";import"./Card-B8rHCzH9.js";import"./floating-ui.react-Ba33Pvev.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-lYREKt9z.js";import"./proxy-BmbT6RnM.js";import"./index-D9qBG3Fu.js";import"./index-DUSL2oPJ.js";import"./Skeleton-1b1THtL-.js";import"./Views-Dor-7I9u.js";import"./_getPrototype-BB6F7yg0.js";import"./Select-D7Yb2KL8.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-C0OdKYE1.js";import"./context-KCROMUm4.js";import"./index-CxGBFu-E.js";import"./toString-C-FzytsZ.js";import"./Dialog-BD9Iq8Pi.js";import"./index-BKRUeILu.js";import"./index-Chjiymov.js";import"./CloseButton-EGMOUB2z.js";import"./StatusIcon-Bp830_1A.js";import"./chainedFunction-BxZSneMW.js";const G=({isOpen:r,onClose:o,category:s,refetch:i})=>{const[l,m]=n.useState(!1);if(!r||!s)return null;const g=async()=>{var d,c;m(!0);try{await z(s._id),i(),j.push(e.jsx(C,{title:`Category "${s.name}" deleted`,type:"success",duration:2500,children:"The category has been successfully deleted."}),{placement:"top-center"}),o()}catch(a){console.error("Delete failed:",a),j.push(e.jsx(C,{title:`Failed to delete category "${s.name}"`,type:"danger",duration:2500,children:((c=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:c.message)||a.message||"Something went wrong"}),{placement:"top-center"})}finally{m(!1)}};return e.jsxs(_,{isOpen:r,type:"danger",title:`Delete Category "${s.name}"`,confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:g,confirmButtonDisabled:l,children:[e.jsxs("p",{children:['Are you sure you want to delete the category "',s.name,'"? This action cannot be undone.']}),l&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},J=({row:r,onDeleteClick:o})=>{const{textTheme:s}=R(),i=T();return e.jsxs("div",{className:"flex  text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${s}`,onClick:()=>i(`/app/new-cat/${r._id}`),children:e.jsx(F,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>o(r),children:e.jsx(K,{})})]})},U=({row:r})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{icon:e.jsx(O,{}),className:"bg-indigo-100 text-indigo-600 dark:bg-indigo-500/20 dark:text-indigo-100"}),e.jsx("span",{className:"ml-2 rtl:mr-2 font-semibold",children:r.name})]}),V=()=>{var x,f;const r=n.useRef(null),[o,s]=n.useState(""),[i,l]=n.useState({page:1,limit:10}),[m,g]=n.useState(null),[d,c]=n.useState(!1),{data:a,isLoading:b,error:h,refetch:y}=q({queryKey:["categories",i.page,i.limit,o],queryFn:()=>M({page:i.page,limit:i.limit,search:o})}),N=((x=a==null?void 0:a.data)==null?void 0:x.categories)||[],u=((f=a==null?void 0:a.data)==null?void 0:f.pagination)||{total:0,page:1,limit:10,totalPages:1,hasNextPage:!1,hasPreviousPage:!1},v=n.useMemo(()=>E(t=>{s(t),l(p=>({...p,page:1}))},500),[]),D=t=>{v(t.target.value)},w=t=>{g(t),c(!0)},A=n.useMemo(()=>[{header:"Name",accessorKey:"name",cell:t=>e.jsx(U,{row:t.row.original})},{header:"Description",accessorKey:"description",cell:t=>e.jsx("span",{className:"truncate max-w-xs block",children:t.row.original.description||"N/A"})},{header:"Created At",accessorKey:"createdAt",cell:t=>e.jsx("span",{children:new Date(t.row.original.createdAt).toLocaleDateString()})},{header:"Action",id:"action",cell:t=>e.jsx(J,{row:t.row.original,onDeleteClick:w}),align:"right"}],[]),k=t=>{l(p=>({...p,page:t}))},S=t=>{l(p=>({page:1,limit:t}))};return h?e.jsxs("div",{children:["Error loading categories: ",h.message]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(H,{placeholder:"Search categories...",onChange:D,className:"max-w-md"})}),e.jsx(B,{ref:r,columns:A,data:N,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:b,pagingData:{total:u.total,pageIndex:u.page,pageSize:u.limit},onPaginationChange:k,onSelectChange:S}),e.jsx(G,{isOpen:d,onClose:()=>c(!1),category:m,refetch:y})]})},W=()=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:e.jsx(P,{className:"block lg:inline-block md:mb-0 mb-4",to:"/app/new-cat",children:e.jsx(Q,{block:!0,variant:"solid",size:"sm",icon:e.jsx(L,{}),children:"Add Category"})})}),Fe=()=>e.jsxs(I,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Categories"}),e.jsx(W,{to:"/app/new-gen-bill",title:"Add Category"})]}),e.jsx(V,{})]});export{Fe as default};
