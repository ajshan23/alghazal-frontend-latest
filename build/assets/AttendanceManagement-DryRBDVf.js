import{ak as w,v as M,r as s,b as y,j as e,a3 as C}from"./index-Bb5hWms4.js";import"./Alert-Dugunmqe.js";import{A as S}from"./index-CUJxdyM4.js";import{B as Y}from"./Badge-1rBRPyjl.js";import{B as c}from"./Button-CEPbL0Lb.js";import"./Calendar-D6hwXXzX.js";import{C as D}from"./Card-B8rHCzH9.js";import"./Skeleton-1b1THtL-.js";import"./index-i-B8EDNL.js";import"./Dialog-BD9Iq8Pi.js";import"./Drawer-bwHZPj3y.js";import"./index-xDZoWOTm.js";import"./FormItem-HvRvrzPo.js";import"./useUniqueId-BnEng_SK.js";import"./Input-Cko6IXRf.js";import"./index-BxyXzxfn.js";import"./index-D9ztJ0Q9.js";import{t as i,N as n}from"./toast-CpYugtuS.js";import"./Progress-odjwHsxt.js";import"./index-Dk7Y2OWs.js";import"./ScrollBar-BNcJtmRR.js";import"./index-C5YaGYnA.js";import"./Select-D7Yb2KL8.js";import"./Upload-VD0qPFFK.js";import"./index-D9qBG3Fu.js";import"./Tag-e5oFChya.js";import"./index-CDOucsrX.js";import{aT as P,H as _,an as B}from"./index-DyZvV4US.js";import{f as E,g as j}from"./api-BA8ASte3.js";import{u as z}from"./useThemeClass-DlW0H-Tq.js";import"./Views-Dor-7I9u.js";import"./chart.config-YkJl3Uc_.js";import"./DataTable-DFljVjQc.js";import"./SvgIcon-A_UsLZ_J.js";import"./SegmentItemOption-Bzdg9gy2.js";import{F as H}from"./index-CM2QS1te.js";import"./StatusIcon-Bp830_1A.js";import"./CloseButton-EGMOUB2z.js";import"./proxy-BmbT6RnM.js";import"./floating-ui.react-Ba33Pvev.js";import"./floating-ui.dom-D1IisfOw.js";import"./index-lYREKt9z.js";import"./context-KCROMUm4.js";import"./useControllableState-LB_3bez6.js";import"./_getPrototype-BB6F7yg0.js";import"./index-BKRUeILu.js";import"./index-Chjiymov.js";import"./toString-C-FzytsZ.js";import"./chainedFunction-BxZSneMW.js";import"./index-D81fdFo4.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-C0OdKYE1.js";import"./index-DUSL2oPJ.js";import"./index-CxGBFu-E.js";import"./cloneDeep-DJN0yfLA.js";const Te=()=>{const{projectId:m}=w();M(),z();const[N,g]=s.useState(!0),[o,d]=s.useState(!1),[l,k]=s.useState(null),[p,x]=s.useState([]),[v,b]=s.useState(y().format("DD MMM YYYY")),u=async()=>{try{g(!0);const t=await E(m);k(t.data.data.project),x(t.data.data.workers),b(y(t.data.data.date).format("DD MMM YYYY"))}catch(t){i.push(e.jsx(n,{title:"Error fetching attendance",type:"danger",children:t.message}))}finally{g(!1)}};s.useEffect(()=>{u()},[m]);const f=async(t,a)=>{try{d(!0),await j({projectId:m,userId:t,present:a}),x(r=>r.map(h=>h._id===t?{...h,present:a,markedBy:{_id:"current-user",firstName:"You",lastName:""},markedAt:new Date}:h)),i.push(e.jsx(n,{title:"Success",type:"success",children:"Attendance marked successfully"}))}catch(r){i.push(e.jsx(n,{title:"Error marking attendance",type:"danger",children:r.message}))}finally{d(!1)}},A=async t=>{try{d(!0),await Promise.all(p.map(a=>j({projectId:m,userId:a._id,present:t}))),x(a=>a.map(r=>({...r,present:t,markedBy:{_id:"current-user",firstName:"You",lastName:""},markedAt:new Date}))),i.push(e.jsxs(n,{title:"Success",type:"success",children:["All workers marked as ",t?"present":"absent"]}))}catch(a){i.push(e.jsx(n,{title:"Error marking attendance",type:"danger",children:a.message}))}finally{d(!1)}};return N?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(C,{})}):e.jsx("div",{className:"container mx-auto px-4 h-full",children:e.jsx(D,{header:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold mb-1",children:"Attendance Management"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:[l==null?void 0:l.projectName," - ",v]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 md:mt-0",children:[e.jsx(c,{size:"sm",variant:"plain",icon:e.jsx(P,{}),onClick:u,children:"Refresh"}),e.jsx(c,{size:"sm",variant:"solid",onClick:()=>A(!0),disabled:o,children:"Mark All Present"})]})]}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-600",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Worker"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600",children:p.length>0?p.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{size:"sm",src:t.profileImage,className:"mr-3",icon:e.jsx(H,{})}),e.jsx("div",{children:e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-200",children:[t.firstName," ",t.lastName]})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:t.mobileNumber||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(Y,{content:t.present?"Present":"Absent",innerClass:`${t.present?"bg-emerald-500 text-white":"bg-red-500 text-white"}`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{size:"xs",variant:"solid",color:"green",icon:e.jsx(_,{}),onClick:()=>f(t._id,!0),disabled:o||t.present,children:"Present"}),e.jsx(c,{size:"xs",variant:"solid",color:"red",icon:e.jsx(B,{}),onClick:()=>f(t._id,!1),disabled:o||!t.present,children:"Absent"})]})})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No workers assigned to this project"})})})]})})})})};export{Te as default};
