import{j as e,c as Le,ao as ue,a9 as pe,aa as Me,ac as De,r as c,m as Fe,an as S,a3 as xe,ak as he,v as ge,u as qe,am as We,b as ze,ae as Be}from"./index-BxO48E7J.js";import"./Alert-DAYHHcTG.js";import{A as O}from"./index-D65Or3wn.js";import{B as P}from"./Badge-BDINMpeU.js";import{B as b}from"./Button-Cqs6OGDK.js";import"./Calendar-CZCjMlL9.js";import{C}from"./Card-BkELxnQG.js";import"./Skeleton-UhY8bWTz.js";import"./index-CbDZljJP.js";import{D as fe}from"./Dialog-Y-f76L7n.js";import{D as Ue}from"./Drawer-C4WNb_Rb.js";import"./index-DPk-9BZv.js";import"./FormItem-BHnkbcAj.js";import"./useUniqueId-B5ZH9nmF.js";import{I as Ve}from"./Input-Bk_hBu-L.js";import"./index-CujXW8qQ.js";import"./index-DUubB36n.js";import{t as N,N as w}from"./toast-CyYsqkVZ.js";import"./Progress-B54yMz__.js";import"./index-ko3aNh7X.js";import"./ScrollBar-Dolz5Bqf.js";import"./index-BQv2iMDd.js";import"./Select-BKHxHb6S.js";import"./Upload-5TuzLRJ1.js";import"./index-Br-igED4.js";import{T as Ye}from"./Tag-oUmSLAu4.js";import"./index-DPAMRK6r.js";import{af as Ge,a4 as Qe,a5 as Xe,ag as Je,a6 as Ke,ah as ae,S as Ze,ai as es,I as je,H as ss,q as ts,aj as rs,ak as ns,al as is,a1 as as,j as oe,W as os,am as cs,L as ls,an as ds,ao as ms}from"./index-BvMts2N3.js";import{N as us}from"./react-number-format.es-5s4xhXPE.js";import{u as ps}from"./useThemeClass-CVckhmrY.js";import{i as xs}from"./index-VwH9CKQD.js";import{A as hs}from"./AdaptableCard-DFT79cx9.js";import{C as gs}from"./Views-DNvf1mRE.js";import"./chart.config-Dntevg-Q.js";import"./DataTable-BY0GTXYv.js";import"./SvgIcon-RMdG7_sD.js";import"./SegmentItemOption-BFgyQbW2.js";import"./StatusIcon-DL8X5trP.js";import"./CloseButton-C69hR3t8.js";import"./proxy-Cgq6JklI.js";import"./floating-ui.react-BI-9OMXT.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-C5P6Zpzc.js";import"./context-BpXqFl7R.js";import"./useControllableState-Z-hTdTNR.js";import"./_getPrototype-CXL19Th3.js";import"./index-mlsqo1Ee.js";import"./index-Chjiymov.js";import"./toString-DS3ZSNMT.js";import"./chainedFunction-BxZSneMW.js";import"./index-Ci8JUJEH.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-Az_z3Foo.js";import"./index-BOBJKlrD.js";import"./cloneDeep-DJN0yfLA.js";const T=({className:s,asElement:t="span",icon:a,children:i})=>e.jsxs(t,{className:Le("flex items-center gap-2",s),children:[a,i]});async function fs(){return ue.fetchData({url:"/crypto/wallets",method:"get"})}async function js(s){return ue.fetchData({url:"/crypto/wallets/history",method:"post",data:s})}const L="cryptoWallets",ce=pe(L+"/getWalletData",async()=>(await fs()).data),le=pe(L+"/getTransctionHistoryData",async s=>(await js(s)).data),ys={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},bs={loading:!0,walletsData:[],transactionHistoryLoading:!0,transactionHistoryData:[],tableData:ys,selectedTab:"trade"},ye=Me({name:`${L}/state`,initialState:bs,reducers:{setSelectedTab:(s,t)=>{s.selectedTab=t.payload},setTableData:(s,t)=>{s.tableData=t.payload},setTransactionHistoryData:(s,t)=>{s.transactionHistoryData=t.payload}},extraReducers:s=>{s.addCase(ce.fulfilled,(t,a)=>{t.loading=!1,t.walletsData=a.payload}).addCase(ce.pending,t=>{t.loading=!0}).addCase(le.fulfilled,(t,a)=>{t.transactionHistoryLoading=!1,t.tableData.total=a.payload.total,t.transactionHistoryData=a.payload.data}).addCase(le.pending,t=>{t.transactionHistoryLoading=!0})}}),{setSelectedTab:Yt,setTableData:Gt,setTransactionHistoryData:Qt}=ye.actions,vs=ye.reducer,Ns=De({data:vs});var ws={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function ks(s){if(typeof s=="number")return{value:s,unit:"px"};var t,a=(s.match(/^[0-9.]*/)||"").toString();a.includes(".")?t=parseFloat(a):t=parseInt(a,10);var i=(s.match(/[^0-9]*$/)||"").toString();return ws[i]?{value:t,unit:i}:(console.warn("React Spinners: ".concat(s," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}function de(s){var t=ks(s);return"".concat(t.value).concat(t.unit)}var Cs=function(s,t,a){var i="react-spinners-".concat(s,"-").concat(a);if(typeof window>"u"||!window.document)return i;var o=document.createElement("style");document.head.appendChild(o);var m=o.sheet,r=`
    @keyframes `.concat(i,` {
      `).concat(t,`
    }
  `);return m&&m.insertRule(r,0),i},H=function(){return H=Object.assign||function(s){for(var t,a=1,i=arguments.length;a<i;a++){t=arguments[a];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(s[o]=t[o])}return s},H.apply(this,arguments)},Ss=function(s,t){var a={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(s);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(s,i[o])&&(a[i[o]]=s[i[o]]);return a},As=Cs("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function me(s){var t=s.loading,a=t===void 0?!0:t,i=s.color,o=i===void 0?"#000000":i,m=s.speedMultiplier,r=m===void 0?1:m,p=s.cssOverride,h=p===void 0?{}:p,x=s.size,f=x===void 0?35:x,l=Ss(s,["loading","color","speedMultiplier","cssOverride","size"]),j=H({background:"transparent !important",width:de(f),height:de(f),borderRadius:"100%",border:"2px solid",borderTopColor:o,borderBottomColor:"transparent",borderLeftColor:o,borderRightColor:o,display:"inline-block",animation:"".concat(As," ").concat(.75/r,"s 0s infinite linear"),animationFillMode:"both"},h);return a?c.createElement("span",H({style:j},l)):null}const Ts=({clientinformation:s})=>{var t,a,i,o,m;return e.jsxs(C,{children:[e.jsx("h5",{className:"mb-4",children:"Customer"}),e.jsxs(Fe,{className:"group flex items-center justify-between",to:"/app/crm/customer-details?id=11",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"ltr:ml-2 rtl:mr-2",children:e.jsxs("span",{children:["Name : ",(t=s==null?void 0:s.client)==null?void 0:t.clientName]})})}),e.jsx(Ge,{className:"text-xl hidden group-hover:block"})]}),e.jsx("hr",{className:"my-5"}),e.jsx(T,{className:"mb-4",icon:e.jsx(Qe,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(a=s==null?void 0:s.client)==null?void 0:a.email})}),e.jsx(T,{icon:e.jsx(xs,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(i=s==null?void 0:s.client)==null?void 0:i.mobileNumber})}),e.jsx("br",{}),e.jsx(T,{icon:e.jsx(Xe,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(o=s==null?void 0:s.client)==null?void 0:o.telephoneNumber})}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-4",children:"Shipping Address"}),e.jsx("address",{className:"not-italic",children:e.jsx("div",{className:"mb-1",children:(m=s==null?void 0:s.client)==null?void 0:m.clientAddress})})]})},_s=({projectdetails:s})=>{var t,a,i;return e.jsxs(C,{children:[e.jsx("h5",{className:"mb-4",children:"Project Details"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ltr:ml-2 rtl:mr-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:s==null?void 0:s.projectName}),e.jsx("div",{className:"font-semibold text-lg",children:s==null?void 0:s.projectNumber})]})}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Project Description"}),e.jsxs("div",{className:"flex items-start mb-5",children:[e.jsx(Je,{className:"text-xl opacity-70 mt-1 mr-2"}),e.jsx("p",{className:"text-gray-700",children:(s==null?void 0:s.projectDescription)||"No description provided"})]}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Site Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{icon:e.jsx(Ke,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Site Location"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.location)||"Not specified"})]})}),e.jsx(T,{icon:e.jsx(ae,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Building"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.building)||"Not specified"})]})}),e.jsx(T,{icon:e.jsx(ae,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Apartment"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.apartmentNumber)||"Not specified"})]})})]}),(s==null?void 0:s.client)&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Client Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Name: "}),e.jsx("span",{children:(t=s==null?void 0:s.client)==null?void 0:t.clientName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Address: "}),e.jsx("span",{children:(a=s==null?void 0:s.client)==null?void 0:a.clientAddress})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Phone: "}),e.jsx("span",{children:(i=s==null?void 0:s.client)==null?void 0:i.mobileNumber})]})]})]})]})},E=async s=>{try{console.log("project data : ",s);const t=await S.get(`/project/${s}`);return console.log(t),t.data}catch(t){throw console.log(t),t}},Is=async()=>{try{const s=await S.get("/user/engineers/");return console.log(s),s.data}catch(s){throw console.log(s),s}},Es=async({projectId:s,engineerId:t})=>{var a;try{return console.log(s,"project id"),console.log(t,"engineerId "),(await S.post(`/project/${s}/assign`,{assignedTo:t})).data}catch(i){throw console.error("Assignment error details:",{error:i,response:(a=i.response)==null?void 0:a.data}),i}},Ps=async({estimationId:s,isChecked:t,comment:a})=>{var i;try{return(await S.patch(`/estimation/${s}/check`,{isChecked:t,comment:a})).data}catch(o){throw console.error("Error checking project:",{error:o,response:(i=o.response)==null?void 0:i.data}),o}},Os=async({estimationId:s,isApproved:t,comment:a})=>{var i;try{return(await S.patch(`/estimation/${s}/approve`,{isApproved:t,comment:a})).data}catch(o){throw console.error("Error checking project:",{error:o,response:(i=o.response)==null?void 0:i.data}),o}},Hs=async s=>{try{return await S.get(`/comment/${s}`)}catch(t){throw console.log(t),t}},$s=async(s,t)=>{try{console.log("idddd",s);const a=await S.post(`/comment/${s}`,{content:t});return console.log(a),a.data}catch(a){throw console.log(a),a}},be=({children:s,...t})=>e.jsx(O,{...t,size:30,shape:"circle",children:s}),Rs=({status:s,time:t})=>{const i=(()=>{switch(s.toLowerCase()){case"approval":case"approved":return{bg:"bg-emerald-500",icon:e.jsx(ss,{className:"text-white"}),text:"Approved"};case"check":case"checked":return{bg:"bg-yellow-500",icon:e.jsx(je,{className:"text-white"}),text:"Checked"};case"reject":case"rejected":return{bg:"bg-red-500",icon:e.jsx(es,{className:"text-white"}),text:"Rejected"};default:return{bg:"bg-blue-500",icon:e.jsx(Ze,{className:"text-white"}),text:"General"}}})();return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ye,{prefix:!0,className:`${i.bg} text-white mr-2 rtl:ml-2`,prefixClass:i.bg,children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:i.icon}),i.text]})}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t})]})},Ls=({comment:s})=>e.jsxs("div",{className:"flex mb-4",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:e.jsx(be,{src:s.img})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100 mr-2",children:s.name}),e.jsx(Rs,{status:s.actionType||"general",time:s.time})]}),e.jsx("p",{className:"text-gray-800 dark:text-gray-200 pl-1",children:s.comment})]})]}),Ms=({projectId:s,refresh:t=!1})=>{const[a,i]=c.useState(!0),[o,m]=c.useState([]),[r,p]=c.useState(!1),h=c.useRef(null);c.useEffect(()=>{s&&x()},[s,t]);const x=async()=>{i(!0);try{const g=((await Hs(s)).data.data||[]).map(u=>{const v=u.user||{};console.log(v,"231");const $=`${v.firstName||""} ${v.lastName||""}`.trim()||"Unknown User";return{id:u._id,name:$,img:v.profileImage?v.profileImage:"/img/avatars/thumb-1.jpg",time:u.createdAt?new Date(u.createdAt).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0,day:"numeric",month:"short"}):"Just now",comment:u.content||"",actionType:u.actionType||"general"}});m(g)}catch(l){console.error("Failed to fetch comments:",l)}finally{i(!1)}},f=async()=>{var j;const l=(j=h.current)==null?void 0:j.value;if(!(!(l!=null&&l.trim())||!s))try{p(!0);const g={id:Date.now().toString(),name:"You",img:"/img/avatars/thumb-1.jpg",time:"just now",comment:l,actionType:"general"};m(u=>[g,...u]),h.current&&(h.current.value=""),await $s(s,l),await x()}catch(g){console.error("Failed to post comment:",g),m(u=>u.filter(v=>v.id!==Date.now().toString()))}finally{p(!1)}};return e.jsx(gs,{className:"h-full",children:e.jsx(xe,{loading:a,children:e.jsxs(hs,{bodyClass:"p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Activity"}),e.jsx("div",{className:"mb-6",children:o.map(l=>e.jsx(Ls,{comment:l},l.id))}),e.jsxs("div",{className:"mt-6 mb-3 flex flex-auto",children:[e.jsx(be,{src:"/img/avatars/thumb-1.jpg"}),e.jsx("div",{className:"ml-4 rtl:mr-4 w-full",children:e.jsx(Ve,{ref:h,textArea:!0,placeholder:"Leave a comment",disabled:r})})]}),e.jsx("div",{className:"text-right",children:e.jsx(b,{variant:"solid",onClick:f,loading:r,disabled:r,children:"Comment"})})]})})})},Ds=({data:s,onAddClick:t})=>{ps();const a=ge(),{id:i}=he(),o=()=>{switch(s.type){case"estimation":return e.jsx(oe,{className:"text-2xl"});case"quotation":return e.jsx(ms,{className:"text-2xl"});case"lpo":return e.jsx(ds,{className:"text-2xl"});case"workProgress":return e.jsx(ls,{className:"text-2xl"});case"invoice":return e.jsx(cs,{className:"text-2xl"});case"expenseTracker":return e.jsx(os,{className:"text-2xl"});default:return e.jsx(oe,{className:"text-2xl"})}},m=()=>{s.exists?s.type==="quotation"?a(`/app/quotation-view/${i}`):s.type==="expenseTracker"?a(s.viewRoute||`/app/expense/${i}`):a(s.viewRoute||s.route,{state:{projectId:i}}):t(s.type)},r=()=>{switch(s.type){case"estimation":return"blue-600";case"quotation":return"purple-600";case"lpo":return"green-600";case"workProgress":return"orange-600";case"invoice":return"indigo-600";case"expenseTracker":return"red-600";default:return"gray-600"}};return e.jsx(C,{className:"h-full transition-all duration-200 hover:shadow-lg",children:s.exists?e.jsxs("div",{className:"flex flex-col h-full p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{size:40,icon:o()}),e.jsx("h6",{className:"font-bold text-gray-800 dark:text-gray-100",children:s.title})]}),s.status&&e.jsx(P,{content:s.status,innerClass:`${s.status==="approved"?"bg-emerald-500":s.status==="pending"?"bg-amber-500":"bg-blue-500"}`})]}),e.jsxs("div",{className:"mt-auto",children:[s.amount&&e.jsx("h5",{className:"mb-2 text-lg font-semibold text-gray-900 dark:text-white",children:e.jsx(us,{displayType:"text",value:s.amount,prefix:"$",thousandSeparator:!0,decimalScale:2})}),s.date&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:ze(s.date).format("MMM D, YYYY")}),e.jsxs(b,{className:"w-full",size:"sm",variant:"twoTone",icon:e.jsx(je,{className:"text-lg"}),onClick:m,color:r(),children:["View ",s.title]})]})]}):e.jsx(C,{clickable:!0,className:"border-dashed border-2 hover:border-indigo-600 hover:dark:border-gray-300 bg-transparent h-full flex items-center justify-center transition-colors duration-200",onClick:m,children:e.jsxs("div",{className:"flex flex-col justify-center items-center py-5",children:[e.jsx("div",{className:"p-3 rounded-full bg-gray-100 dark:bg-gray-600 transition-colors duration-200",children:e.jsx(as,{className:"text-2xl text-gray-400 dark:text-gray-300"})}),e.jsxs("p",{className:"mt-3 font-semibold text-gray-600 dark:text-gray-300",children:["Add ",s.title]})]})})})},Fs=({isOpen:s,onClose:t,estimationId:a,onSuccess:i})=>{const[o,m]=c.useState(""),[r,p]=c.useState(!1),[h,x]=c.useState(null),f=async l=>{var j,g;p(!0),x(null);try{await Os({estimationId:a,isApproved:l,comment:o||void 0}),N.push(e.jsx(w,{title:`Project ${l?"approved":"rejected"} successfully`,type:"success"}),{placement:"top-center"}),i(),t()}catch(u){console.error("Error updating project status:",u),x(((g=(j=u.response)==null?void 0:j.data)==null?void 0:g.message)||"Failed to update project status"),N.push(e.jsx(w,{title:"Failed to update project status",type:"danger"}),{placement:"top-center"})}finally{p(!1)}};return e.jsxs(fe,{isOpen:s,onClose:t,width:500,className:"dark:bg-gray-800",children:[e.jsx("h5",{className:"mb-4 dark:text-white",children:"Update Project Status"}),h&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-600 rounded dark:bg-red-900/30 dark:text-red-400",children:h}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 dark:text-gray-300",children:"Comments"}),e.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:4,value:o,onChange:l=>m(l.target.value),placeholder:"Enter your comments here..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(b,{variant:"plain",onClick:()=>f(!1),disabled:r,className:"text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/30",children:r?"Processing...":"Reject"}),e.jsx(b,{variant:"solid",onClick:()=>f(!0),disabled:r,className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-500 dark:hover:bg-blue-600",children:r?"Processing...":"Approve"})]})]})},qs=We.memo(({isOpen:s,onClose:t,estimationId:a,onSuccess:i})=>{const[o,m]=c.useState(""),[r,p]=c.useState(!1),[h,x]=c.useState(null),f=async l=>{var j,g;p(!0),x(null);try{await Ps({estimationId:a,isChecked:l,comment:o||void 0}),N.push(e.jsx(w,{title:`Project ${l?"checked":"rejected"} successfully`,type:"success"}),{placement:"top-center"}),i(),t(),m("")}catch(u){console.error("Error updating project status:",u),x(((g=(j=u.response)==null?void 0:j.data)==null?void 0:g.message)||"Failed to update project status"),N.push(e.jsx(w,{title:"Failed to update project status",type:"danger"}),{placement:"top-center"})}finally{p(!1)}};return c.useEffect(()=>{s||(m(""),x(null))},[s]),e.jsxs(fe,{isOpen:s,onClose:t,width:500,className:"dark:bg-gray-800",children:[e.jsx("h5",{className:"mb-4 dark:text-white",children:"Check Status"}),h&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-600 rounded dark:bg-red-900/30 dark:text-red-400",children:h}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 dark:text-gray-300",children:"Comments"}),e.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:4,value:o,onChange:l=>m(l.target.value),placeholder:"Enter your comments here..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(b,{variant:"plain",onClick:()=>f(!1),disabled:r,className:"text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/30",children:r?"Processing...":"Reject"}),e.jsx(b,{variant:"solid",onClick:()=>f(!0),disabled:r,className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-500 dark:hover:bg-blue-600",children:r?"Processing...":"Checked"})]})]})}),Ws=()=>{const{id:s}=he(),t=ge(),[a,i]=c.useState(!1),[o,m]=c.useState([]),[r,p]=c.useState(null),[h,x]=c.useState(!1),[f,l]=c.useState(!1),[j,g]=c.useState(""),[u,v]=c.useState(!1),[$,M]=c.useState(!1),[D,ve]=c.useState([]),[A,F]=c.useState(null),[Ne,q]=c.useState(!1),[W,z]=c.useState(!1),_=(qe(n=>n.auth.user.authority)||[])[0]||"finance",[we,B]=c.useState(!1),ke=async()=>{q(!0);try{const n=await Is();ve(n.data.engineers),r!=null&&r.assignedTo&&F(r.assignedTo._id)}catch(n){console.error("Failed to fetch engineers:",n),N.push(e.jsx(w,{title:"Failed to load engineers",type:"danger"}),{placement:"top-center"})}finally{q(!1)}},Ce=()=>{l(!0),ke()},U=()=>{l(!1)},Se=()=>{r!=null&&r.estimationId&&M(!0)},Ae=()=>{M(!1)},Te=n=>{g(n),v(!0)},_e=()=>{v(!1)},Ie=()=>{E(s).then(n=>{p(n==null?void 0:n.data),z(d=>!d)}),window.location.reload()},Ee=()=>{E(s).then(n=>{p(n==null?void 0:n.data),z(d=>!d)})},Pe=async()=>{var n,d;if(!A||!s){N.push(e.jsx(w,{title:"Please select an engineer",type:"warning"}),{placement:"top-center"});return}B(!0);try{await Es({projectId:s,engineerId:A}),N.push(e.jsx(w,{title:"Engineer assigned successfully",type:"success"}),{placement:"top-center"});const y=await E(s);p(y==null?void 0:y.data),U()}catch(y){console.error("Assignment failed:",y);let I="Failed to assign engineer";(d=(n=y.response)==null?void 0:n.data)!=null&&d.message&&(I=y.response.data.message),N.push(e.jsx(w,{title:I,type:"danger"}),{placement:"top-center"})}finally{B(!1)}},Oe=n=>{const d=o.find(y=>y.type===n);d&&(n==="expenseTracker"?t(d.exists?d.viewRoute||`/app/expense/${s}`:d.route):t(d.exists&&d.viewRoute||d.route,{state:{projectId:s}}))};return c.useEffect(()=>{x(!0),E(s).then(n=>{var Q,X,J,K,Z,ee,se,te,re,ne;p(n==null?void 0:n.data),x(!1);const d=((Q=n==null?void 0:n.data)==null?void 0:Q.status)||"draft",y=(X=n==null?void 0:n.data)==null?void 0:X.isApproved,I=!!((J=n==null?void 0:n.data)!=null&&J.assignedTo),V=!!((K=n==null?void 0:n.data)!=null&&K.estimationId),Y=!!((Z=n==null?void 0:n.data)!=null&&Z.quotationId),G=!!((ee=n==null?void 0:n.data)!=null&&ee.lpoId);(se=n==null?void 0:n.data)!=null&&se.lopId;const R=!!((te=n==null?void 0:n.data)!=null&&te.lpoId),He=!!((re=n==null?void 0:n.data)!=null&&re.expenseId);let k=[...[{type:"estimation",title:"Estimation",route:`/app/create-estimation/${s}`,viewRoute:V?`/app/estimation-view/${n.data.estimationId}`:void 0,exists:V,roles:["finance","super_admin","admin","engineer"]}]];y&&I&&k.push({type:"quotation",title:"Quotation",route:`/app/quotation-new/${s}`,viewRoute:Y?`/app/quotation-view/${s}`:void 0,exists:Y,roles:["finance","super_admin","admin"]}),["quotation_sent","lpo_received","work_started","in_progress","work_completed","invoice_sent"].includes(d)&&k.push({type:"lpo",title:"LPO",route:`/app/lpo/${s}`,exists:G,viewRoute:G?`/app/lpo-view/${s}`:void 0,roles:["finance","super_admin","admin"]}),["lpo_received","work_started","in_progress","work_completed","invoice_sent","team_assigned"].includes(d)&&k.push({type:"workProgress",title:"Work Progress",route:R?void 0:"/app/workprogress",viewRoute:R?`/app/workprogress/${s}`:void 0,exists:R,roles:["finance","super_admin","admin","engineer"]}),d==="work_completed"&&k.push({type:"workCompletion",title:"Completion Report",viewRoute:`/app/workcompletionreport/${s}`,exists:!0,roles:["finance","super_admin","admin","engineer"]}),d==="work_completed"&&k.push({type:"invoice",title:"Invoice",viewRoute:s?`/app/invoice-view/${s}`:void 0,exists:s,roles:["finance","super_admin","admin"]}),["lpo_received","work_started","in_progress","work_completed","invoice_sent","team_assigned"].includes(d)&&k.push({type:"expenseTracker",title:"Expense Tracker",route:`/app/expense/${s}`,viewRoute:`/app/expense-view/${(ne=n==null?void 0:n.data)==null?void 0:ne.expenseId}`,exists:He,roles:["finance","super_admin","admin"]});const $e=k.filter(Re=>{var ie;return(ie=Re.roles)==null?void 0:ie.includes(_)});m($e),i(!1)}).catch(n=>{console.error("Error fetching project:",n),x(!1)})},[s,_,W]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:!a&&o.length>0?o.map(n=>e.jsx(Ds,{data:n,onAddClick:Oe},n.type)):[...Array(4).keys()].map(n=>e.jsx(C,{children:e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(me,{size:20,color:"#3b82f6",loading:a})})},n))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx(_s,{projectdetails:r}),e.jsx(C,{children:e.jsx(Ms,{projectId:s,refresh:W})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ts,{clientinformation:r}),(r==null?void 0:r.estimationId)&&e.jsx(C,{children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between border-b pb-3 border-gray-200 dark:border-gray-600",children:e.jsx("h5",{className:"font-semibold",children:"Project Status"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Status:"}),e.jsx(P,{content:(r==null?void 0:r.status)||"draft"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Engineer:"}),r!=null&&r.assignedTo?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:32,src:r.assignedTo.profileImage,shape:"circle"}),e.jsxs("span",{className:"font-medium",children:[r.assignedTo.firstName," ",r.assignedTo.lastName]})]}):e.jsx(b,{size:"xs",variant:"solid",icon:e.jsx(ts,{}),onClick:Ce,children:"Assign"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Checked:"}),e.jsx(P,{content:r!=null&&r.isChecked?"Verified":"Pending",innerClass:r!=null&&r.isChecked?"bg-emerald-500":"bg-amber-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Approved:"}),e.jsx(P,{content:r!=null&&r.isApproved?"Approved":"Pending",innerClass:r!=null&&r.isApproved?"bg-emerald-500":"bg-amber-500"})]})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[(r==null?void 0:r.assignedTo)&&e.jsx(b,{block:!0,variant:"solid",icon:e.jsx(rs,{}),onClick:()=>t(`/app/attendance-summary/${s}`),children:"View Attendance"}),["super_admin","admin"].includes(_)&&!(r!=null&&r.isApproved)&&e.jsx(b,{block:!0,variant:"solid",onClick:Se,disabled:!(r!=null&&r.isChecked),icon:r!=null&&r.isChecked?e.jsx(ns,{}):e.jsx(is,{}),children:r!=null&&r.isChecked?"Approve Project":"Needs Verification First"}),["super_admin","admin","engineer"].includes(_)&&!(r!=null&&r.isChecked)&&e.jsx(b,{block:!0,variant:"solid",onClick:()=>Te(s||""),children:"Verify Project"})]})]})})]})]}),e.jsx(Ue,{title:"Assign Engineer",isOpen:f,onClose:U,width:400,children:Ne?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(xe,{})}):D.length>0?e.jsxs("div",{className:"space-y-4",children:[D.map(n=>{var d;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors ${A===n._id?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700":"hover:bg-gray-50 dark:hover:bg-gray-700/50 border border-transparent"}`,onClick:()=>F(n._id),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{size:40,src:n.profileImage,className:"mr-3",shape:"circle"}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-gray-900 dark:text-white",children:[n.firstName," ",n.lastName]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:((d=n.phoneNumbers)==null?void 0:d[0])||"No phone number"})]})]}),A===n._id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})]},n._id)}),e.jsx("div",{className:"mt-6 flex justify-end",children:we?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(me,{size:20,color:"#3b82f6"})}):e.jsx(b,{variant:"solid",onClick:Pe,disabled:!A,children:A?"Confirm Assignment":"Select an engineer"})})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:"No engineers available"})}),e.jsx(Fs,{isOpen:$,onClose:Ae,estimationId:r==null?void 0:r.estimationId,onSuccess:Ie}),e.jsx(qs,{isOpen:u,onClose:_e,estimationId:(r==null?void 0:r.estimationId)||"",onSuccess:Ee})]})};Be("cryptoWallets",Ns);const Xt=()=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(Ws,{})});export{Xt as default};
